<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zengkaiqiang562.github.io/zkq/android/basic/activity.html"><meta property="og:site_name" content="Android Guide"><meta property="og:title" content="Activity"><meta property="og:type" content="article"><meta property="og:image" content="https://zengkaiqiang562.github.io/"><meta property="og:updated_time" content="2022-07-06T10:07:29.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Activity"><meta property="article:tag" content="android-基础"><meta property="article:modified_time" content="2022-07-06T10:07:29.000Z"><script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2922463_99aa80ii7cf.css"><title>Activity | Android Guide</title><meta name="description" content="Android 学习 && 面试指南">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.5a38b724.css">
    <link rel="modulepreload" href="/assets/app.625aa393.js"><link rel="modulepreload" href="/assets/activity.html.c21cbbb6.js"><link rel="modulepreload" href="/assets/activity.html.2b2cc85c.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.png" alt="Android Guide"><!----><span class="site-name hide-in-pad">Android Guide</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" arialabel="面试指南"><i class="icon iconfont icon-java"></i>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zhuanlan/" class="nav-link" arialabel="优质专栏"><i class="icon iconfont icon-recommend"></i>优质专栏<!----></a></div><div class="nav-item hide-in-mobile"><a href="/open-source-project/" class="nav-link" arialabel="项目精选"><i class="icon iconfont icon-github"></i>项目精选<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://snailclimb.gitee.io/javaguide/#/" rel="noopener noreferrer" target="_blank" arialabel="旧版链接" class="nav-link"><i class="icon iconfont icon-java"></i>旧版链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://javaguide.cn/feed.json" rel="noopener noreferrer" target="_blank" arialabel="RSS订阅" class="nav-link"><i class="icon iconfont icon-rss"></i>RSS订阅<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/about-the-author/" class="nav-link" arialabel="关于作者"><i class="icon iconfont icon-zuozhe"></i>关于作者<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zengkaiqiang562/JavaGuide" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" arialabelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" arialabelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" arialabelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">基础</span><span class="arrow down"></span></button><!--[--><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/zkq/android/basic/activity.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="Activity"><!---->Activity<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-生命周期" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. 生命周期"><!---->1. 生命周期<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-1-生命周期切换过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 生命周期切换过程"><!---->1.1 生命周期切换过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-正常生命周期" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2 正常生命周期"><!---->1.2 正常生命周期<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-1-oncreate" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.1 onCreate"><!---->1.2.1 onCreate<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-2-onrestart" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.2 onRestart"><!---->1.2.2 onRestart<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-3-onstart" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.3 onStart"><!---->1.2.3 onStart<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-4-onresume" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.4 onResume"><!---->1.2.4 onResume<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-5-onpause" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.5 onPause"><!---->1.2.5 onPause<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-6-onstop" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.6 onStop"><!---->1.2.6 onStop<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-7-ondestroy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.7 onDestroy"><!---->1.2.7 onDestroy<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-具体场景分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8 具体场景分析"><!---->1.2.8 具体场景分析<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-1-activity-第一次启动时" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.1 Activity 第一次启动时"><!---->1.2.8.1 Activity 第一次启动时<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-2-activity-退到后台-切换到桌面-or-跳转到其它-activity" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.2 Activity 退到后台（切换到桌面 or 跳转到其它 Activity）"><!---->1.2.8.2 Activity 退到后台（切换到桌面 or 跳转到其它 Activity）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-3-跳转到采用了透明主题的其它-activity" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.3 跳转到采用了透明主题的其它 Activity"><!---->1.2.8.3 跳转到采用了透明主题的其它 Activity<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-4-activity-回到前台-用户再次回到原-activity" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.4 Activity 回到前台（用户再次回到原 Activity）"><!---->1.2.8.4 Activity 回到前台（用户再次回到原 Activity）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-5-锁屏-开屏" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.5 锁屏 &amp; 开屏"><!---->1.2.8.5 锁屏 &amp; 开屏<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-6-用户按-back-按键回退时" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2.8.6 用户按 back 按键回退时"><!---->1.2.8.6 用户按 back 按键回退时<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-异常生命周期" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3 异常生命周期"><!---->1.3 异常生命周期<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-资源相关的系统配置改变导致-activity-销毁重建-如横竖屏切换" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3.1 资源相关的系统配置改变导致 Activity 销毁重建（如横竖屏切换）"><!---->1.3.1 资源相关的系统配置改变导致 Activity 销毁重建（如横竖屏切换）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-1-onsaveinstancestate-onrestoreinstancestate" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3.1.1 onSaveInstanceState &amp; onRestoreInstanceState"><!---->1.3.1.1 onSaveInstanceState &amp; onRestoreInstanceState<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-2-view-层次结构的保存与恢复-委托思想" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3.1.2 View 层次结构的保存与恢复 &amp; 委托思想"><!---->1.3.1.2 View 层次结构的保存与恢复 &amp; 委托思想<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-3-横竖屏切换时阻止-activity-的销毁重建-configchanges-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3.1.3 横竖屏切换时阻止 Activity 的销毁重建 &amp; configChanges 属性"><!---->1.3.1.3 横竖屏切换时阻止 Activity 的销毁重建 &amp; configChanges 属性<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-2-系统内存不足导致低优先级的-activity-所在进程被杀死" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3.2 系统内存不足导致低优先级的 Activity 所在进程被杀死"><!---->1.3.2 系统内存不足导致低优先级的 Activity 所在进程被杀死<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-4-将一个-activity-设置成窗口的样式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.4 将一个 Activity 设置成窗口的样式"><!---->1.4 将一个 Activity 设置成窗口的样式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-5-退出已调用多个-activity-的-application" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.5 退出已调用多个 Activity 的 Application"><!---->1.5 退出已调用多个 Activity 的 Application<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-6-修改-activity-进入和退出动画" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.6 修改 Activity 进入和退出动画"><!---->1.6 修改 Activity 进入和退出动画<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-启动模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. 启动模式"><!---->2. 启动模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-1-为什么需要启动模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 为什么需要启动模式"><!---->2.1 为什么需要启动模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-四种启动模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 四种启动模式"><!---->2.2 四种启动模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-standard-标准模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.1 standard（标准模式）"><!---->2.2.1 standard（标准模式）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-1-standard-模式启动的-activity-默认进入当前-context-的任务栈中" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.1.1 standard 模式启动的 Activity 默认进入当前 Context 的任务栈中"><!---->2.2.1.1 standard 模式启动的 Activity 默认进入当前 Context 的任务栈中<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-2-standard-模式启动时-context-无任务栈的解决方案" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.1.2 standard 模式启动时 Context 无任务栈的解决方案"><!---->2.2.1.2 standard 模式启动时 Context 无任务栈的解决方案<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-2-singletop-栈顶复用模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.2 singleTop（栈顶复用模式）"><!---->2.2.2 singleTop（栈顶复用模式）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-3-singletask-栈内复用模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.3 singleTask（栈内复用模式）"><!---->2.2.3 singleTask（栈内复用模式）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-4-singleinstance-单实例模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2.4 singleInstance（单实例模式）"><!---->2.2.4 singleInstance（单实例模式）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-给-activity-指定启动模式的两种方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3 给 Activity 指定启动模式的两种方式"><!---->2.3 给 Activity 指定启动模式的两种方式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-1-在-androidmanifest-xml-中通过-android-launchmode-属性指定" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1 在 AndroidManifest.xml 中通过 android:launchMode 属性指定"><!---->2.3.1 在 AndroidManifest.xml 中通过 android:launchMode 属性指定<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-2-在代码中通过给-intent-设置的标志位指定" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.2 在代码中通过给 Intent 设置的标志位指定"><!---->2.3.2 在代码中通过给 Intent 设置的标志位指定<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-activity-的任务栈-taskaffinity-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4 Activity 的任务栈 &amp; taskAffinity 属性"><!---->2.4 Activity 的任务栈 &amp; taskAffinity 属性<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-1-taskaffinity-属性-singletask-模式结合使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.1 taskAffinity 属性 &amp; singleTask 模式结合使用"><!---->2.4.1 taskAffinity 属性 &amp; singleTask 模式结合使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-2-taskaffinity-属性-allowtaskreparenting-属性结合使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.2 taskAffinity 属性 &amp; allowTaskReparenting 属性结合使用"><!---->2.4.2 taskAffinity 属性 &amp; allowTaskReparenting 属性结合使用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-示例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.5 示例"><!---->2.5 示例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-1-示例-1-查看-activity-任务栈-dumpsys-命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.5.1 示例 1：查看 Activity 任务栈 &amp; dumpsys 命令"><!---->2.5.1 示例 1：查看 Activity 任务栈 &amp; dumpsys 命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-2-示例-2-singletop-模式具有-cleartop-的效果" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.5.2 示例 2：singleTop 模式具有 clearTop 的效果"><!---->2.5.2 示例 2：singleTop 模式具有 clearTop 的效果<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-6-启动模式的使用场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.6 启动模式的使用场景"><!---->2.6 启动模式的使用场景<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-activity-的-flags" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7 Activity 的 Flags"><!---->2.7 Activity 的 Flags<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-设置-activity-启动模式的-flags" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.1  设置 Activity 启动模式的 Flags"><!---->2.7.1  设置 Activity 启动模式的 Flags<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-1-flag-activity-new-task" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.1.1 FLAG_ACTIVITY_NEW_TASK"><!---->2.7.1.1 FLAG_ACTIVITY_NEW_TASK<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-2-flag-activity-single-top" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.1.2 FLAG_ACTIVITY_SINGLE_TOP"><!---->2.7.1.2 FLAG_ACTIVITY_SINGLE_TOP<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-影响-activity-运行状态的-flags" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.2  影响 Activity 运行状态的 Flags"><!---->2.7.2  影响 Activity 运行状态的 Flags<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-1-flag-activity-clear-top" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.2.1 FLAG_ACTIVITY_CLEAR_TOP"><!---->2.7.2.1 FLAG_ACTIVITY_CLEAR_TOP<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-2-flag-activity-exclude-from-recents" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.7.2.2 FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS"><!---->2.7.2.2 FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-8-onnewintent-方法什么时候执行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.8 onNewIntent 方法什么时候执行"><!---->2.8 onNewIntent 方法什么时候执行<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_3-数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. 数据"><!---->3. 数据<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_3-1-intent-传递数据太大-报-transactiontoolargeexception-异常" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1 Intent 传递数据太大，报 TransactionTooLargeException 异常"><!---->3.1 Intent 传递数据太大，报 TransactionTooLargeException 异常<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_4-context" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. Context"><!---->4. Context<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_4-1-context-的继承关系" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.1 Context 的继承关系"><!---->4.1 Context 的继承关系<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-进程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. 进程"><!---->5. 进程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-1-进程优先级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.1 进程优先级"><!---->5.1 进程优先级<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-进程分类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2 进程分类"><!---->5.2 进程分类<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-1-前台进程-foreground-process" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2.1 前台进程（Foreground Process）"><!---->5.2.1 前台进程（Foreground Process）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-2-可见进程-visible-process" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2.2 可见进程（Visible Process）"><!---->5.2.2 可见进程（Visible Process）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-3-服务进程-service-process" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2.3 服务进程（Service Process）"><!---->5.2.3 服务进程（Service Process）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-4-后台进程-background-process" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2.4 后台进程（Background Process）"><!---->5.2.4 后台进程（Background Process）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-5-空进程-empty-process" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2.5 空进程（Empty Process）"><!---->5.2.5 空进程（Empty Process）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/fragment.html" class="nav-link sidebar-link sidebar-page" arialabel="Fragment（TODO）"><!---->Fragment（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/service.html" class="nav-link sidebar-link sidebar-page" arialabel="Service"><!---->Service<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/broadcast.html" class="nav-link sidebar-link sidebar-page" arialabel="BroadcastReceiver"><!---->BroadcastReceiver<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/contentprovider.html" class="nav-link sidebar-link sidebar-page" arialabel="ContentProvider"><!---->ContentProvider<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/serialize.html" class="nav-link sidebar-link sidebar-page" arialabel="对象序列化（TODO）"><!---->对象序列化（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/asynctask.html" class="nav-link sidebar-link sidebar-page" arialabel="AsyncTask"><!---->AsyncTask<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/handler.html" class="nav-link sidebar-link sidebar-page" arialabel="Android的消息机制（TODO）"><!---->Android的消息机制（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/custom-view.html" class="nav-link sidebar-link sidebar-page" arialabel="自定义View（TODO）"><!---->自定义View（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/ui-draw-process.html" class="nav-link sidebar-link sidebar-page" arialabel="UI绘制流程（DOING）"><!---->UI绘制流程（DOING）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/event-dispatch-mechanism.html" class="nav-link sidebar-link sidebar-page" arialabel="事件分发机制"><!---->事件分发机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">绘图基础</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">动画</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">UI</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Jetpack</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">NDK</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">IPC</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">蓝牙开发</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">性能优化</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">系统源码分析</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Activity</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://zengkaiqiang562.github.io/" target="_blank" rel="noopener noreferrer">Zenk562</a></span><span property="author" content="Zenk562"></span></span><span class="category-info" arialabel="分类🌈" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category clickable" role="navigation">android-基础</li><meta property="articleSection" content="android-基础"></ul></span><span arialabel="标签🏷" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag clickable" role="navigation">android-基础</li></ul><meta property="keywords" content="android-基础"></span><span class="date-info" arialabel="写作日期📅" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年7月6日</span><meta property="datePublished" content="2022-07-06T10:07:29.000Z"></span><!----><span class="words-info" arialabel="字数🔠" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" arialabelledby="word"><title id="word" lang="en">word icon</title><g fill="currentColor"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></g></svg><span>约 7999 字</span><meta property="wordCount" content="7999"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-生命周期" class="router-link-active router-link-exact-active toc-link level2">1. 生命周期</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-1-生命周期切换过程" class="router-link-active router-link-exact-active toc-link level3">1.1 生命周期切换过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-正常生命周期" class="router-link-active router-link-exact-active toc-link level3">1.2 正常生命周期</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-1-oncreate" class="router-link-active router-link-exact-active toc-link level4">1.2.1 onCreate</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-2-onrestart" class="router-link-active router-link-exact-active toc-link level4">1.2.2 onRestart</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-3-onstart" class="router-link-active router-link-exact-active toc-link level4">1.2.3 onStart</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-4-onresume" class="router-link-active router-link-exact-active toc-link level4">1.2.4 onResume</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-5-onpause" class="router-link-active router-link-exact-active toc-link level4">1.2.5 onPause</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-6-onstop" class="router-link-active router-link-exact-active toc-link level4">1.2.6 onStop</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-7-ondestroy" class="router-link-active router-link-exact-active toc-link level4">1.2.7 onDestroy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-具体场景分析" class="router-link-active router-link-exact-active toc-link level4">1.2.8 具体场景分析</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-1-activity-第一次启动时" class="router-link-active router-link-exact-active toc-link level5">1.2.8.1 Activity 第一次启动时</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-2-activity-退到后台-切换到桌面-or-跳转到其它-activity" class="router-link-active router-link-exact-active toc-link level5">1.2.8.2 Activity 退到后台（切换到桌面 or 跳转到其它 Activity）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-3-跳转到采用了透明主题的其它-activity" class="router-link-active router-link-exact-active toc-link level5">1.2.8.3 跳转到采用了透明主题的其它 Activity</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-4-activity-回到前台-用户再次回到原-activity" class="router-link-active router-link-exact-active toc-link level5">1.2.8.4 Activity 回到前台（用户再次回到原 Activity）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-5-锁屏-开屏" class="router-link-active router-link-exact-active toc-link level5">1.2.8.5 锁屏 &amp; 开屏</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-2-8-6-用户按-back-按键回退时" class="router-link-active router-link-exact-active toc-link level5">1.2.8.6 用户按 back 按键回退时</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-异常生命周期" class="router-link-active router-link-exact-active toc-link level3">1.3 异常生命周期</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-资源相关的系统配置改变导致-activity-销毁重建-如横竖屏切换" class="router-link-active router-link-exact-active toc-link level4">1.3.1 资源相关的系统配置改变导致 Activity 销毁重建（如横竖屏切换）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-1-onsaveinstancestate-onrestoreinstancestate" class="router-link-active router-link-exact-active toc-link level5">1.3.1.1 onSaveInstanceState &amp; onRestoreInstanceState</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-2-view-层次结构的保存与恢复-委托思想" class="router-link-active router-link-exact-active toc-link level5">1.3.1.2 View 层次结构的保存与恢复 &amp; 委托思想</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-1-3-横竖屏切换时阻止-activity-的销毁重建-configchanges-属性" class="router-link-active router-link-exact-active toc-link level5">1.3.1.3 横竖屏切换时阻止 Activity 的销毁重建 &amp; configChanges 属性</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-3-2-系统内存不足导致低优先级的-activity-所在进程被杀死" class="router-link-active router-link-exact-active toc-link level4">1.3.2 系统内存不足导致低优先级的 Activity 所在进程被杀死</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-4-将一个-activity-设置成窗口的样式" class="router-link-active router-link-exact-active toc-link level3">1.4 将一个 Activity 设置成窗口的样式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-5-退出已调用多个-activity-的-application" class="router-link-active router-link-exact-active toc-link level3">1.5 退出已调用多个 Activity 的 Application</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_1-6-修改-activity-进入和退出动画" class="router-link-active router-link-exact-active toc-link level3">1.6 修改 Activity 进入和退出动画</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-启动模式" class="router-link-active router-link-exact-active toc-link level2">2. 启动模式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-1-为什么需要启动模式" class="router-link-active router-link-exact-active toc-link level3">2.1 为什么需要启动模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-四种启动模式" class="router-link-active router-link-exact-active toc-link level3">2.2 四种启动模式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-standard-标准模式" class="router-link-active router-link-exact-active toc-link level4">2.2.1 standard（标准模式）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-1-standard-模式启动的-activity-默认进入当前-context-的任务栈中" class="router-link-active router-link-exact-active toc-link level4">2.2.1.1 standard 模式启动的 Activity 默认进入当前 Context 的任务栈中</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-1-2-standard-模式启动时-context-无任务栈的解决方案" class="router-link-active router-link-exact-active toc-link level4">2.2.1.2 standard 模式启动时 Context 无任务栈的解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-2-singletop-栈顶复用模式" class="router-link-active router-link-exact-active toc-link level4">2.2.2 singleTop（栈顶复用模式）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-3-singletask-栈内复用模式" class="router-link-active router-link-exact-active toc-link level4">2.2.3 singleTask（栈内复用模式）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-2-4-singleinstance-单实例模式" class="router-link-active router-link-exact-active toc-link level4">2.2.4 singleInstance（单实例模式）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-给-activity-指定启动模式的两种方式" class="router-link-active router-link-exact-active toc-link level3">2.3 给 Activity 指定启动模式的两种方式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-1-在-androidmanifest-xml-中通过-android-launchmode-属性指定" class="router-link-active router-link-exact-active toc-link level4">2.3.1 在 AndroidManifest.xml 中通过 android:launchMode 属性指定</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-3-2-在代码中通过给-intent-设置的标志位指定" class="router-link-active router-link-exact-active toc-link level4">2.3.2 在代码中通过给 Intent 设置的标志位指定</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-activity-的任务栈-taskaffinity-属性" class="router-link-active router-link-exact-active toc-link level3">2.4 Activity 的任务栈 &amp; taskAffinity 属性</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-1-taskaffinity-属性-singletask-模式结合使用" class="router-link-active router-link-exact-active toc-link level4">2.4.1 taskAffinity 属性 &amp; singleTask 模式结合使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-4-2-taskaffinity-属性-allowtaskreparenting-属性结合使用" class="router-link-active router-link-exact-active toc-link level4">2.4.2 taskAffinity 属性 &amp; allowTaskReparenting 属性结合使用</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-示例" class="router-link-active router-link-exact-active toc-link level3">2.5 示例</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-1-示例-1-查看-activity-任务栈-dumpsys-命令" class="router-link-active router-link-exact-active toc-link level4">2.5.1 示例 1：查看 Activity 任务栈 &amp; dumpsys 命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-5-2-示例-2-singletop-模式具有-cleartop-的效果" class="router-link-active router-link-exact-active toc-link level4">2.5.2 示例 2：singleTop 模式具有 clearTop 的效果</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-6-启动模式的使用场景" class="router-link-active router-link-exact-active toc-link level3">2.6 启动模式的使用场景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-activity-的-flags" class="router-link-active router-link-exact-active toc-link level3">2.7 Activity 的 Flags</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-设置-activity-启动模式的-flags" class="router-link-active router-link-exact-active toc-link level4">2.7.1  设置 Activity 启动模式的 Flags</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-1-flag-activity-new-task" class="router-link-active router-link-exact-active toc-link level5">2.7.1.1 FLAG_ACTIVITY_NEW_TASK</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-1-2-flag-activity-single-top" class="router-link-active router-link-exact-active toc-link level5">2.7.1.2 FLAG_ACTIVITY_SINGLE_TOP</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-影响-activity-运行状态的-flags" class="router-link-active router-link-exact-active toc-link level4">2.7.2  影响 Activity 运行状态的 Flags</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-1-flag-activity-clear-top" class="router-link-active router-link-exact-active toc-link level5">2.7.2.1 FLAG_ACTIVITY_CLEAR_TOP</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-7-2-2-flag-activity-exclude-from-recents" class="router-link-active router-link-exact-active toc-link level5">2.7.2.2 FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_2-8-onnewintent-方法什么时候执行" class="router-link-active router-link-exact-active toc-link level3">2.8 onNewIntent 方法什么时候执行</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_3-数据" class="router-link-active router-link-exact-active toc-link level2">3. 数据</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_3-1-intent-传递数据太大-报-transactiontoolargeexception-异常" class="router-link-active router-link-exact-active toc-link level3">3.1 Intent 传递数据太大，报 TransactionTooLargeException 异常</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_4-context" class="router-link-active router-link-exact-active toc-link level2">4. Context</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_4-1-context-的继承关系" class="router-link-active router-link-exact-active toc-link level3">4.1 Context 的继承关系</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-进程" class="router-link-active router-link-exact-active toc-link level2">5. 进程</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-1-进程优先级" class="router-link-active router-link-exact-active toc-link level3">5.1 进程优先级</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-进程分类" class="router-link-active router-link-exact-active toc-link level3">5.2 进程分类</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-1-前台进程-foreground-process" class="router-link-active router-link-exact-active toc-link level4">5.2.1 前台进程（Foreground Process）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-2-可见进程-visible-process" class="router-link-active router-link-exact-active toc-link level4">5.2.2 可见进程（Visible Process）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-3-服务进程-service-process" class="router-link-active router-link-exact-active toc-link level4">5.2.3 服务进程（Service Process）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-4-后台进程-background-process" class="router-link-active router-link-exact-active toc-link level4">5.2.4 后台进程（Background Process）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/activity.html#_5-2-5-空进程-empty-process" class="router-link-active router-link-exact-active toc-link level4">5.2.5 空进程（Empty Process）</a></li><!----><!--]--></ul><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><p>参考：<a href="https://blog.csdn.net/qq_43377749/article/details/102728995" target="_blank" rel="noopener noreferrer">Activity 的 36 大难点，你会几个？「建议收藏」<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>参考：《<code>Android</code> 开发艺术探索》 第 <code>1</code> 章（<code>Activity</code> 的生命周期和启动模式）</p><h2 id="_1-生命周期" tabindex="-1"><a class="header-anchor" href="#_1-生命周期" aria-hidden="true">#</a> 1. 生命周期</h2><h3 id="_1-1-生命周期切换过程" tabindex="-1"><a class="header-anchor" href="#_1-1-生命周期切换过程" aria-hidden="true">#</a> 1.1 生命周期切换过程</h3><p><img src="/assets/01.9e712c65.png" alt="" loading="lazy"></p><h3 id="_1-2-正常生命周期" tabindex="-1"><a class="header-anchor" href="#_1-2-正常生命周期" aria-hidden="true">#</a> 1.2 正常生命周期</h3><h4 id="_1-2-1-oncreate" tabindex="-1"><a class="header-anchor" href="#_1-2-1-oncreate" aria-hidden="true">#</a> 1.2.1 <code>onCreate</code></h4><p>表示 <code>Activity</code> 正在被创建，这是生命周期的第一个方法。</p><p>在这个方法中，我们可以做一些初始化工作，比如：</p><ol><li>调用 <code>setContentView</code> 去加载界面布局资源；</li><li>初始化 <code>Activity</code> 所需数据等。</li></ol><h4 id="_1-2-2-onrestart" tabindex="-1"><a class="header-anchor" href="#_1-2-2-onrestart" aria-hidden="true">#</a> 1.2.2 <code>onRestart</code></h4><p>表示 <code>Activity</code> 正在重新启动。</p><p>一般情况下，当 <code>Activity</code> 从不可见重新变为可见状态时，<code>onRestart</code> 就会被调用。</p><blockquote><p>这种情况一般是用户行为所导致的，比如：当用户按 <code>Home</code> 键切换到桌面，或者用户打开了一个新的 <code>Activity</code> 时，原来的 <code>Activity</code> 会暂停，于是原来的 <code>Activity</code> 执行 <code>onPause</code> 和 <code>onStop</code>。接着，当用户又回到原来的 <code>Activity</code> 时，原来的 <code>Activity</code> 就会执行 <code>onRestart</code>。</p></blockquote><h4 id="_1-2-3-onstart" tabindex="-1"><a class="header-anchor" href="#_1-2-3-onstart" aria-hidden="true">#</a> 1.2.3 <code>onStart</code></h4><p>表示 <code>Activity</code> 正在被启动。此时，<code>Activity</code> 已经可见了，但是 <code>Activity</code> 还没有出现在前台，无法与用户交互。</p><h4 id="_1-2-4-onresume" tabindex="-1"><a class="header-anchor" href="#_1-2-4-onresume" aria-hidden="true">#</a> 1.2.4 <code>onResume</code></h4><p>表示 <code>Activity</code> 已经可见了，并出现在前台，且可以和与用户交互了。</p><blockquote><p>注意与 <code>onStart</code> 的对比：</p><p><code>onStart</code> 和 <code>onResume</code> 都表示 <code>Activity</code> 已经可见，但是 <code>onStart</code> 时 <code>Activity</code> 还在后台；<code>onResume</code> 时才显示到前台。</p></blockquote><h4 id="_1-2-5-onpause" tabindex="-1"><a class="header-anchor" href="#_1-2-5-onpause" aria-hidden="true">#</a> 1.2.5 <code>onPause</code></h4><p>表示 <code>Activity</code> 正在停止。</p><p>此时可以做一些存储数据、停止动画等操作。但不能太耗时，因为这会影响到新的 <code>Activity</code> 的显示。</p><p>注意：<strong><code>onPause</code> 必须先执行完，新 <code>Activity</code> 的 <code>onResume</code> 才会执行</strong>。</p><h4 id="_1-2-6-onstop" tabindex="-1"><a class="header-anchor" href="#_1-2-6-onstop" aria-hidden="true">#</a> 1.2.6 <code>onStop</code></h4><p>表示 <code>Activity</code> 即将停止，可以做一些稍微重量级的回收工作，同样不能太耗时。</p><h4 id="_1-2-7-ondestroy" tabindex="-1"><a class="header-anchor" href="#_1-2-7-ondestroy" aria-hidden="true">#</a> 1.2.7 <code>onDestroy</code></h4><p>表示 <code>Activity</code> 即将被销毁，这是 <code>Activity</code> 生命周期中的最后一个回调。</p><p>在这里，可以做一些回收工作和最终的资源释放。</p><h4 id="_1-2-8-具体场景分析" tabindex="-1"><a class="header-anchor" href="#_1-2-8-具体场景分析" aria-hidden="true">#</a> 1.2.8 具体场景分析</h4><h5 id="_1-2-8-1-activity-第一次启动时" tabindex="-1"><a class="header-anchor" href="#_1-2-8-1-activity-第一次启动时" aria-hidden="true">#</a> 1.2.8.1 <code>Activity</code> 第一次启动时</h5><div class="language-text ext-text"><pre class="language-text"><code>onCreate -&gt; onStart -&gt; onResume
</code></pre></div><h5 id="_1-2-8-2-activity-退到后台-切换到桌面-or-跳转到其它-activity" tabindex="-1"><a class="header-anchor" href="#_1-2-8-2-activity-退到后台-切换到桌面-or-跳转到其它-activity" aria-hidden="true">#</a> 1.2.8.2 <code>Activity</code> 退到后台（切换到桌面 or 跳转到其它 <code>Activity</code>）</h5><div class="language-text ext-text"><pre class="language-text"><code>onPause -&gt; onStop
</code></pre></div><h5 id="_1-2-8-3-跳转到采用了透明主题的其它-activity" tabindex="-1"><a class="header-anchor" href="#_1-2-8-3-跳转到采用了透明主题的其它-activity" aria-hidden="true">#</a> 1.2.8.3 跳转到采用了透明主题的其它 <code>Activity</code></h5><div class="language-text ext-text"><pre class="language-text"><code>onPause
</code></pre></div><blockquote><p><code>A</code> 跳转到 <code>B</code> 时，若 <code>B</code> 采用了透明主题，则 <code>A</code> 仅回调 <code>onPause</code>，不回调 <code>onStop</code>。</p></blockquote><h5 id="_1-2-8-4-activity-回到前台-用户再次回到原-activity" tabindex="-1"><a class="header-anchor" href="#_1-2-8-4-activity-回到前台-用户再次回到原-activity" aria-hidden="true">#</a> 1.2.8.4 <code>Activity</code> 回到前台（用户再次回到原 <code>Activity</code>）</h5><div class="language-text ext-text"><pre class="language-text"><code>onRestart -&gt; onStart -&gt; onResume
</code></pre></div><h5 id="_1-2-8-5-锁屏-开屏" tabindex="-1"><a class="header-anchor" href="#_1-2-8-5-锁屏-开屏" aria-hidden="true">#</a> 1.2.8.5 锁屏 &amp; 开屏</h5><p>锁屏时：</p><div class="language-text ext-text"><pre class="language-text"><code>onPause -&gt; onStop
</code></pre></div><p>开屏时：</p><div class="language-text ext-text"><pre class="language-text"><code>onStart -&gt; onResume
</code></pre></div><h5 id="_1-2-8-6-用户按-back-按键回退时" tabindex="-1"><a class="header-anchor" href="#_1-2-8-6-用户按-back-按键回退时" aria-hidden="true">#</a> 1.2.8.6 用户按 <code>back</code> 按键回退时</h5><div class="language-text ext-text"><pre class="language-text"><code>onPause -&gt; onStop -&gt; onDestroy
</code></pre></div><h3 id="_1-3-异常生命周期" tabindex="-1"><a class="header-anchor" href="#_1-3-异常生命周期" aria-hidden="true">#</a> 1.3 异常生命周期</h3><h4 id="_1-3-1-资源相关的系统配置改变导致-activity-销毁重建-如横竖屏切换" tabindex="-1"><a class="header-anchor" href="#_1-3-1-资源相关的系统配置改变导致-activity-销毁重建-如横竖屏切换" aria-hidden="true">#</a> 1.3.1 资源相关的系统配置改变导致 <code>Activity</code> 销毁重建（如横竖屏切换）</h4><h5 id="_1-3-1-1-onsaveinstancestate-onrestoreinstancestate" tabindex="-1"><a class="header-anchor" href="#_1-3-1-1-onsaveinstancestate-onrestoreinstancestate" aria-hidden="true">#</a> 1.3.1.1 <code>onSaveInstanceState</code> &amp; <code>onRestoreInstanceState</code></h5><p>当 <code>Activity</code> 从竖屏切换到横屏时，系统配置发生了改变，此时需要去加载适配横屏的资源目录中的图片。默认情况下，<code>Activity</code> 就会被销毁并且重新创建，其生命周期如下：</p><div class="md-enhance-mermaid loading" data-code="flowchart%20LR%0A%20%20%20%20A1(%5BActivity%5D)%0A%20%20%20%20A2(%5BActivity%5D)%0A%20%20%20%20A1cb1(onSaveInstanceState)%0A%20%20%20%20A1cb2(onStop)%0A%20%20%20%20A1cb3(onDestroy)%0A%20%20%20%20A2cb1(onCreate)%0A%20%20%20%20A2cb2(onStart)%0A%20%20%20%20A2cb3(onRestoreInstanceState)%0A%20%20%20%20A2cb4(onResume)%0A%0A%20%20%20%20subgraph%20S1%0A%20%20%20%20%20%20%20%20A1%20--%20%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B5%20--%3E%20A1cb1%20--%3E%20A1cb2%20--%3E%20A1cb3%20%20%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20S2%0A%20%20%20%20%20%20%20%20A2%20--%3E%20A2cb1%20--%3E%20A2cb2%20--%3E%20A2cb3%20--%3E%20A2cb4%0A%20%20%20%20end%0A%0A%20%20%20%20S1%20--%20%E9%87%8D%E6%96%B0%E5%88%9B%E5%BB%BA%20--%3E%20S2%0A"><svg xmlns="http://www.w3.org/2000/svg" class="icon loading-icon" viewbox="0 0 1024 1024" arialabelledby="loading"><title id="loading" lang="en">loading icon</title><g fill="currentColor"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="0s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="0s"></animate></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="-0.333s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="-0.333s"></animate></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="-0.667s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="-0.667s"></animate></circle></g></svg></div><p>如上图所示：</p><ol><li><p>当系统配置发生改变后，<code>Activity</code> 会被销毁，其 <code>onPause</code>、<code>onStop</code>、<code>onDestroy</code> 均会被调用，同时由于 <code>Activity</code> 是在异常情况下终止的，系统会调用 <code>onSaveInstanceState</code> 来保存当前 <code>Activity</code> 的状态。</p><blockquote><p>只有在 <code>Activity</code> 被异常终止的情况下才会回调 <code>onSaveInstanceState</code> 方法，正常情况下系统不会回调这个方法。</p><p>系统只会在 <code>Activity</code> 即将被销毁并且有机会重新显示的情况下才会去调用 <code>onSaveInstanceState</code>。当 <code>Activity</code> 正常销毁的时候，系统不会调用 <code>onSaveInstanceState</code>，因为被销毁的 <code>Activity</code> 不可能再次被显示。</p></blockquote></li><li><p><code>onSaveInstanceState</code> 方法的调用时机是在 <code>onStop</code> 之前，但它和 <code>onPause</code> 没有既定的时序关系，即：它既可能在 <code>onPause</code> 之前调用，也可能在 <code>onPause</code> 之后调用。</p></li><li><p>当 <code>Activity</code> 被重新创建后，系统会调用 <code>onRestoreInstanceState</code>，并且把 <code>Activity</code> 销毁时 <code>onSaveInstanceState</code> 方法所保存的 <code>Bundle</code> 对象作为参数同时传递给 <code>onRestoreInstanceState</code> 和 <code>onCreate</code> 方法。</p></li><li><p><code>onRestoreInstanceState</code> 的调用时机在 <code>onStart</code> 之后，<code>onResume</code> 之前。</p></li></ol><h5 id="_1-3-1-2-view-层次结构的保存与恢复-委托思想" tabindex="-1"><a class="header-anchor" href="#_1-3-1-2-view-层次结构的保存与恢复-委托思想" aria-hidden="true">#</a> 1.3.1.2 <code>View</code> 层次结构的保存与恢复 &amp; 委托思想</h5><p>在 <code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code> 方法中，系统自动为我们做了一定的恢复工作。</p><p>比如：当 <code>Activity</code> 在异常情况下需要重新创建时，系统会默认为我们保存当前 <code>Activity</code> 的视图结构，并且在 <code>Activity</code> 重启后为我们恢复这些数据，包括：文本框中用户输入的数据、<code>ListView</code> 滚动的位置等。</p><blockquote><p>和 <code>Activity</code> 一样，每个 View 都有 <code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code> 这两个方法，看一下它们的具体实现，就能知道系统能够自动为每个View恢复哪些数据。</p></blockquote><p>关于保存和恢复 <code>View</code> 层次结构，系统的工作流程是这样的：</p><ol><li><p>首先 <code>Activity</code> 被意外终止时，<code>Activity</code> 会调用 <code>onSaveInstanceState</code> 去保存数据；</p></li><li><p>然后 <code>Activity</code> 会委托 <code>Window</code> 去保存数据；</p></li><li><p>接着 <code>Window</code> 再委托它上面的顶级容器去保存数据。</p><blockquote><p>顶层容器是一个 <code>ViewGroup</code>，一般来说它很可能是 <code>DecorView</code>。</p></blockquote></li><li><p>最后顶层容器再去一一通知它的子元素来保存数据。</p></li></ol><p>这样整个数据保存过程就完成了（数据恢复过程也是类似的）。可以发现，这是一种典型的委托思想，上层委托下层、父容器委托子元素去处理一件事情。</p><blockquote><p>这种思想在 <code>Android</code> 中有很多应用，比如 <code>View</code> 的绘制过程、事件分发等都是采用类似的思想。</p></blockquote><h5 id="_1-3-1-3-横竖屏切换时阻止-activity-的销毁重建-configchanges-属性" tabindex="-1"><a class="header-anchor" href="#_1-3-1-3-横竖屏切换时阻止-activity-的销毁重建-configchanges-属性" aria-hidden="true">#</a> 1.3.1.3 横竖屏切换时阻止 <code>Activity</code> 的销毁重建 &amp; <code>configChanges</code> 属性</h5><p>当资源相关的系统配置发生改变时，系统默认的处理方式是将 <code>Activity</code> 销毁重建。</p><p>但是，可以在 <code>AndroidManifest.xml</code> 文件中通过为 <code>&lt;activity&gt;</code> 标签设置属性 <code>android:configChanges</code> 来指定需要在变更时自行处理的系统配置。对于自行处理的系统配置，在变更时将阻止 <code>Activity</code> 销毁重建，而是让 <code>Activity</code> 保持运行状态，并回调此 <code>Activity</code> 的 <code>onConfigurationChanged</code> 方法。</p><p><code>android:configChanges</code> 属性中可指定的系统配置如下：</p><table><thead><tr><th style="text-align:left;">系统配置</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>density</code></td><td style="text-align:left;">显示密度发生变更 - 用户可能已指定不同的显示比例，或者有不同的显示现处于活跃状态。</td></tr><tr><td style="text-align:left;"><code>fontScale</code></td><td style="text-align:left;">字体缩放系数发生变更 - 用户已选择新的全局字号。</td></tr><tr><td style="text-align:left;"><code>keyboard</code></td><td style="text-align:left;">键盘类型发生变更 - 例如，用户插入外置键盘。</td></tr><tr><td style="text-align:left;"><code>keyboardHidden</code></td><td style="text-align:left;">键盘无障碍功能发生变更 - 例如，用户显示硬键盘。</td></tr><tr><td style="text-align:left;"><code>layoutDirection</code></td><td style="text-align:left;">布局方向发生变更 - 例如，自从左至右 (<code>LTR</code>) 更改为从右至左 (<code>RTL</code>)。</td></tr><tr><td style="text-align:left;"><code>locale</code></td><td style="text-align:left;">语言区域发生变更 - 用户已为文本选择新的显示语言。</td></tr><tr><td style="text-align:left;"><code>mcc</code></td><td style="text-align:left;"><code>IMSI</code> 移动设备国家/地区代码 (<code>MCC</code>) 发生变更 - 检测到 <code>SIM</code> 并更新 <code>MCC</code>。</td></tr><tr><td style="text-align:left;"><code>mnc</code></td><td style="text-align:left;"><code>IMSI</code> 移动设备网络代码 (<code>MNC</code>) 发生变更 - 检测到 <code>SIM</code> 并更新 <code>MNC</code>。</td></tr><tr><td style="text-align:left;"><code>navigation</code></td><td style="text-align:left;">导航类型（轨迹球/方向键）发生变更。（这种情况通常不会发生。）</td></tr><tr><td style="text-align:left;"><code>orientation</code></td><td style="text-align:left;">屏幕方向发生变更 - 用户旋转设备。</td></tr><tr><td style="text-align:left;"><code>screenLayout</code></td><td style="text-align:left;">屏幕布局发生变更 - 现处于活跃状态的可能是其他显示模式。</td></tr><tr><td style="text-align:left;"><code>screenSize</code></td><td style="text-align:left;">当前可用屏幕尺寸发生变更。该值表示目前可用尺寸相对于当前宽高比的变更，当用户在横向模式与纵向模式之间切换时，它便会发生变更。在 <code>API</code> 级别 <code>13</code> 中引入。</td></tr><tr><td style="text-align:left;"><code>smallestScreenSize</code></td><td style="text-align:left;">物理屏幕尺寸发生变更。该值表示与方向无关的尺寸变更，因此它只有在实际物理屏幕尺寸发生变更（如切换到外部显示器）时才会变化。</td></tr><tr><td style="text-align:left;"><code>touchscreen</code></td><td style="text-align:left;">触摸屏发生变更。（这种情况通常不会发生。）</td></tr><tr><td style="text-align:left;"><code>uiMode</code></td><td style="text-align:left;">界面模式发生变更 - 用户已将设备置于桌面或车载基座，或者夜间模式发生变更。</td></tr></tbody></table><p>为了阻止横竖屏切换时导致 <code>Activity</code> 销毁重建，我们可以设置 <code>android:configChanges</code> 属性为：</p><div class="language-xml ext-xml"><pre class="language-xml"><code>android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot;
</code></pre></div><h4 id="_1-3-2-系统内存不足导致低优先级的-activity-所在进程被杀死" tabindex="-1"><a class="header-anchor" href="#_1-3-2-系统内存不足导致低优先级的-activity-所在进程被杀死" aria-hidden="true">#</a> 1.3.2 系统内存不足导致低优先级的 <code>Activity</code> 所在进程被杀死</h4><p>这种情况我们不好模拟，但是其数据存储和恢复过程和 <a href="#_1-3-1-%E8%B5%84%E6%BA%90%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E6%94%B9%E5%8F%98%E5%AF%BC%E8%87%B4-activity-%E9%94%80%E6%AF%81%E9%87%8D%E5%BB%BA-%E5%A6%82%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2"><code>1.3.1</code></a> 完全一致。</p><p>这里我们描述一下 <code>Activity</code> 的优先级情况。<code>Activity</code> 按照优先级从高到低，可以分为如下 <code>3</code> 种：</p><ol><li><p>前台 <code>Activity</code>：正在和用户交互的 <code>Activity</code>，优先级最高。</p></li><li><p>可见但非前台 <code>Activity</code>：比如 <code>Activity</code> 中弹出了一个对话框，导致 <code>Activity</code> 可见但是位于后台无法和用户直接交互。</p></li><li><p>后台 <code>Activity</code>：已经被暂停的 <code>Activity</code>，比如执行了 <code>onStop</code>，优先级最低。</p></li></ol><p>当系统内存不足时，系统就会按照上述优先级去杀死目标 <code>Activity</code> 所在的 <strong>进程</strong>，并在后续通过 <code>onSaveInstanceState</code> 和 <code>onRestoreInstanceState</code> 来存储和恢复数数据。</p><p>如果一个进程中没有四大组件在执行，那么这个进程将很快被系统杀死，因此，一些后台工作不适合脱离四大组件而独自运行在后台中，这样进程很容易被杀死。</p><p>比较好的方法是将后台工作放入 <code>Service</code> 中从而保证进程有一定的优先级，这样就不会轻易地被系统杀死。</p><h3 id="_1-4-将一个-activity-设置成窗口的样式" tabindex="-1"><a class="header-anchor" href="#_1-4-将一个-activity-设置成窗口的样式" aria-hidden="true">#</a> 1.4 将一个 <code>Activity</code> 设置成窗口的样式</h3><p>只需要在 <code>AndroidManifest.xml</code> 文件中将 <code>Activity</code> 设置成 <code>Dialog</code> 主题即可：</p><div class="language-xml ext-xml"><pre class="language-xml"><code>android:theme=&quot;@android:style/Theme.Dialog&quot;
</code></pre></div><h3 id="_1-5-退出已调用多个-activity-的-application" tabindex="-1"><a class="header-anchor" href="#_1-5-退出已调用多个-activity-的-application" aria-hidden="true">#</a> 1.5 退出已调用多个 <code>Activity</code> 的 <code>Application</code></h3><p>有如下 <code>4</code> 种方式：</p><ol><li><p>发送特定广播：在需要结束应用时，发送一个特定的广播，每个 <code>Activity</code> 收到广播后关闭即可。</p></li><li><p>递归退出：在打开新的 <code>Activity</code> 时都使用 <code>startActivityForResult</code> 加上标志。关闭新的 <code>Activity</code> 时，在上一个 <code>Activity</code> 的 <code>onActivityResult</code> 方法中处理标志，递归关闭。</p></li><li><p>通过 <code>Intent</code> 的 <code>flag</code> 实现：在跳转 <code>Activity</code> 时，设置 <code>intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP)</code>。此时如果当前任务栈中已经有该 <code>Activity</code>，那么系统会把这个 <code>Activity</code> 上面的所有 <code>Activity</code> 干掉。</p><blockquote><p>其实相当于给 <code>Activity</code> 配置的启动模式为 <code>singleTask</code> 。</p></blockquote></li><li><p>记录打开的 <code>Activity</code>：每打开一个 <code>Activity</code>，就记录下来。在需要退出时，关闭每一个记录了的 <code>Activity</code>。</p></li></ol><h3 id="_1-6-修改-activity-进入和退出动画" tabindex="-1"><a class="header-anchor" href="#_1-6-修改-activity-进入和退出动画" aria-hidden="true">#</a> 1.6 修改 <code>Activity</code> 进入和退出动画</h3><p>有两种方式：</p><ol><li><p>在 <code>style.xml</code> 中设置过渡动画</p><div class="language-xml ext-xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AppTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Theme.AppCompat.Light.NoActionBar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 启用窗口内容过渡 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android:windowActivityTransitions<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定进入和退出过渡 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android:windowEnterTransition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@transition/explode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android:windowExitTransition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@transition/explode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li><li><p>调用 <code>overridePendingTransition</code> 方法设置过渡动画</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Activity.java */</span>
<span class="token comment">/*
    overridePendingTransition 方法的调用场景可分为两种：

        1. 在 finish 方法后调用，此时：
           1. 参数 enterAnim 表示当前 Activity 退出后将要显示出来的 Activity 的进场动画
           2. 参数 exitAnim 表示当前 Activity 退出时的动画
           
        2. 在 startActivity 方法后调用，此时：
           1. 参数 enterAnim 表示跳转的 Activity 的进场动画
           2. 参数 exitAnim 表示当前 Activity 退出时的动画
*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">overridePendingTransition</span><span class="token punctuation">(</span><span class="token keyword">int</span> enterAnim<span class="token punctuation">,</span> <span class="token keyword">int</span> exitAnim<span class="token punctuation">)</span>
</code></pre></div><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* 示例：在 finish 方法后调用 */</span>
<span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">overridePendingTransition</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_enter<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_exit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* 示例：在 startActivity 方法后调用 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&lt;</span> <span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION_CODES</span><span class="token punctuation">.</span><span class="token constant">JELLY_BEAN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// API LEVEL &lt; 16</span>
    <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">XxxActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">overridePendingTransition</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_enter<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_exit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token class-name">Bundle</span> optionsBundle <span class="token operator">=</span> <span class="token class-name">ActivityOptionsCompat</span><span class="token punctuation">.</span><span class="token function">makeCustomAnimation</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">,</span>
        <span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_enter<span class="token punctuation">,</span>
        <span class="token class-name">R</span><span class="token punctuation">.</span>anim<span class="token punctuation">.</span>activity_exit
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">XxxActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> optionsBundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h2 id="_2-启动模式" tabindex="-1"><a class="header-anchor" href="#_2-启动模式" aria-hidden="true">#</a> 2. 启动模式</h2><h3 id="_2-1-为什么需要启动模式" tabindex="-1"><a class="header-anchor" href="#_2-1-为什么需要启动模式" aria-hidden="true">#</a> 2.1 为什么需要启动模式</h3><p>在默认的启动模式下，当我们多次启动同一个 <code>Activity</code> 时，系统会创建多个实例并把它们一一放入任务栈中。</p><blockquote><p>任务栈是一种后进先出的栈结构，每按一下 <code>back</code> 键就会有一个 <code>Activity</code> 出栈，直到栈空为止，当栈中无任何 <code>Activity</code> 的时候，系统就会回收这个任务栈。</p></blockquote><p>但有时候，在多次启动同一个 <code>Activity</code> 时，我们并不想让系统在每次启动时都创建一个新的 <code>Activity</code> 实例，而是可以根据情况选择复用已启动的 <code>Activity</code> 实例。为了满足这种需求，Android 系统提供了四种启动模式来改变系统的默认行为。</p><h3 id="_2-2-四种启动模式" tabindex="-1"><a class="header-anchor" href="#_2-2-四种启动模式" aria-hidden="true">#</a> 2.2 四种启动模式</h3><h4 id="_2-2-1-standard-标准模式" tabindex="-1"><a class="header-anchor" href="#_2-2-1-standard-标准模式" aria-hidden="true">#</a> 2.2.1 <code>standard</code>（标准模式）</h4><p>系统的默认模式。</p><p>不管被启动的 <code>Activity</code> 实例是否已存在，每次启动 <code>Activity</code> 时都会重新创建一个新的实例。</p><p>被创建的 <code>Activity</code> 实例的生命周期方法回调流程为：<code>onCreate -&gt; onStart -&gt; onResume</code>。</p><p><code>standard</code> 模式是一种典型的多实例实现，即：</p><ol><li><p>一个任务栈中可以有多个实例；</p></li><li><p>多个实例也可以属于不同的任务栈。</p></li></ol><h4 id="_2-2-1-1-standard-模式启动的-activity-默认进入当前-context-的任务栈中" tabindex="-1"><a class="header-anchor" href="#_2-2-1-1-standard-模式启动的-activity-默认进入当前-context-的任务栈中" aria-hidden="true">#</a> 2.2.1.1 <code>standard</code> 模式启动的 <code>Activity</code> 默认进入当前 <code>Context</code> 的任务栈中</h4><p><code>standard</code> 模式下启动的 <code>Activity</code>，默认存放在当前 <code>Context</code> 的任务栈。</p><p><code>Activity</code> 是一种具有任务栈的 <code>Context</code>，在 <code>Activity</code> 中采用 <code>standard</code> 模式启动另一个 <code>Activity</code> 时，被启动的 <code>Activity</code> 默认和启动它的当前 <code>Activity</code> 存放在同一个任务栈中。</p><h4 id="_2-2-1-2-standard-模式启动时-context-无任务栈的解决方案" tabindex="-1"><a class="header-anchor" href="#_2-2-1-2-standard-模式启动时-context-无任务栈的解决方案" aria-hidden="true">#</a> 2.2.1.2 <code>standard</code> 模式启动时 <code>Context</code> 无任务栈的解决方案</h4><p>除了 <code>Activity</code> 之外的其他 <code>Context</code> 都不具备任务栈（如：<code>Service</code>，<code>Application</code> 都不具备任务栈）。</p><p>因此，当在 <code>Service</code> 或 <code>Application</code> 中采用 <code>standard</code> 模式启动 <code>Activity</code> 时，会抛出异常。</p><p>此时，就不能采用 <code>standard</code> 模式来启动 <code>Activity</code> 了，而是通过给 <code>Intent</code> 指定 <code>FLAG_ACTIVITY_NEW_TASK</code> 标记位，采用 <code>singleTask</code> 模式来启动 <code>Activity</code>。</p><h4 id="_2-2-2-singletop-栈顶复用模式" tabindex="-1"><a class="header-anchor" href="#_2-2-2-singletop-栈顶复用模式" aria-hidden="true">#</a> 2.2.2 <code>singleTop</code>（栈顶复用模式）</h4><p>在这种模式下启动的 <code>Activity</code>：</p><ol><li><p>如果 <code>Activity</code> 实例已位于任务栈的栈顶，那么此 <code>Activity</code> 不会被重新创建，不会回调 <code>onCreate -&gt; onStart</code>。而是回调 <code>onNewIntent -&gt; onResume</code>。其中，通过 <code>onNewIntent(Intent)</code> 方法的参数 <code>Intent</code> 我们可以取出启动时传递的参数。</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈为： A-B-C-D，其中 D 位于栈顶，此时：
1. 如果以 singleTop 模式启动 D，则栈内情况为：A-B-C-D
2. 如果以 standard 模式启动 D，则栈内情况为： A-B-C-D-D
</code></pre></div></li><li><p>如果 <code>Activity</code> 实例已位于任务栈，但不在栈顶，那么为这个 <code>Activity</code> 重新创建一个实例并放入到栈顶。而之前已位于任务栈中的 <code>Activity</code> 实例原封不动。（此情况下，相当于 <code>standard</code> 模式）</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈为： A-B-C-D，其中 D 位于栈顶，此时：
1. 如果以 singleTop 模式启动 A，则栈内情况为：A-B-C-D-A
2. 如果以 standard 模式启动 A，则栈内情况为： A-B-C-D-A
</code></pre></div></li></ol><h4 id="_2-2-3-singletask-栈内复用模式" tabindex="-1"><a class="header-anchor" href="#_2-2-3-singletask-栈内复用模式" aria-hidden="true">#</a> 2.2.3 <code>singleTask</code>（栈内复用模式）</h4><p>是一种单实例模式。</p><p>在这种模式下启动的 <code>Activity</code>，只要 <code>Activity</code> 实例已位于任务栈中，不管在不在栈顶，此 <code>Activity</code> 都不会被重新创建，不会回调 <code>onCreate -&gt; onStart</code>。而是回调 <code>onNewIntent -&gt; onResume</code>。</p><p>具体地说，当采用 <code>singleTask</code> 模式启动 <code>Activity</code> <code>D</code> 时，先查询 <code>D</code> 所需的任务栈是否存在：</p><ol><li><p>如果不存在，那么创建一个 <code>D</code> 所需的任务栈，同时创建 <code>D</code> 的实例并放入到该任务栈中。</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈 S1 为： A-B-C，其中 C 位于栈顶，
此时采用 singleTask 模式启动 D，且 D 所需的任务栈为 S2，
由于 S2 和 D 的实例都不存在，所以会先创建任务栈 S2，再创建 D 的实例并放入到任务栈 S2 中
最终任务栈的情况为：
    S1：A-B-C
    S2：D
</code></pre></div></li><li><p>如果存在，那么判断已存在的任务栈中是否保存有 <code>D</code> 的实例：</p><ol><li><p>若已存在的任务栈中没有保存 <code>D</code> 的实例，则创建 <code>D</code> 的实例并放入到任务栈中；</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈 S1 为： A-B-C，其中 C 位于栈顶，
此时采用 singleTask 模式启动 D，且 D 所需的任务栈为 S1，
由于 S1 存在，但 D 的实例不存在，所以创建 D 的实例并放入到任务栈 S1 中
最终任务栈的情况为：
    S1：A-B-C-D
</code></pre></div></li><li><p>若已存在的任务栈中保存有 <code>D</code> 的实例，则不会再创建 <code>D</code> 的实例，而是将 <code>D</code> 移到栈顶（为了将 <code>D</code> 移到栈顶，会将 <code>D</code> 上面的其他 <code>Activity</code> 都移出任务栈，即 <code>clearTop</code>），并回调 <code>D</code> 的 <code>onNewIntent -&gt; onResume</code> 方法。</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈 S1 为： A-B-C-D-E-F，其中 F 位于栈顶，
此时采用 singleTask 模式启动 D，且 D 所需的任务栈为 S1，
由于 S1 存在，且 D 的实例也存在，所以将 D 移到 S1 的栈顶，同时将 D 上面的其他 Activity 从 S1 中移除
最终任务栈的情况为：
    S1：A-B-C-D
</code></pre></div></li></ol></li></ol><h4 id="_2-2-4-singleinstance-单实例模式" tabindex="-1"><a class="header-anchor" href="#_2-2-4-singleinstance-单实例模式" aria-hidden="true">#</a> 2.2.4 <code>singleInstance</code>（单实例模式）</h4><p>采用 <code>singleInstance</code> 模式启动的 <code>Activity</code> 独自位于一个任务栈中，即：</p><ol><li><p>若 <code>Activity</code> 所需的任务栈不存在，则先创建任务栈，再创建 <code>Activity</code> 实例并放入到栈中；</p></li><li><p>若 <code>Activity</code> 所需的任务栈存在，由于该任务栈只能用来存放此 <code>Activity</code> 的实例，所以任务栈存在，则说明 <code>Activity</code> 实例存在，因此不会创建 <code>Activity</code> 实例，而是回调此 <code>Activity</code> 的 <code>onNewIntent -&gt; onResume</code> 方法。</p></li></ol><p>注意：当在 <code>singleInstance</code> 模式启动的 <code>Activity</code> <code>A</code> 中，以 <code>standard</code> 模式去启动 <code>Activity</code> <code>B</code> 时，虽然 <code>standard</code> 模式下 <code>B</code> 默认应该与 <code>A</code> 在同一个任务栈中，但由于 <code>A</code> 所在的任务栈只能存放一个 <code>A</code> 实例，所以此时会将 <code>B</code> 放入到一个新创建的任务栈中。</p><h3 id="_2-3-给-activity-指定启动模式的两种方式" tabindex="-1"><a class="header-anchor" href="#_2-3-给-activity-指定启动模式的两种方式" aria-hidden="true">#</a> 2.3 给 Activity 指定启动模式的两种方式</h3><h4 id="_2-3-1-在-androidmanifest-xml-中通过-android-launchmode-属性指定" tabindex="-1"><a class="header-anchor" href="#_2-3-1-在-androidmanifest-xml-中通过-android-launchmode-属性指定" aria-hidden="true">#</a> 2.3.1 在 <code>AndroidManifest.xml</code> 中通过 <code>android:launchMode</code> 属性指定</h4><div class="language-xml ext-xml"><pre class="language-xml"><code>&lt;activity
    ...
    android:launchMode=[&quot;standard&quot; | &quot;singleTop&quot; | &quot;singleTask&quot; | &quot;singleInstance&quot;]
    .../&gt;
</code></pre></div><h4 id="_2-3-2-在代码中通过给-intent-设置的标志位指定" tabindex="-1"><a class="header-anchor" href="#_2-3-2-在代码中通过给-intent-设置的标志位指定" aria-hidden="true">#</a> 2.3.2 在代码中通过给 <code>Intent</code> 设置的标志位指定</h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setClass</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">SecondActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
    FLAG_ACTIVITY_SINGLE_TOP：singleTop 模式
    FLAG_ACTIVITY_NEW_TASK：singleTask 模式

    注意：此方式无法指定为 singleInstance 模式
*/</span>
intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-4-activity-的任务栈-taskaffinity-属性" tabindex="-1"><a class="header-anchor" href="#_2-4-activity-的任务栈-taskaffinity-属性" aria-hidden="true">#</a> 2.4 <code>Activity</code> 的任务栈 &amp; <code>taskAffinity</code> 属性</h3><p>任务栈分为前台任务栈和后台任务栈，后台任务栈中的 <code>Activity</code> 位于暂停状态，用户可以通过切换将后台任务栈再次调到前台。如：</p><div class="language-text ext-text"><pre class="language-text"><code>假设任务栈 S1：A-B-C，C 位于栈顶。
当屏幕上显示 C 时，S1 是前台任务栈。
当在 C 中采用 singleTask 模式启动 D 时，假设 D 所需的任务栈为 S2。
于是先创建 S2，再创建 D 实例并放入到 S2 中。
D 启动并显示时，任务栈 S2 成为 前台任务栈，任务栈 S1 则切换成后台任务栈。
</code></pre></div><p><code>taskAffinity</code> 可以翻译为任务相关性。<code>taskAffinity</code> 属性用于指定 <code>Activity</code> 所需任务栈的名字。</p><p>默认情况下，所有 <code>Activity</code> 所需任务栈的名字都为应用的包名。</p><blockquote><p>也就是说，在没有使用 <code>taskAffinity</code> 属性为 <code>Activity</code> 指定任务栈时，除了 <code>singleInstance</code> 模式之外，<code>standard</code>、<code>singleTop</code>、<code>singleTask</code> 这三种模式下启动的 <code>Activity</code> 都只可能位于同一个任务栈中，且任务栈名 = 包名。</p></blockquote><p>注意：</p><ol><li><p><code>taskAffinity</code> 属性的值为字符串，且中间必须含有包名分隔符 &quot;<code>.</code>&quot;</p></li><li><p>当通过 <code>taskAffinity</code> 属性为 <code>Activity</code> 单独指定包名时，属性值不能和包名相同，否则就相当于没有指定。</p></li><li><p><code>taskAffinity</code> 属性主要和 <code>singleTask</code> 启动模式或者 <code>allowTaskReparenting</code> 属性配对使用，在其他情况下没有意义。</p></li></ol><h4 id="_2-4-1-taskaffinity-属性-singletask-模式结合使用" tabindex="-1"><a class="header-anchor" href="#_2-4-1-taskaffinity-属性-singletask-模式结合使用" aria-hidden="true">#</a> 2.4.1 <code>taskAffinity</code> 属性 &amp; <code>singleTask</code> 模式结合使用</h4><p>指定采用 <code>singleTask</code> 模式启动的 <code>Activity</code> 所需的任务栈的名字。从而可以让 <code>Activity</code> 运行在一个名称不同于包名的任务栈中。</p><h4 id="_2-4-2-taskaffinity-属性-allowtaskreparenting-属性结合使用" tabindex="-1"><a class="header-anchor" href="#_2-4-2-taskaffinity-属性-allowtaskreparenting-属性结合使用" aria-hidden="true">#</a> 2.4.2 <code>taskAffinity</code> 属性 &amp; <code>allowTaskReparenting</code> 属性结合使用</h4><p>在 <code>Activity</code> <code>A</code> 中使用 <code>standard</code> 或 <code>singleTop</code> 模式启动 <code>Activity</code> <code>B</code> 时，<code>B</code> 会放入 <code>A</code> 所在的任务栈 <code>S1</code> 中，且在 <code>B</code> 的生命周期内一直存在于这个任务栈 <code>S1</code> 中。</p><p>但是，如果通过 <code>taskAffinity</code> 属性为 <code>B</code> 指定了一个不同于 <code>A</code> 的任务栈 <code>S2</code>，那么根据 <code>allowTaskReparenting</code> 属性，在 <code>B</code> 的生命周期内，<code>B</code> 所在的任务栈会有如下变化：</p><ol><li><p>如果 <code>allowTaskReparenting</code> 属性为 <code>false</code>（默认值），那么 <code>B</code> 的生命周期内一直存在于任务栈 <code>S1</code> 中，不会发生变化。</p></li><li><p>如果 <code>allowTaskReparenting</code> 属性为 <code>true</code>，那么启动 <code>B</code> 时，<code>B</code> 仍然位于 <code>S1</code> 中。但是，当把 <code>S1</code> 切换成后台任务栈，把 <code>S2</code> 切换成前台任务栈时，<code>B</code> 所在的任务栈会从 <code>S1</code> 转移至 <code>S2</code>，此时在 <code>S2</code> 作为前台任务栈时显示的就是 B。而当 <code>S1</code> 再次切换成前台任务栈时，就不会再显示 <code>B</code> 了。</p><div class="language-text ext-text"><pre class="language-text"><code>比如，电子邮件 App 中显示邮件内容的 Activity A 中包含网页链接，点击该链接会启动可显示该网页的 Activity B。
而 B 应该是在浏览器 App 中定义的，即 A 和 B 属于不同的 App。
于是，A 和 B 所需的任务栈不同（任务栈名为各自所在 App 的包名，设 A 所需任务栈为 S1，B 所需任务栈为 S2）。
假设为 B 设置了 allowTaskReparenting 属性为 true，那么 B 所在的任务栈的变化过程为：
1. 在 A 中点击网页链接显示 B 时，B 位于 A 所在的任务栈 S1 的栈顶
2. 按 HOME 键回到桌面，S1 切换成后台任务栈
3. 点击浏览器 App 的桌面图标，于是创建了任务栈 S2，且任务栈 S2 切换成前台任务栈，
   此时 S1 中的 B 就会转移至 S2 的栈顶，从而将 B 显示出来。（注意：此时就不会启动浏览器 App 的主 Activity 了）
4. 当再次进入电子邮件 App 时，S1 切换成前台任务栈，但此时 B 已从 S1 中移除，所以不会再显示 B 了。
</code></pre></div></li></ol><h3 id="_2-5-示例" tabindex="-1"><a class="header-anchor" href="#_2-5-示例" aria-hidden="true">#</a> 2.5 示例</h3><h4 id="_2-5-1-示例-1-查看-activity-任务栈-dumpsys-命令" tabindex="-1"><a class="header-anchor" href="#_2-5-1-示例-1-查看-activity-任务栈-dumpsys-命令" aria-hidden="true">#</a> 2.5.1 示例 1：查看 <code>Activity</code> 任务栈 &amp; <code>dumpsys</code> 命令</h4><div class="language-xml ext-xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.chapter_1.MainActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orientation|screenSize<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>standard<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.MAIN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.LAUNCHER<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">setClass</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onNewIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNewIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;onNewIntent, time=&quot;</span> <span class="token operator">+</span> intent<span class="token punctuation">.</span><span class="token function">getLongExtra</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>MainActivity</code> 指定为 <code>standard</code> 模式，此时，连续点击三次按钮启动 <code>3</code> 次 <code>MainActivity</code>。算上原本的 <code>MainActvity</code> 实例，任务栈中应该有 <code>4</code> 个 <code>MainActivity</code> 的实例，执行 <code>adb shell dumpsys activity</code> 命令的日志如下：</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property">Running activities (most recent first):</span>
     TaskRecord<span class="token operator">{</span><span class="token number">41325370</span> <span class="token operator">#</span><span class="token number">17</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">}</span> <span class="token operator">#</span> 包名为 com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1 的 App 的主任务栈
       Run <span class="token operator">#</span><span class="token number">4</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41236968</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">3</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">411f4b30</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">2</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">411edcb8</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">1</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">411e7588</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
     TaskRecord<span class="token operator">{</span><span class="token number">4125abc8</span> <span class="token operator">#</span><span class="token number">2</span> A com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">}</span> <span class="token operator">#</span> 包名为 <span class="token domain constant">com.android.launcher</span> 的桌面 App 的主任务栈
       Run <span class="token operator">#</span><span class="token number">0</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">412381f8</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">/</span>com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>
       launcher2<span class="token punctuation">.</span>Launcher<span class="token operator">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><blockquote><p>可以看出，在名称为 <code>com.ryg.chapter_1</code> 的任务栈中，一共有 <code>4</code> 个 <code>MainActivity</code> 实例。</p></blockquote><p>将 <code>MainActivity</code> 指定为 <code>singleTask</code> 模式，此时，连续点击三次按钮启动 <code>3</code> 次 <code>MainActivity</code>。执行 <code>adb shell dumpsys activity</code> 命令的日志如下：</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token property">Running activities (most recent first):</span>
     TaskRecord<span class="token operator">{</span><span class="token number">41350dc8</span> <span class="token operator">#</span><span class="token number">9</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">1</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">412cc188</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
     TaskRecord<span class="token operator">{</span><span class="token number">4125abc8</span> <span class="token operator">#</span><span class="token number">2</span> A com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">0</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">412381f8</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">/</span>com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>
       launcher2<span class="token punctuation">.</span>Launcher<span class="token operator">}</span>
</code></pre></div><blockquote><p>可以看出，采用 <code>singleTask</code> 时，在名称为 <code>com.ryg.chapter_1</code> 的任务栈中，一共只有 <code>1</code> 个 <code>MainActivity</code> 实例。</p><p>查看 <code>logcat</code> 日志发现，<code>3</code> 次点击按钮启动 <code>MainActivity</code> 时，都回调了 <code>onNewIntent</code> 方法。</p><p><img src="/assets/02.13f92016.png" alt="" loading="lazy"></p></blockquote><h4 id="_2-5-2-示例-2-singletop-模式具有-cleartop-的效果" tabindex="-1"><a class="header-anchor" href="#_2-5-2-示例-2-singletop-模式具有-cleartop-的效果" aria-hidden="true">#</a> 2.5.2 示例 2：<code>singleTop</code> 模式具有 <code>clearTop</code> 的效果</h4><div class="language-xml ext-xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.chapter_1.MainActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orientation|screenSize<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>standard<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.MAIN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.LAUNCHER<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.chapter_1.SecondActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screenLayout<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>taskAffinity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.task1<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleTask<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.chapter_1.ThirdActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>configChanges</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screenLayout<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>taskAffinity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ryg.task1<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/app_name<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleTask<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>操作步骤为：</p><ol><li><p>在 <code>MainActivity</code> 中单击按钮启动 <code>SecondActivity</code></p></li><li><p>在 <code>SecondActivity</code> 中单击按钮启动 <code>ThirdActivity</code></p></li><li><p>在 <code>ThirdActivity</code> 中单击按钮又启动 <code>MainActivity</code></p></li><li><p>再在 <code>MainActivity</code> 中单击按钮启动 <code>SecondActivity</code></p></li><li><p>按返回键</p></li><li><p>再按返回键</p></li></ol><p>执行完第 <code>3</code> 步时，通过 <code>adb shell dumpsys activity</code> 命令打印日志如下：</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token property">Running activities (most recent first):</span>
    TaskRecord<span class="token operator">{</span><span class="token number">4132bd90</span> <span class="token operator">#</span><span class="token number">12</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>task1<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">4</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">4133fd18</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">3</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41349c58</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>ThirdActivity<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">2</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">4132bab0</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>SecondActivity<span class="token operator">}</span>
    TaskRecord<span class="token operator">{</span><span class="token number">4125a008</span> <span class="token operator">#</span><span class="token number">11</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">1</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41328c60</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
    TaskRecord<span class="token operator">{</span><span class="token number">41256440</span> <span class="token operator">#</span><span class="token number">2</span> A com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">0</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41231d30</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">/</span>com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher2<span class="token punctuation">.</span>Launcher<span class="token operator">}</span>
</code></pre></div><blockquote><p>分析：</p><ol><li><p><code>MainActivity</code> 作为主 <code>Activity</code>，且没有通过 <code>taskAffinity</code> 属性指定任务栈，所以 <code>App</code> 启动时，先启动 <code>MainActivity</code>，并放入到任务栈 <code>com.ryg.chapter_1</code> 中；</p></li><li><p><code>MainActivity</code> 中启动 <code>SecondActivity</code> 时，由于 <code>SecondActivity</code> 的启动模式为 <code>singleTask</code>，且通过 <code>taskAffinity</code> 属性指定任务栈为 <code>com.ryg.task1</code>，所以先创建任务栈 <code>com.ryg.task1</code>，再创建 <code>SecondActivity</code> 实例，并将 <code>SecondActivity</code> 实例放入任务栈 <code>com.ryg.task1</code> 中；</p></li><li><p><code>SecondActivity</code> 中启动 <code>ThirdActivity</code> 时，由于 <code>ThirdActivity</code> 的启动模式为 <code>singleTask</code>，且通过 <code>taskAffinity</code> 属性指定任务栈为 <code>com.ryg.task1</code>，即和 <code>SecondActivity</code> 在同一个任务栈中，此时任务栈 <code>com.ryg.task1</code> 中不存在 <code>ThirdActivity</code> 实例，所以创建 <code>ThirdActivity</code> 实例并放入任务栈 <code>com.ryg.task1</code> 中；</p></li><li><p><code>ThirdActivity</code> 中启动 <code>MainActivity</code> 时，由于 <code>MainActivity</code> 的启动模式为 <code>standard</code>，所以新创建 <code>MainActivity</code> 实例并放入到任务栈 <code>com.ryg.task1</code> 中。（注意：此时存在了两个位于不同任务栈的 <code>MainActivity</code> 实例了）&gt;</p></li></ol></blockquote><p>执行完第 <code>4</code> 步时，通过 <code>adb shell dumpsys activity</code> 命令打印日志如下：</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token property">Running activities (most recent first):</span>
    TaskRecord<span class="token operator">{</span><span class="token number">4132bd90</span> <span class="token operator">#</span><span class="token number">12</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>task1<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">2</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">4132bab0</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>SecondActivity<span class="token operator">}</span>
    TaskRecord<span class="token operator">{</span><span class="token number">4125a008</span> <span class="token operator">#</span><span class="token number">11</span> A com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">1</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41328c60</span> com<span class="token punctuation">.</span>ryg<span class="token punctuation">.</span>chapter_1<span class="token operator">/</span><span class="token punctuation">.</span>MainActivity<span class="token operator">}</span>
    TaskRecord<span class="token operator">{</span><span class="token number">41256440</span> <span class="token operator">#</span><span class="token number">2</span> A com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">}</span>
       Run <span class="token operator">#</span><span class="token number">0</span><span class="token operator">:</span> ActivityRecord<span class="token operator">{</span><span class="token number">41231d30</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher<span class="token operator">/</span>com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>launcher2<span class="token punctuation">.</span>Launcher<span class="token operator">}</span>
</code></pre></div><blockquote><p>分析：</p><ol><li>在位于任务栈 <code>com.ryg.task1</code> 中的 <code>MainActivity</code> 中启动 <code>SecondActivity</code> 时，由于任务栈 <code>com.ryg.task1</code> 中已经存在了 <code>SecondActivity</code> 实例，所以不会再创建 <code>SecondActivity</code> 实例了，而是将已存在于此任务栈中的 <code>SecondActivity</code> 实例移动到栈顶，同时将 <code>SecondActivity</code> 实例之上的其他 <code>Activity</code> 全部从此任务栈中移出。</li></ol></blockquote><p>执行第 <code>5</code> 步时，前台任务栈为 <code>com.ryg.task1</code>，且此任务栈中只有一个 <code>SecondActivity</code> 实例了，所以按下返回键后，<code>SecondActivity</code> 从任务栈 <code>com.ryg.task1</code> 中移除，任务栈 <code>com.ryg.task1</code> 变成空栈。于是，将任务栈 <code>com.ryg.chapter_1</code> 切换成前台任务栈，显示出该任务栈中的 <code>MainActivity</code>。</p><p>执行第 <code>6</code> 步时，<code>App</code> 中只存在一个任务栈 <code>com.ryg.chapter_1</code> 了，且该任务栈中只存在一个 <code>MainActivity</code> 实例，所以按下返回键后，<code>MainActivity</code> 实例从该任务栈中移除，任务栈 <code>com.ryg.chapter_1</code> 变成空栈。于是，<code>App</code> 没有可以显示的 <code>Activity</code> 了，从而退出到桌面。</p><h3 id="_2-6-启动模式的使用场景" tabindex="-1"><a class="header-anchor" href="#_2-6-启动模式的使用场景" aria-hidden="true">#</a> 2.6 启动模式的使用场景</h3><p><code>standard</code> 模式是最普通的一种，没有什么特别注意。</p><p><code>singleInstance</code> 模式是整个系统的单例模式，在我们的应用中一般不会应用到。</p><p><code>singleTask</code> 最典型的使用场景就是 App 的主页 <code>Activity</code>。</p><blockquote><p>在同一个 <code>App</code> 中，不考虑使用 <code>taskAffinity</code> 属性指定其他任务栈的情况下，所有的 <code>Activity</code> 都存放在同一个任务栈中（即 <code>App</code> 的主任务栈，栈名 = 包名）。此时，采用 <code>singleTask</code> 模式启动的 <code>Activity</code> 在整个 <code>App</code> 中就只有唯一的实例。</p><p>采用 <code>singleTask</code> 模式启动主页 <code>Activity</code> 的好处除了使主页 <code>Activity</code> 实例全局唯一之外，还可以通过 <code>singleTask</code> 模式自带的 <code>clearTop</code> 效果，使得当再次回到主页 <code>Activity</code> 时，同一栈内的其它 <code>Activity</code> 都被移除掉。于是，只要回到主页 <code>Activity</code>，那么按下 <code>back</code> 键时就会退出 <code>App</code>。</p><p>注意：主页 <code>Activity</code> 是第一个显示的 <code>Activity</code>，当采用 <code>singleTask</code> 模式，且 <code>App</code> 中只有一个任务栈时，主页 <code>Activity</code> 要么在栈顶，要么在栈底。</p></blockquote><p><code>singleTop</code> 模式可用于在当前 <code>Activity</code> 中再次启动当前的 <code>Activity</code>。此场景下使用 <code>singleTop</code> 模式可以避免 <code>Activity</code> 的重复创建。</p><blockquote><p>如点击按钮启动 <code>Activity</code> 时，如果多次快速地重复点击此按钮，就会多次重复地启动 <code>Activity</code>，此时若采用 <code>standard</code> 模式启动，任务栈中就会存在多个连续重复的 <code>Activity</code> 实例，那么当按返回键时，会重复显示这个 <code>Activity</code>。</p><p>此时，采用 <code>singleTop</code> 模式可解决此情况下重复创建 <code>Activity</code> 的问题。（这里只是说明 <code>singleTop</code> 模式的使用场景，实际开发中应该尽量避免多次点击按钮的情况）</p></blockquote><h3 id="_2-7-activity-的-flags" tabindex="-1"><a class="header-anchor" href="#_2-7-activity-的-flags" aria-hidden="true">#</a> 2.7 <code>Activity</code> 的 <code>Flags</code></h3><h4 id="_2-7-1-设置-activity-启动模式的-flags" tabindex="-1"><a class="header-anchor" href="#_2-7-1-设置-activity-启动模式的-flags" aria-hidden="true">#</a> 2.7.1 设置 <code>Activity</code> 启动模式的 <code>Flags</code></h4><h5 id="_2-7-1-1-flag-activity-new-task" tabindex="-1"><a class="header-anchor" href="#_2-7-1-1-flag-activity-new-task" aria-hidden="true">#</a> 2.7.1.1 <code>FLAG_ACTIVITY_NEW_TASK</code></h5><p>为Activity指定“singleTask”启动模式，其效果和在XML中指定该启动模式相同</p><h5 id="_2-7-1-2-flag-activity-single-top" tabindex="-1"><a class="header-anchor" href="#_2-7-1-2-flag-activity-single-top" aria-hidden="true">#</a> 2.7.1.2 <code>FLAG_ACTIVITY_SINGLE_TOP</code></h5><p>为Activity指定“singleTop”启动模式，其效果和在XML中指定该启动模式相同。</p><h4 id="_2-7-2-影响-activity-运行状态的-flags" tabindex="-1"><a class="header-anchor" href="#_2-7-2-影响-activity-运行状态的-flags" aria-hidden="true">#</a> 2.7.2 影响 <code>Activity</code> 运行状态的 <code>Flags</code></h4><h5 id="_2-7-2-1-flag-activity-clear-top" tabindex="-1"><a class="header-anchor" href="#_2-7-2-1-flag-activity-clear-top" aria-hidden="true">#</a> 2.7.2.1 <code>FLAG_ACTIVITY_CLEAR_TOP</code></h5><p>具有此标记位的 <code>Activity</code> 启动时，若任务栈中已存在此 <code>Activity</code> 实例，那么任务栈中此 <code>Activity</code> 实例之上的所有 <code>Activity</code> 都要出栈，即：清除此 <code>Activity</code> 顶部的所有 <code>Activity</code>。</p><p>注意：</p><ol><li><p><code>singleTask</code> 模式默认具有此标记位的效果。</p></li><li><p>当 <code>standard</code> 模式启动的 <code>Activity</code> 设置此标记位时，若任务栈中已存在此 <code>Activity</code> 实例，那么连同这个已存在的 <code>Activity</code> 实例以及其顶部的所有 <code>Activity</code> 实例都要出栈，然后新创建此 <code>Activity</code> 实例并放入栈中。</p></li></ol><h5 id="_2-7-2-2-flag-activity-exclude-from-recents" tabindex="-1"><a class="header-anchor" href="#_2-7-2-2-flag-activity-exclude-from-recents" aria-hidden="true">#</a> 2.7.2.2 <code>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</code></h5><p>具有这个标记的 <code>Activity</code> 不会出现在历史 <code>Activity</code> 的列表中。</p><blockquote><p>当某些情况下我们不希望用户通过历史列表回到我们的 <code>Activity</code> 时使用此标记。</p><p>此标记位等同于在 <code>XML</code> 中指定 <code>Activity</code> 的属性 <code>android:excludeFromRecents=&quot;true&quot;</code>。</p></blockquote><h3 id="_2-8-onnewintent-方法什么时候执行" tabindex="-1"><a class="header-anchor" href="#_2-8-onnewintent-方法什么时候执行" aria-hidden="true">#</a> 2.8 <code>onNewIntent</code> 方法什么时候执行</h3><p>只有当以 <code>singleTop</code>、<code>singleTask</code>、或 <code>singleInstance</code> 这三种模式启动 <code>Activity</code> 时， <code>onNewIntent</code> 方法才会被调用。具体为：</p><ol><li><p>当以 <code>singleTop</code> 模式启动 <code>Activity</code> 时，若 <code>Activity</code> 所需任务栈的栈顶已存在此 <code>Activity</code> 实例，则执行 <code>onNewIntent</code>；</p></li><li><p>当以 <code>singleTask</code> 模式启动 <code>Activity</code> 时，若 <code>Activity</code> 所需任务栈中已存在此 <code>Activity</code> 实例，则执行 onNewIntent；</p></li><li><p>当以 <code>singleInstance</code> 模式启动 <code>Activity</code> 时，若 <code>Activity</code> 所需任务栈存在，则执行 <code>onNewIntent</code>；</p></li></ol><h2 id="_3-数据" tabindex="-1"><a class="header-anchor" href="#_3-数据" aria-hidden="true">#</a> 3. 数据</h2><h3 id="_3-1-intent-传递数据太大-报-transactiontoolargeexception-异常" tabindex="-1"><a class="header-anchor" href="#_3-1-intent-传递数据太大-报-transactiontoolargeexception-异常" aria-hidden="true">#</a> 3.1 <code>Intent</code> 传递数据太大，报 <code>TransactionTooLargeException</code> 异常</h3><p><code>Intent</code> 在传递数据时是有大小限制的：数据应该被限制在 <code>1MB</code> 之内（<code>1024KB</code>）</p><h2 id="_4-context" tabindex="-1"><a class="header-anchor" href="#_4-context" aria-hidden="true">#</a> 4. <code>Context</code></h2><h3 id="_4-1-context-的继承关系" tabindex="-1"><a class="header-anchor" href="#_4-1-context-的继承关系" aria-hidden="true">#</a> 4.1 <code>Context</code> 的继承关系</h3><p><img src="/assets/03.f2054a66.png" alt="" loading="lazy"></p><h2 id="_5-进程" tabindex="-1"><a class="header-anchor" href="#_5-进程" aria-hidden="true">#</a> 5. 进程</h2><h3 id="_5-1-进程优先级" tabindex="-1"><a class="header-anchor" href="#_5-1-进程优先级" aria-hidden="true">#</a> 5.1 进程优先级</h3><div class="language-text ext-text"><pre class="language-text"><code>前台进程 &gt; 可见进程 &gt; 服务进程 &gt; 后台进程 &gt; 空进程
</code></pre></div><h3 id="_5-2-进程分类" tabindex="-1"><a class="header-anchor" href="#_5-2-进程分类" aria-hidden="true">#</a> 5.2 进程分类</h3><h4 id="_5-2-1-前台进程-foreground-process" tabindex="-1"><a class="header-anchor" href="#_5-2-1-前台进程-foreground-process" aria-hidden="true">#</a> 5.2.1 前台进程（<code>Foreground Process</code>）</h4><p>以下任一条件成立，则进程会被认为位于前台：</p><ol><li><p>进程中运行的 <code>Activity</code> 正在与用户进行交互（此时，<code>Activity</code> 的 <code>onResume</code> 方法已被调用）。</p></li><li><p>组件正在执行生命周期的回调（如：<code>onCreate</code>、<code>onStart</code>、<code>onDestory</code>）</p></li><li><p>被主动调用为前台 <code>Service</code>（<code>startForeground()</code>）</p></li><li><p><code>BroadcastReceiver</code> 正在执行 <code>onReceive()</code></p></li></ol><h4 id="_5-2-2-可见进程-visible-process" tabindex="-1"><a class="header-anchor" href="#_5-2-2-可见进程-visible-process" aria-hidden="true">#</a> 5.2.2 可见进程（<code>Visible Process</code>）</h4><p>可见进程指部分程序界面能够被用户看见，却不在前台与用户交互的进程。</p><p>例如，我们在一个 <code>App</code> 的界面上弹出另一个 <code>App</code> 的对话框主题的 <code>Activity</code>，那么在对话框后面的原 <code>App</code> 的界面是可见的，但是并没有与用户进行交互，那么原 <code>App</code> 进程就是可见进程。</p><h4 id="_5-2-3-服务进程-service-process" tabindex="-1"><a class="header-anchor" href="#_5-2-3-服务进程-service-process" aria-hidden="true">#</a> 5.2.3 服务进程（<code>Service Process</code>）</h4><p>如果 <code>App</code> 界面对用户不可见，但存在一个通过 <code>startService</code> 方法启动的 <code>Service</code> 组件在后台运行，那么该 <code>App</code> 进程就是服务进程。</p><p>例如，在后台播放音乐或者在后台下载就是服务进程。</p><h4 id="_5-2-4-后台进程-background-process" tabindex="-1"><a class="header-anchor" href="#_5-2-4-后台进程-background-process" aria-hidden="true">#</a> 5.2.4 后台进程（<code>Background Process</code>）</h4><p>当 <code>App</code> 中运行的 <code>Activity</code> 对用户不可见（已调用了 <code>Activity</code> 的 <code>onStop</code> 方法）时，App 所在的进程就是后台进程。</p><p>后台进程不会直接影响用户体验，所以当内存不足时，会优先杀死后台进程以空出内存给前台、可见、服务进程使用。</p><p>一般地，会有很多后台进程同时运行着，因此，系统将所有的后台进程保存在一个实现了 <code>LRU</code>（<code>least recently used</code>）算法的容器中，以确保最近最少使用的后台进程先被杀死。</p><h4 id="_5-2-5-空进程-empty-process" tabindex="-1"><a class="header-anchor" href="#_5-2-5-空进程-empty-process" aria-hidden="true">#</a> 5.2.5 空进程（<code>Empty Process</code>）</h4><p>若 <code>App</code> 中没有组件正在运行，则 <code>App</code> 进程是一个空进程。</p><p>空进程存在的意思在于：作为一个 <code>cache</code> 以提高下次启动组件的速度。</p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zengkaiqiang562/JavaGuide/edit/main/docs/zkq/android/basic/activity.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/7/6 18:07:29</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zengkaiqiang562@163.com">zengk</span><!--]--><!--]--></div></footer><nav class="page-nav"><!----><a href="/zkq/android/basic/fragment.html" class="nav-link next" arialabel="Fragment（TODO）"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Fragment（TODO）<!----></div></a></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2023 Zenk562</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.625aa393.js" defer></script>
  </body>
</html>
