<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zengkaiqiang562.github.io/zkq/android/basic/event-dispatch-mechanism.html"><meta property="og:site_name" content="Android Guide"><meta property="og:title" content="事件分发机制"><meta property="og:type" content="article"><meta property="og:image" content="https://zengkaiqiang562.github.io/"><meta property="og:updated_time" content="2022-07-08T06:42:00.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="事件分发机制"><meta property="article:tag" content="android"><meta property="article:modified_time" content="2022-07-08T06:42:00.000Z"><script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2922463_99aa80ii7cf.css"><title>事件分发机制 | Android Guide</title><meta name="description" content="Android 学习 && 面试指南">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.5a38b724.css">
    <link rel="modulepreload" href="/assets/app.625aa393.js"><link rel="modulepreload" href="/assets/event-dispatch-mechanism.html.0dc9b481.js"><link rel="modulepreload" href="/assets/event-dispatch-mechanism.html.a46e9ad9.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.png" alt="Android Guide"><!----><span class="site-name hide-in-pad">Android Guide</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" arialabel="面试指南"><i class="icon iconfont icon-java"></i>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zhuanlan/" class="nav-link" arialabel="优质专栏"><i class="icon iconfont icon-recommend"></i>优质专栏<!----></a></div><div class="nav-item hide-in-mobile"><a href="/open-source-project/" class="nav-link" arialabel="项目精选"><i class="icon iconfont icon-github"></i>项目精选<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://snailclimb.gitee.io/javaguide/#/" rel="noopener noreferrer" target="_blank" arialabel="旧版链接" class="nav-link"><i class="icon iconfont icon-java"></i>旧版链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://javaguide.cn/feed.json" rel="noopener noreferrer" target="_blank" arialabel="RSS订阅" class="nav-link"><i class="icon iconfont icon-rss"></i>RSS订阅<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/about-the-author/" class="nav-link" arialabel="关于作者"><i class="icon iconfont icon-zuozhe"></i>关于作者<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zengkaiqiang562/JavaGuide" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" arialabelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" arialabelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" arialabelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">基础</span><span class="arrow down"></span></button><!--[--><ul class="sidebar-links"><li><!--[--><a href="/zkq/android/basic/activity.html" class="nav-link sidebar-link sidebar-page" arialabel="Activity"><!---->Activity<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/fragment.html" class="nav-link sidebar-link sidebar-page" arialabel="Fragment（TODO）"><!---->Fragment（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/service.html" class="nav-link sidebar-link sidebar-page" arialabel="Service"><!---->Service<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/broadcast.html" class="nav-link sidebar-link sidebar-page" arialabel="BroadcastReceiver"><!---->BroadcastReceiver<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/contentprovider.html" class="nav-link sidebar-link sidebar-page" arialabel="ContentProvider"><!---->ContentProvider<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/serialize.html" class="nav-link sidebar-link sidebar-page" arialabel="对象序列化（TODO）"><!---->对象序列化（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/asynctask.html" class="nav-link sidebar-link sidebar-page" arialabel="AsyncTask"><!---->AsyncTask<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/handler.html" class="nav-link sidebar-link sidebar-page" arialabel="Android的消息机制（TODO）"><!---->Android的消息机制（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/custom-view.html" class="nav-link sidebar-link sidebar-page" arialabel="自定义View（TODO）"><!---->自定义View（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/android/basic/ui-draw-process.html" class="nav-link sidebar-link sidebar-page" arialabel="UI绘制流程（DOING）"><!---->UI绘制流程（DOING）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="事件分发机制"><!---->事件分发机制<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#什么是事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="什么是事件"><!---->什么是事件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发机制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发机制"><!---->事件分发机制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发的对象是谁-即分发的是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发的对象是谁（即分发的是什么）"><!---->事件分发的对象是谁（即分发的是什么）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件的类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件的类型"><!---->事件的类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#什么是事件序列" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="什么是事件序列"><!---->什么是事件序列<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件的传递层级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件的传递层级"><!---->事件的传递层级<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#activity-的事件分发流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="Activity 的事件分发流程"><!---->Activity 的事件分发流程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#activity-中的事件处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="Activity 中的事件处理"><!---->Activity 中的事件处理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-的事件分发流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="ViewGroup 的事件分发流程"><!---->ViewGroup 的事件分发流程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-dispatchtouchevent-方法分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="ViewGroup.dispatchTouchEvent 方法分析"><!---->ViewGroup.dispatchTouchEvent 方法分析<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#过滤掉不安全的触摸事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="过滤掉不安全的触摸事件"><!---->过滤掉不安全的触摸事件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的初始化工作" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发前的初始化工作"><!---->事件分发前的初始化工作<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的拦截判断" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发前的拦截判断"><!---->事件分发前的拦截判断<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的取消处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发前的取消处理"><!---->事件分发前的取消处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发中对多点触摸的支持" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发中对多点触摸的支持"><!---->事件分发中对多点触摸的支持<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#参考" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="参考"><!---->参考<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前如何指定分发顺序" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发前如何指定分发顺序"><!---->事件分发前如何指定分发顺序<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前如何确定目标-view" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="事件分发前如何确定目标 View"><!---->事件分发前如何确定目标 View<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#按下事件的分发" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="按下事件的分发"><!---->按下事件的分发<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#后续事件的分发" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="后续事件的分发"><!---->后续事件的分发<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-dispatchtransformedtouchevent-方法分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="ViewGroup.dispatchTransformedTouchEvent 方法分析"><!---->ViewGroup.dispatchTransformedTouchEvent 方法分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-自己处理事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="ViewGroup 自己处理事件"><!---->ViewGroup 自己处理事件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-的事件处理流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="View 的事件处理流程"><!---->View 的事件处理流程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-dispatchtouchevent-方法分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="View.dispatchTouchEvent 方法分析"><!---->View.dispatchTouchEvent 方法分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-ontouchevent-方法分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="View.onTouchEvent 方法分析"><!---->View.onTouchEvent 方法分析<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">绘图基础</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">动画</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">UI</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Jetpack</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">NDK</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">IPC</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">蓝牙开发</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">性能优化</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">系统源码分析</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他</span><span class="arrow right"></span></button><!--[--><!----><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->事件分发机制</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://zengkaiqiang562.github.io/" target="_blank" rel="noopener noreferrer">Zenk562</a></span><span property="author" content="Zenk562"></span></span><span class="category-info" arialabel="分类🌈" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category clickable" role="navigation">android</li><meta property="articleSection" content="android"></ul></span><span arialabel="标签🏷" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag clickable" role="navigation">android</li></ul><meta property="keywords" content="android"></span><span class="date-info" arialabel="写作日期📅" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年7月8日</span><meta property="datePublished" content="2022-07-08T06:42:00.000Z"></span><!----><span class="words-info" arialabel="字数🔠" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" arialabelledby="word"><title id="word" lang="en">word icon</title><g fill="currentColor"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></g></svg><span>约 8921 字</span><meta property="wordCount" content="8921"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#什么是事件" class="router-link-active router-link-exact-active toc-link level2">什么是事件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发机制" class="router-link-active router-link-exact-active toc-link level2">事件分发机制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发的对象是谁-即分发的是什么" class="router-link-active router-link-exact-active toc-link level2">事件分发的对象是谁（即分发的是什么）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件的类型" class="router-link-active router-link-exact-active toc-link level2">事件的类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#什么是事件序列" class="router-link-active router-link-exact-active toc-link level2">什么是事件序列</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件的传递层级" class="router-link-active router-link-exact-active toc-link level2">事件的传递层级</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#activity-的事件分发流程" class="router-link-active router-link-exact-active toc-link level2">Activity 的事件分发流程</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#activity-中的事件处理" class="router-link-active router-link-exact-active toc-link level3">Activity 中的事件处理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-的事件分发流程" class="router-link-active router-link-exact-active toc-link level2">ViewGroup 的事件分发流程</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-dispatchtouchevent-方法分析" class="router-link-active router-link-exact-active toc-link level3">ViewGroup.dispatchTouchEvent 方法分析</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#过滤掉不安全的触摸事件" class="router-link-active router-link-exact-active toc-link level4">过滤掉不安全的触摸事件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的初始化工作" class="router-link-active router-link-exact-active toc-link level4">事件分发前的初始化工作</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的拦截判断" class="router-link-active router-link-exact-active toc-link level4">事件分发前的拦截判断</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前的取消处理" class="router-link-active router-link-exact-active toc-link level4">事件分发前的取消处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发中对多点触摸的支持" class="router-link-active router-link-exact-active toc-link level4">事件分发中对多点触摸的支持</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#参考" class="router-link-active router-link-exact-active toc-link level5">参考</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前如何指定分发顺序" class="router-link-active router-link-exact-active toc-link level4">事件分发前如何指定分发顺序</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#事件分发前如何确定目标-view" class="router-link-active router-link-exact-active toc-link level4">事件分发前如何确定目标 View</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#按下事件的分发" class="router-link-active router-link-exact-active toc-link level4">按下事件的分发</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#后续事件的分发" class="router-link-active router-link-exact-active toc-link level4">后续事件的分发</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-dispatchtransformedtouchevent-方法分析" class="router-link-active router-link-exact-active toc-link level3">ViewGroup.dispatchTransformedTouchEvent 方法分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#viewgroup-自己处理事件" class="router-link-active router-link-exact-active toc-link level3">ViewGroup 自己处理事件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-的事件处理流程" class="router-link-active router-link-exact-active toc-link level2">View 的事件处理流程</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-dispatchtouchevent-方法分析" class="router-link-active router-link-exact-active toc-link level3">View.dispatchTouchEvent 方法分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/android/basic/event-dispatch-mechanism.html#view-ontouchevent-方法分析" class="router-link-active router-link-exact-active toc-link level3">View.onTouchEvent 方法分析</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h2 id="什么是事件" tabindex="-1"><a class="header-anchor" href="#什么是事件" aria-hidden="true">#</a> 什么是事件</h2><p>用户通过屏幕与手机交互的时候，每一次点击、长按、移动等，都是一个事件。</p><h2 id="事件分发机制" tabindex="-1"><a class="header-anchor" href="#事件分发机制" aria-hidden="true">#</a> 事件分发机制</h2><p>某一个事件从屏幕传递到各个 <code>View</code>，由 <code>View</code> 来使用这一事件（消费事件）或者忽略这一事件（不消费事件），这整个过程的控制就称之为事件分发机制。</p><h2 id="事件分发的对象是谁-即分发的是什么" tabindex="-1"><a class="header-anchor" href="#事件分发的对象是谁-即分发的是什么" aria-hidden="true">#</a> 事件分发的对象是谁（即分发的是什么）</h2><p>系统把事件封装为 <code>MotionEvent</code> 对象，事件分发的过程就是 <code>MotionEvent</code> 分发的过程。</p><h2 id="事件的类型" tabindex="-1"><a class="header-anchor" href="#事件的类型" aria-hidden="true">#</a> 事件的类型</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>按下：ACTION_DOWN
移动：ACTION_MOVE
抬起：ACTION_UP
取消：ACTION_CANCEL
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>这里只列出了单点触摸事件的类型</p></blockquote><h2 id="什么是事件序列" tabindex="-1"><a class="header-anchor" href="#什么是事件序列" aria-hidden="true">#</a> 什么是事件序列</h2><p>从手指按下屏幕开始，到手指离开屏幕所产生的一系列事件。</p><h2 id="事件的传递层级" tabindex="-1"><a class="header-anchor" href="#事件的传递层级" aria-hidden="true">#</a> 事件的传递层级</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Activity -&gt; Window -&gt; DecorView -&gt; ViewGroup -&gt; View
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="activity-的事件分发流程" tabindex="-1"><a class="header-anchor" href="#activity-的事件分发流程" aria-hidden="true">#</a> <code>Activity</code> 的事件分发流程</h2><p><img src="/assets/01.36bce4a9.png" alt="" loading="lazy"></p><p><img src="/assets/02.36de50f0.png" alt="" loading="lazy"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Activity 持有 PhoneWindow 对象的引用（Activity.mWindow）

PhoneWindow 持有 DecorView 对象的引用（PhoneWindow.mDecor）

DecorView 继承自 FrameLayout (extends ViewGroup)。
DecorView 就是 Activity 界面上的顶层 ViewGroup 容器。
于是，事件 MotionEvent 进入到 ViewGroup.dispatchTouchEvent 方法。
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="activity-中的事件处理" tabindex="-1"><a class="header-anchor" href="#activity-中的事件处理" aria-hidden="true">#</a> <code>Activity</code> 中的事件处理</h3><p>在 <code>Activity.dispatchTouchEvent</code> 方法中，如果事件没有被消费掉（即 <code>getWindow().superDispatchTouchEvent(ev)</code> 返回 <code>false</code>），那么就会执行 <code>Activity.onTouchEvent</code> 方法，由 <code>Activity</code> 来处理事件。</p><p><img src="/assets/03.520a329b.png" alt="" loading="lazy"><img src="/assets/04.85799719.png" alt="" loading="lazy"><img src="/assets/05.cedc7375.png" alt="" loading="lazy"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANMAAAD/CAYAAABraeOUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA5kSURBVHhe7Z1BbuO6EkX/Qnr4VpNRryWDrCVAlhJkKd076EGQQRAggL5LUlmkRNFWoktT4TkAgViSVYzqnqbsZ+f9rwOAXUAmgJ1AJoCdQCaAnUAmgJ1AJoCdQCaAnUAmgJ1AJoCdQCaAnUCmUvx56l7vnrrP8eHH/e/u/c/4AH4EyLSRz8ff3b9f/10YgyjXHTuO+5exAhwVZNqICfL2PD5YIbnqsDL9eJBpI1tWph6TKHnMNC7JCccAmTYSrkwf96EIL93bSYzXx7/j4xGTKXMLF58DjgwybSS+zTOBHroP+/H5If26h5WpGZBpI71Mj5cEmd3msTI1ATJtJFqZIlH+du938ZsK172+Ggfv5h0eZNqIrSRJGebj/M5d/FrKBPOf7VyL11hwWJBpE8FrJMNWprM0y5VpEO+he79mhQreNodjgkxbiN5kMHnC1ztLmZzw1jBcmXo5kejHgEwbeL+bVqXlLdo2mfx2kdu8nwMyAewEMgHsBDIB7AQyAewEMgHsBDIB7AQyAewEMgHsBDIB7AQyAezELjItPrTJYFQ+FCATo8mhAJkYTQ4Fu8sEUCvqnCITNIM6p8gEzaDOKTJBM6hzikzQDOqcIhM0gzqnyATNoM4pMkEzqHOKTNAM6pwiEzSDOqfIBM2gzikyQTOoc4pM0AzqnCITNIM6p8gEzaDOKTJBM6hzikzQDOqcIhM0gzqnyATNoM4pMkEzqHOKTNAM6pwiEzSDOqfIBM2gzikyQTOoc4pM0AzqnCITNIM6p8gEzaDOKTJBM6hzikzQDOqcIhM0gzqnyATNoM4pMkEzqHOKTNAM6pwiEzSDOqfIBM2gzikyQTOoc4pM0AzqnCITNIM6p8gEzaDOKTJBM6hzikzQDOqcIhM0gzqnh5YprBuOS6Sec2lcIvWca8clUs+5NC6Res614xKp56yNkqjrHl4mOC63yIsyp8gEN+MWeVHmFJngZtwiL8qcIhPcjFvkRZlTZIKbcYu8KHP6Y2UK58S47Vgjt0/BNXP6Dj9aJrg9NfXI6vlQgEwgpaY+eEZVc0ImkFJTHzyjqjkhE0ipqQ+eUdWckAmk1NQHz6hqToeWKUdNc2mZ2jKhzCkygZTaMqHMKTKBlNoyocwpMoGU2jKhzCkygZRcH0r3yDOqqotMICXXh9I98oyq6iITSMn1oXSPPKOqusgEUnJ9KN0jz6iq7qFlytUrPRdIU1OPrJ4PBcgEUmrqkdXzoQCZQEpNPbJ6PhQgE0ipqUdWz4cCZAIpNfXI6vlQgEwgpaYeWT0fCpAJpNTUI6vnQwEygZSa+uAZVc0JmUBKTX3wjKrmhEwgpaY+eEZVc0ImkFJTHzyjqjkhE0ipqQ+eUdWckAmk1NQHz6hqTsgEUmrqg2dUNSdkAik19cEzqpoTMoGUmnpk9XwoQCaQUlOPrJ4PBcgEUmrqkdXzoeDQMuWoaS4L/jx1r79+d+9/xscprjkmyd/u/W7+vNS2MuT6ULpHnlFVXWT6EhbO0+97/zI+3ohSJnvefF6pbYXI9aF0XjyjqrrI9BUsnKd/6V9/PXQf46Y8g3xvz+PDzVz5/OeHqBf/Rhk/H38nt5fA6q2R26cgvAYKkOkLWDhfH/92H/fXClJOJpvXgD3HpHnp3u6eus9xq/Fxj0wKkGkzHtLTj7YSzILadafwBtfj9fEpetwf39/C2ao2SDIJMK4i0THx+f7dPZzkiJ9znkdCpreTOHMJkQmZNiGbSySQBT0M5hD8KOg9s5XlLMqJ6HzBceEx8+fPJD6vkLY96IXfzs1XUGRCpk2o5mLBDGWJHs9CPpGRKRQy3J6TKZLYfp7EnK9MLk0oFDIh0yY0cxlWnvD3HcYU5u0yTUL6a7GerEzT67b+ttDfqcvINDwezodMyLQgV08yl/42apJgYBBsCHr4s/HSvffhzsvUP+5fCwUhvyBT8jlZmZy17RqK9yiD1fOhAJk2YCtI6r8tRdt7Cfx6TML0K4hts5VrLtMoS3Tu2THR88dtfd1wJexlt7o+UtIEt4UFsHnUQnhtFCDTgfHbwzOrK9Ps9rTgf8CtqQ/n3180J2Q6KovVrU5q6oNnVDUnZDog/e3d6feLXkNVSk19sLn4UIBMIKWmPnhGVXNCJpBSUx88o6o5IRNIqakPnlHVnJAJpNTUB8+oak7IBFJq6pHV86EAmUBKTT2yej4UIBNIqalHVs+HAmQCKTX1yOr5UIBMIKWmHlk9HwqQCaTU1COr50MBMm2g/2R38LvaH1UJH0dj/DT3+dPeF8baR4MWH2aNGD9tPjvPombyO1ZlsPpr5PYpCK+JgkPLlEM3l9RXGCzU6Q+dWrDXZRiwY3qZFl+hWB+DfHFdP09c8zRfZOoJr58CZNpMIFP03aVwTN8jWqwSK8NluiSeYavVJNPyPIuayNQTXhMFyLSZmUyJoIZfC49XiTS+okwyjZIE5x4+KT6cd5JpyVTP5pn6cmBZcn0onRfPqKouMm0mLVMozVaZJuzckzRnqc5f5vOVaKhv5w6vfXbcaHWy2mvk9ikIr4cCZNrMdpmSt17RGM8XMt5C+op1WYZBRJtDv4oV/DZtDvv91sjtUxBecwXItJl1mfzWKyXT9Yyr01yeUa5QkuHWz8dMyPmbGRWuTKUJr4cCZNpMWqZQoMXPj1e8S3c6z3skx4XRS5V+A6IWkQyrXwvhNVGATJsJZHKC8Mar0OnYWZDDNw8+H5+Wt3e9IInbPiOQdyA+9rwKnt/IMJZzKEltmfCh4NAy5erp5hLLNLwW8sfxGwa2bwr1sC+Uzf7k1/Idt+VqE42FTPF+VqZ1wmuiAJk2MIhz+j1NlvE1TOqduv640zEf9zPJ7LkrY5LMjmVlUhBebwXIBFJq6oNnVDUnZAIpNfXBM6qaEzKBlJr64BlVzQmZQEpNPbJ6PhQgE0ipqUdWz4cCZAIpNfXI6vlQgEwgpaYeWT0fCpAJpNTUI6vnQwEygZSaemT1fChAJpBSU4+sng8FyARSauqR1fOhAJlASk09sno+FBxaphw1zeUm9B/EnX8ivTy5PpTukWdUVReZNpH69PfKJ7zFrH01vf/Eun1KHJkWhH1TgEybGGQKv5Pk3x2KtpWgrzsXOTG/G5PrQ+m8WD0fCpBpEyth7VeB0iuUfUlxNpebzCNPrg+l8+IZVdVFpk2s/cs/3z4E3a9J/AXCtX3x9njV8fOPx4xf9pvf6vmXEnsWYqXr2jnmczj/Hrb6ffOLhVZrjdw+Bf67q+oi0yaukckCGb5Wme9LfTs3sT26jRvOsbiti4SZzS3atz6nSED7hu5d+CfLUnPdRq4PpfPiGVXVRaZNzAJ7xraPYR1fQ81HH8q1f+mT28Naubrj9vlKFD7OzSk4bvirSifx+rkEv9M3sDpr5PYpCH93Bci0iZVQhzKsCWNslsnDvCbTtLJEK4wxl2ltTuc6M4meT89ffc711JYJZU4PLVOunmYuiVBbUKNbqOGWLTxm+sMq830v3Xt/GzVsX9zmncO8LtMgzenWbL6KRCtVbk6DkP3/HmeU0R9/9xbPKJ2JHJ5R1ZyQaRNDqMPfN/kvfh/k6ZhIgmjfFGgP/Pm80b6MTD6n+TwimU5cMafztv7xTM4vYrVqYbq2yLQgV6/0XCBNTX3wjKrmhEwgpaY+eEZVc0ImkFJTHzyjqjkhE0ipqQ+eUdWckAmk1NQHz6hqTsgEUmrqkdXzoQCZQEpNPbJ6PhQgE0ipqUdWz4cCZAIpNfXI6vlQgEwgpaYeWT0fCg4tU46a5tIyuT6U7pFnVFUXmUBKrg+le+QZVdVFJpCS60PpHnlGVXWRCaTk+lC6R55RVV1kAim5PpTukWdUVReZQEquD6V75BlV1UUmkJLrQ+keeUZVdZEJpOT6ULpHnlFV3UPLlKtXei6QpqY+eEZVc0ImkFJTHzyjqjkhE0ipqQ+eUdWckAmk1NQHz6hqTs3JVHqOrVPT9ba5+FDQlEyl5wd1XXObiw8Fh5Bp7by5eql9qvnBOjVdc5uLDwWHWZlS58/V23Is6KjputtcfCg43G1eWCdXLzwmdxxouaZHpfAsqOreRKbw+O+ONcL9ueNAy6UelcQzoap7yDcgrqkXHvPVAd8ndx1LX2N1bw95m+fk6l17HGi5tkclsHo+FBz6DYgc4bHKeUGe3LUv3Rer50PBIWT6ynnnz1HNDfLkrnvpnlg9HwoO+ZrpGlJzqWl+rZC75qX7YfV8KGhKJihPbZlQ5hSZQEptmVDmFJlASm2ZUOYUmUBKbZlQ5vRHy8SoY9SCek6Hlql0PTg26pwiEzSDOqfIBM2gzikywc24RV6UOUUmuBm3yIsyp8gEN+MWeVHm9PAy5cYlUs+5Zlwi9Zwt4xKp51wzLpF6zqVxidRzwlESdd1DywSwBXVOkQmaQZ3Tg8r00r39eug+xkcA16DOKTJBM6hzikzQDOqcIhM0gzqn1cv0+fg7OL8LNJfJHk9zmI4z/nbvd/91b8/xMW/P425ohikfLcr056l7Ta5AoUyDJK+Pf/tHPc8Pp7n4/kGmSLBoP7SCLKcjla9Mvpr87t7/jJt6AplMjLun7rPf7vhqNP/ZSW2Dn44upwMHec3kq4tLdY1MfiwywYA6p9Xf5r2fAx8KcMVt3lmwUcT7l/6RMbwO4zavNWQ5Hal+Zfq4n849CRHKZAxCTfMI940S3tvrpNR+aIWp/43K9H24pYMBdU6RCZpBnVNkgmZQ57QBmQAG1DlFJmgGdU6RCZpBnVNkgmZQ5xSZoBnUOUUmaAZ1TpEJmkGdU2SCZlDnFJmgGdQ5RSZoBnVOkQmaQZ1TZIJmUOcUmaAZ1DlFJmgGdU6RCZpBnVNkgmZQ5xSZoBnUOd1dJgbjCEMBMjGaHAqQidHkULCLTACATAC7gUwAO4FMALvQdf8Hv+JYYSpr1yQAAAAASUVORK5CYII=" alt="" loading="lazy"></p><p><code>Activity</code> 在进行事件处理时，主要就是考虑当 <code>Activity</code> 为 <code>Dialog</code> 类型时的情况。</p><ol><li><p>当 <code>Activity</code> 是 <code>Dialog</code> 类型，且允许点击 <code>Activity</code> 之外的地方关闭 <code>Activity</code> 时，如果触摸事件发生在 <code>Activity</code> 之外，就关闭 <code>Activity</code>。</p></li><li><p>在 <code>Window.shouldCloseOnTouch</code> 方法中，</p><blockquote><p><code>mCloseOnTouchOutside</code> 为 <code>true</code> 表示允许点击 <code>Activity</code> 之外的地方关闭 <code>Activity</code>。</p><p>在 <code>PhoneWindow</code> 中， <code>peekDecorView()</code> 方法返回 <code>Activity</code> 的顶层容器 <code>DecorView</code>。</p></blockquote></li><li><p>在 <code>Window.isOutOfBounds</code> 方法中，以 <code>Action_DOWN</code> 按下时的坐标 <code>(x, y)</code> 在距离 <code>DecorView</code> 边界 <code>slop</code> 范围之外为依据，将这样的触摸事件规定为发生在 <code>DecorView</code> 之外（即发生在 <code>Activity</code> 之外）。</p></li></ol><h2 id="viewgroup-的事件分发流程" tabindex="-1"><a class="header-anchor" href="#viewgroup-的事件分发流程" aria-hidden="true">#</a> <code>ViewGroup</code> 的事件分发流程</h2><p><img src="/assets/07.5e16e053.png" alt="" loading="lazy"></p><h3 id="viewgroup-dispatchtouchevent-方法分析" tabindex="-1"><a class="header-anchor" href="#viewgroup-dispatchtouchevent-方法分析" aria-hidden="true">#</a> <code>ViewGroup.dispatchTouchEvent</code> 方法分析</h3><p><code>ViewGroup.dispatchTouchEvent</code> 方法中主要做了三件事</p><ol><li><p>判断是否需要拦截事件；</p></li><li><p>在当前 <code>ViewGroup</code> 中找到用户真正点击的 <code>View</code>；</p></li><li><p>分发事件到 <code>View</code> 上。</p></li></ol><h4 id="过滤掉不安全的触摸事件" tabindex="-1"><a class="header-anchor" href="#过滤掉不安全的触摸事件" aria-hidden="true">#</a> 过滤掉不安全的触摸事件</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
        mInputEventConsistencyVerifier 是在调试时用到的，用来检测事件序列的一致性，
        对事件分发流程无影响，不需要关注。
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        在手机的辅助功能中有个无障碍的选项，通过无障碍服务 AccessibilityService 来帮助残障人士或无法与设备交互的人。
        对通过无障碍无法触发的事件，ev.isTargetAccessibilityFocus() 返回 true，
        这里不考虑无障碍服务的情况，即认为 ev.isTargetAccessibilityFocus() == false
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isAccessibilityFocusedViewOrHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ev<span class="token punctuation">.</span><span class="token function">setTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        handled 作为返回值，true 表示当前视图消费掉了事件，false 则没有消费掉。
    */</span>
    <span class="token keyword">boolean</span> handled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/*
        onFilterTouchEventForSecurity 方法中制定了一种安全策略，用来对事件进行过滤，
        只有当事件符合安全策略时，该方法才返回 true，才能进入 if 语句对事件进行处理
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* View.java */</span>

<span class="token comment">/*
    onFilterTouchEventForSecurity 制定的安全策略是：
        如果当前视图设置了属性 FILTER_TOUCHES_WHEN_OBSCURED，且当前视图所在的 window 被其他 window 遮盖了，
        那么当事件 event 是经过其他 window 才传到当前视图所在的 window 时，就返回 false，过滤掉事件。

    因为遮盖当前视图的其他 window 可能属于另一个 App 进程时，
    所以这样处理就能避免其它的 App 进程对事件的恶意篡改。
    （一个 window 被另一个 window 遮盖住，可以理解成一个 Activity 被另一个 Activity 遮盖住）
*/</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> <span class="token constant">FILTER_TOUCHES_WHEN_OBSCURED</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span>
            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">FLAG_WINDOW_IS_OBSCURED</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Window is obscured, drop this touch.</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="事件分发前的初始化工作" tabindex="-1"><a class="header-anchor" href="#事件分发前的初始化工作" aria-hidden="true">#</a> 事件分发前的初始化工作</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>

        <span class="token comment">/*
            事件 ACTION_DOWN 表示一个事件序列的开始，
            所以当收到 ACTION_DOWN 事件时，需要做一些重置和初始化工作，包括：
                1. 取消对上一个事件序列的分发；
                2. 清理掉在处理上一个事件序列时保留的状态信息；
                3. 重置并清空触摸目标链表（即由 TouchTarget 构成的单链表，TouchTarget 中持有能接收事件的直接子View的引用）
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">cancelAndClearTouchTargets</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resetTouchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>


<span class="token comment">/*
    取消对上一个事件序列的分发，重置并清空触摸目标链表，具体为：
        1. 遍历上一个事件序列中产生的触摸目标链表，获取各个TouchTarget中持有的直接子View；
        2. 调用 resetCancelNextUpFlag 方法，取消直接子View中的 PFLAG_CANCEL_NEXT_UP_EVENT 标记。
        3. 向直接子View分发 ACTION_CANCEL 事件；
        4. 调用 clearTouchTargets() 方法清空触摸目标链表。
*/</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">cancelAndClearTouchTargets</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TouchTarget</span> target <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span> target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> target <span class="token operator">=</span> target<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 参数 cancel 传 true，会向 子View 分发 ACTION_CANCEL 事件</span>
            <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span>child<span class="token punctuation">,</span> target<span class="token punctuation">.</span>pointerIdBits<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">clearTouchTargets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/*
    清理掉在处理上一个事件序列时保留的状态信息，具体为：
        1. 调用 clearTouchTargets() 方法清空触摸目标链表；
        2. 取消当前View中的 PFLAG_CANCEL_NEXT_UP_EVENT 标记。
        3. 取消当前View中的 FLAG_DISALLOW_INTERCEPT 标记。
            只有不存在该标记时，是否拦截事件才由 ViewGroup.onInterceptTouchEvent 方法的返回值确定。
            当存在该标记时，那么肯定不会拦截事件，intercepted 固定为 false。
*/</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">resetTouchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTouchTargets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mGroupFlags <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token constant">FLAG_DISALLOW_INTERCEPT</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
    清空触摸目标链表（即由 TouchTarget 构成的单链表），具体为：
        1. 从头节点 mFirstTouchTarget 开始遍历链表；
        2. 调用 TouchTarget.recycle() 方法，在该方法中会移除 TouchTarget 对直接子View的引用。
        3. 将头节点置为 null，即 mFirstTouchTarget = null，达到清空单链表的目的。
*/</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearTouchTargets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TouchTarget</span> target <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token class-name">TouchTarget</span> next <span class="token operator">=</span> target<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            target<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            target <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFirstTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
    取消 参数view 中的 PFLAG_CANCEL_NEXT_UP_EVENT 标记。
    该标记的作用：
        如果 View 中设置了该标记，就会取消对事件的分发，即不会把事件分发给子View了；
        且 View 本身在进行事件处理时，会当作 ACTION_CANCLE 进行处理。
    当 参数view 存在该标记返回 true；不存在返回 false。
*/</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token constant">PFLAG_CANCEL_NEXT_UP_EVENT</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token constant">PFLAG_CANCEL_NEXT_UP_EVENT</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h4 id="事件分发前的拦截判断" tabindex="-1"><a class="header-anchor" href="#事件分发前的拦截判断" aria-hidden="true">#</a> 事件分发前的拦截判断</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>

        <span class="token comment">/*
            ACTION_DOWN 为一个事件序列的开始
            mFirstTouchTarget 是触摸目标链表的头节点，表示最后接收到并消费掉按下事件（ACTION_DOWN 或 ACTION_POINTER_DOWN）的直接子View。
                触摸目标链表用来保存接收到并消费掉按下事件的直接子View，
                    1. 当多点触摸时，会有多个按下事件触发，接收到并消费掉这些按下事件的直接子View会插入到链表的头部，
                    于是头节点 mFirstTouchTarget 表示最后接收到并消费掉按下事件的直接子View；
                    2. 当单点触摸时，只有一个按下事件触发，此时链表中只可能有一个直接子View。

            只有在分发按下事件时，才会向链表中插入TouchTarget。
            也就是说，如果 mFirstTouchTarget != null，那么当前分发的事件肯定不是 ACTION_DOWN。
            所以 if 条件成立的情况有2种：
                1. 事件序列开始时的 ACTION_DOWN 事件的分发；
                2. 当已有直接子View接收到并消费掉按下事件时，分发按下之后的事件。

            当 if 条件成立时才会考虑将当前事件分发给直接子View，此时才需要判断要不要拦截：
                1. 如果在直接子View中调用了 getParent().requestDisallowInterceptTouchEvent(true) 方法，
                那么当前View中就会设置 FLAG_DISALLOW_INTERCEPT 标记，此时 intercepted 固定为 false，表示不拦截事件；
                2. 如果当前View没有设置该标记，那么是否拦截事件由当前View的 onInterceptTouchEvent 方法的返回值确定。
            
            当 if 条件不成立时，说明没有直接子View接收过并消费掉 ACTION_DOWN 事件，
            即 ACTION_DOWN 事件被拦截了或者没有被消费掉。
            此时，同一事件序列中的后续事件就会被拦截掉。
            也就是说，如果直接子View没有接收过并消费掉 ACTION_DOWN 事件，那么就不可能接收到后续事件。
                    
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span> <span class="token operator">||</span> mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">boolean</span> disallowIntercept <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_DISALLOW_INTERCEPT</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>disallowIntercept<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                intercepted <span class="token operator">=</span> <span class="token function">onInterceptTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ev<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// restore action in case it was changed</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                intercepted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            intercepted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
    ViewGroup 默认提供的 onInterceptTouchEvent 方法在判断是否拦截事件的依据是：
        如果通过鼠标左键按在当前View的滚动条上，那么就拦截事件不分发给直接子View。
*/</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onInterceptTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">isFromSource</span><span class="token punctuation">(</span><span class="token class-name">InputDevice</span><span class="token punctuation">.</span><span class="token constant">SOURCE_MOUSE</span><span class="token punctuation">)</span> <span class="token comment">// 判断事件是否由鼠标触发</span>
            <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span> 
            <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span><span class="token function">isButtonPressed</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">BUTTON_PRIMARY</span><span class="token punctuation">)</span> <span class="token comment">// 判断是否为鼠标左键按下</span>
            <span class="token operator">&amp;&amp;</span> <span class="token function">isOnScrollbarThumb</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断是否按在当前View的滚动条上</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h4 id="事件分发前的取消处理" tabindex="-1"><a class="header-anchor" href="#事件分发前的取消处理" aria-hidden="true">#</a> 事件分发前的取消处理</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token comment">/*
            如果当前View设置了 PFLAG_CANCEL_NEXT_UP_EVENT 标记，或者当前事件为 ACTION_CANCEL，
            那么就表示取消事件，即 canceled == true，此时：
                1. 不会再将 按下事件分发给直接子View；
                2. 在当前View自己在处理事件时，会当作 ACTION_CANCLE 进行处理。
                3. 当前事件分发处理完后，会调用 resetTouchState() 方法清理掉本次事件序列中所保留的状态信息。
        */</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 取消事件时 canceled 为 true，if 条件不成立，于是不会将按下事件分发给直接子View。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 取消事件时 canceled 为 true，当前View自己在处理事件时，会当作 ACTION_CANCLE 进行处理。</span>
            handled <span class="token operator">=</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> canceled<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span><span class="token constant">ALL_POINTER_IDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">TouchTarget</span> predecessor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">TouchTarget</span> target <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">TouchTarget</span> next <span class="token operator">=</span> target<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>alreadyDispatchedToNewTouchTarget <span class="token operator">&amp;&amp;</span> target <span class="token operator">==</span> newTouchTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">/*
                        如果当前View在分发后续事件时取消事件，
                        那么当前的后续事件还是会分发给接收过并消费掉 ACTION_DOWN 事件的直接子View。
                        直接子View取消事件的条件是：
                            1. 直接子View本身设置了 PFLAG_CANCEL_NEXT_UP_EVENT 标记；
                            2. 当前View将当前的后续事件拦截了。
                        也就是说当前View取消事件并不意味着直接子View也取消事件。
                    */</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> cancelChild <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>child<span class="token punctuation">)</span> <span class="token operator">||</span> intercepted<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> cancelChild<span class="token punctuation">,</span> target<span class="token punctuation">.</span>child<span class="token punctuation">,</span> target<span class="token punctuation">.</span>pointerIdBits<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">/*
                        如果直接子View取消事件了，那么直接子View就会从链表中移除，
                        于是，直接子View就无法再接收到后续事件了。
                    */</span> 
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cancelChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>predecessor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            mFirstTouchTarget <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            predecessor<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        target<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        target <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                predecessor <span class="token operator">=</span> target<span class="token punctuation">;</span>
                target <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/*
            取消事件时，在当前事件分发处理完后，会调用 resetTouchState() 方法清理掉本次事件序列中所保留的状态信息，包括：
                1. 调用 clearTouchTargets() 方法清空触摸目标链表；
                2. 取消当前View中的 PFLAG_CANCEL_NEXT_UP_EVENT 标记。
                3. 取消当前View中的 FLAG_DISALLOW_INTERCEPT 标记 

            这就表示，虽然当前View取消事件并不意味着直接子View也取消事件，
            但是由于当前View取消事件，使得触摸目标链表被清空了，导致直接子View再也无法接收到后续事件了。
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>canceled
                <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span>
                <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resetTouchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h4 id="事件分发中对多点触摸的支持" tabindex="-1"><a class="header-anchor" href="#事件分发中对多点触摸的支持" aria-hidden="true">#</a> 事件分发中对多点触摸的支持</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>

        <span class="token comment">/*
            Android 3.0 以上，ViewGroup 默认设置了 FLAG_SPLIT_MOTION_EVENTS 标记。
            该标记用于支持多点触摸，当设置了该标记时，就会单独保存每个按下的 手指id，
            从而能够根据每个按下的 手指id 单独地对每个手指的触摸事件进行分发。
        */</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有当前View未取消事件，且未拦截事件时，才分发按下事件</span>

            <span class="token comment">/*
                这里只会对三种类型的事件进行分发：
                    1. ACTION_DOWN ：多点触摸中表示第 1 根手指的按下事件
                    2. ACTION_POINTER_DOWN ：仅在多点触摸中产生，表示非第 1 根手指的按下事件
                    3. ACTION_HOVER_MOVE ：鼠标未按下时的移动事件（不考虑）
            */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_POINTER_DOWN</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">/*
                    actionIndex 表示事件 ev 是由第几根手指触发的。
                    其中，第 1 根手指触发的按下事件 ACTION_DOWN 的 actionIndex 为 0。
                    ev.getActionIndex() 方法只有在按下事件或抬起事件时才有效。
                    注意：MotionEvent 中有的方法需要传入的参数 pointerIndex 就是这里的 actionIndex。
                */</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> actionIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always 0 for down</span>

                <span class="token comment">/*
                    Android 3.0 以上，默认设置了 FLAG_SPLIT_MOTION_EVENTS 标记，所以变量 split 默认为 true，
                    ev.getPointerId(actionIndex) 方法用于获取第 actionIndex 根手指的 id。
                    1 &lt;&lt; pointerId 的含义是将 1 左移 pointerId 位，于是，pointerId 不同，1 左移的位数也不同 ，
                    因此，左移运算的结果 idBitsToAssign 就可以用来标记 pointerId。
                    并且，通过位或运算，可以将多个 pointerId 对应的 idBitsToAssign 保存在一个 int 型变量中。
                */</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> idBitsToAssign <span class="token operator">=</span> split <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span>
                        <span class="token operator">:</span> <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span><span class="token constant">ALL_POINTER_IDS</span><span class="token punctuation">;</span>

                <span class="token comment">/*
                    在分发 pointerId 触发的按下事件之前，如果之前已经有直接子View接收过并消费掉该 pointerId 触发的按下事件，
                    那么就通过 pointerId 找到触摸目标链表中对应的 TouchTarget，清除掉其中对该 pointerId 的标记，
                    若 TouchTarget 只保存了该 pointerId 的标记，则在清理之后，该 TouchTarget 会从链表中移除掉。
                    也就是说，在同一事件序列中：
                        1. 一根手指触发的按下事件最多只会被一个直接子View消费掉，
                        2. 一根手指触发的后续事件最多只会分发给一个直接子View（就是消费掉按下事件的直接子View）。
                    注意：但是一个直接子View可以接收并消费掉多根手指触发的事件。
                */</span>
                <span class="token function">removePointersFromTouchTargets</span><span class="token punctuation">(</span>idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h5 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h5><p><a href="https://blog.csdn.net/l707941510/article/details/81300333" target="_blank" rel="noopener noreferrer">Android多点触控详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://blog.csdn.net/vansbelove/article/details/78416791" target="_blank" rel="noopener noreferrer">MotionEvent详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.jianshu.com/p/1885f3ec49c0" target="_blank" rel="noopener noreferrer">Android触摸滑动全解（四）——MotionEvent详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="事件分发前如何指定分发顺序" tabindex="-1"><a class="header-anchor" href="#事件分发前如何指定分发顺序" aria-hidden="true">#</a> 事件分发前如何指定分发顺序</h4><p><strong>按下事件的分发顺序</strong></p><ol><li><p>先分发给<code>Z</code>坐标最大的直接子<code>View</code>；</p></li><li><p><code>Z</code>坐标相同时，看是否设置了 <code>FLAG_USE_CHILD_DRAWING_ORDER</code> 标记，</p><ol><li><p>若没有设置 <code>FLAG_USE_CHILD_DRAWING_ORDER</code> 标记， 则先分发给插入索引最大的直接子<code>View</code>；</p></li><li><p>若设置了 <code>FLAG_USE_CHILD_DRAWING_ORDER</code> 标记， 则先分发给插入索引最大的直接子<code>View</code> 经过 <code>getChildDrawingOrder</code> 方法映射后的直接子<code>View</code>。</p></li></ol></li></ol><p><strong>后续事件的分发顺序</strong></p><ul><li>同一事件序列中的后续事件只会分发给消费掉按下事件的直接子<code>View</code>，这些直接子<code>View</code>会保存在触摸目标链表中。 在链表中，后消费掉按下事件的直接子<code>View</code>排在链表的前面。在分发后续事件时，是通过对触摸目标链表进行遍历来分发的，所以先分发给后消费掉按下事件的直接子<code>View</code>。</li></ul><p><strong>注意：</strong></p><ol><li><p>在单点触摸中，按下事件只有一个 <code>ACTION_DOWN</code>，所以最多只有一个直接子<code>View</code>消费掉按下事件。因此，不用考虑事件的分发顺序。</p></li><li><p>在多点触摸中，如果一个消费掉 <code>ACTION_DOWN</code> 的直接子View 又将要接收到 <code>ACTION_POINTER_DOWN</code> 事件，那么并不会改变该直接子<code>View</code>在链表中的顺序，仅仅只是把 <code>ACTION_POINTER_DOWN</code> 事件的 <code>pointerId</code> 添加到该直接子<code>View</code>对应的 <code>TouchTarget</code> 中，将该 <code>ACTION_POINTER_DOWN</code> 事件作为后续事件处理。</p></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>
        
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有当前View未取消事件，且未拦截事件时，才分发按下事件</span>

            <span class="token class-name">View</span> childWithAccessibilityFocus <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">?</span> <span class="token function">findChildWithAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_POINTER_DOWN</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> childrenCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    
                    <span class="token comment">/*
                        buildTouchDispatchChildList 方法返回的 preorderedList 的排序规则为：
                            1. 若当前View只有一个直接子View，或者所有直接子View的Z坐标都为0，
                            则 preorderedList 为 null，不进行预排序。
                            1. preorderedList 中优先按Z坐标从小到大排序；
                            2. Z坐标相同时，看当前View是否设置了 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                3.1 若没有设置了该标记，则按直接子View添加到当前View中时的插入顺序从前到后排序；
                                3.2 若设置了该标记，则 preorderedList 集合中按插入顺序从前到后排序的直接子View
                                被映射成以当前View的 getChildDrawingOrder 方法返回值为索引的直接子View。
                    */</span>
                    <span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> preorderedList <span class="token operator">=</span> <span class="token function">buildTouchDispatchChildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> customOrder <span class="token operator">=</span> preorderedList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isChildrenDrawingOrderEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children <span class="token operator">=</span> mChildren<span class="token punctuation">;</span>

                    <span class="token comment">// 这里按直接子View添加到当前View中时的插入顺序从后到前进行遍历</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">/*
                            customOrder 为 true 成立的条件是同时满足以下点：
                                1. 没有进行预排序，即 preorderedList 集合为null；
                                2. 当前View设置了 FLAG_USE_CHILD_DRAWING_ORDER 标记。
                            在 customOrder 为 true 的情况下，childIndex 就是 getChildDrawingOrder 方法的返回值；
                            在 customOrder 为 false 的情况下，childIndex 就是当前遍历的直接子View在当前View中的插入索引。
                        */</span>
                        <span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedIndex</span><span class="token punctuation">(</span>childrenCount<span class="token punctuation">,</span> i<span class="token punctuation">,</span> customOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        
                        <span class="token comment">/*
                            如果进行了预排序，即 preorderedList != null，那么按下事件的分发顺序是：
                                1. 先分发给Z坐标最大的直接子View；
                                2. Z坐标相同时，看是否设置了 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                    2.1 若没有设置 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                    则先分发给插入索引最大的直接子View；
                                    2.2 若设置了 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                    则先分发给插入索引最大的直接子View 经过 getChildDrawingOrder 方法映射后的直接子View。
                            如果没有预排序，即 preorderedList == null，那么按下事件的分发顺序是：
                                1. 若没有设置 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                则先分发给插入索引最大的直接子View；
                                2 若设置了 FLAG_USE_CHILD_DRAWING_ORDER 标记，
                                则先分发给插入索引最大的直接子View 经过 getChildDrawingOrder 方法映射后的直接子View。
                        */</span>
                        <span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedView</span><span class="token punctuation">(</span>preorderedList<span class="token punctuation">,</span> children<span class="token punctuation">,</span> childIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">/*
                            如果当前的按下事件是由无障碍服务触发的，
                            并且无障碍服务指定的焦点View在当前View的子View中（不一定是直接子View），
                            那么找到包含该焦点View的当前View下的直接子View，即 childWithAccessibilityFocus，
                            优先将按下事件分发给 childWithAccessibilityFocus，
                            然后重置循环因子 i = childCount - 1，在对包含焦点View的直接子View分发完按下事件后，
                            再重新向不包含焦点View的直接子View进行按下事件的分发。
                        */</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>childWithAccessibilityFocus <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>childWithAccessibilityFocus <span class="token operator">!=</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            childWithAccessibilityFocus <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                            i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>preorderedList <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> preorderedList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><h4 id="事件分发前如何确定目标-view" tabindex="-1"><a class="header-anchor" href="#事件分发前如何确定目标-view" aria-hidden="true">#</a> 事件分发前如何确定目标 <code>View</code></h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>
        
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有当前View未取消事件，且未拦截事件时，才分发按下事件</span>

            <span class="token class-name">View</span> childWithAccessibilityFocus <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">?</span> <span class="token function">findChildWithAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_POINTER_DOWN</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> childrenCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">float</span> y <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> preorderedList <span class="token operator">=</span> <span class="token function">buildTouchDispatchChildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> customOrder <span class="token operator">=</span> preorderedList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isChildrenDrawingOrderEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children <span class="token operator">=</span> mChildren<span class="token punctuation">;</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedIndex</span><span class="token punctuation">(</span>childrenCount<span class="token punctuation">,</span> i<span class="token punctuation">,</span> customOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedView</span><span class="token punctuation">(</span>preorderedList<span class="token punctuation">,</span> children<span class="token punctuation">,</span> childIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token comment">/*
                            canViewReceivePointerEvents 方法用来判断直接子View是否能接收事件，满足以下条件之一即可：
                                1. 直接子View是可见的，即 child.getVisibility() == View.VISIBLE；
                                2. 直接子View设置了View动画（即补间动画）
                            isTransformedTouchPointInView 方法用来判断当前的按下事件的按下坐标点是否在直接子View的区域内。

                            综上，如果直接子View是可见的或者设置了补间动画，
                            那么当按下事件发生在直接子View的区域内时，按下事件就能分发给这个直接子View。
                        */</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canViewReceivePointerEvents</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                                <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isTransformedTouchPointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> child<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            ev<span class="token punctuation">.</span><span class="token function">setTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h4 id="按下事件的分发" tabindex="-1"><a class="header-anchor" href="#按下事件的分发" aria-hidden="true">#</a> 按下事件的分发</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>
        
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有当前View未取消事件，且未拦截事件时，才分发按下事件</span>

            <span class="token class-name">View</span> childWithAccessibilityFocus <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">?</span> <span class="token function">findChildWithAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_POINTER_DOWN</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> actionIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always 0 for down</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> idBitsToAssign <span class="token operator">=</span> split <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span><span class="token constant">ALL_POINTER_IDS</span><span class="token punctuation">;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> childrenCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedIndex</span><span class="token punctuation">(</span>childrenCount<span class="token punctuation">,</span> i<span class="token punctuation">,</span> customOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getAndVerifyPreorderedView</span><span class="token punctuation">(</span>preorderedList<span class="token punctuation">,</span> children<span class="token punctuation">,</span> childIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token comment">/*
                            如果 newTouchTarget != null，说明直接子View已经消费掉 ACTION_DOWN 事件了，
                            那么当前分发的肯定是 ACTION_POINTER_DOWN 事件，
                            也就是说，在当前直接子View消费掉 ACTION_DOWN 事件之后，又有 ACTION_POINTER_DOWN 事件分发给它了。
                            此时，仅仅把 ACTION_POINTER_DOWN 事件的 pointerId 记录在 TouchTarget 中，先不分发给这个直接子View，
                            而是在下面的分发后续事件的代码中再进行分发。
                        */</span>
                        newTouchTarget <span class="token operator">=</span> <span class="token function">getTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">/*
                                执行位或运算，将 ACTION_POINTER_DOWN 事件的 pointerId 添加到 TouchTarget 中，
                                idBitsToAssign 就是 1 &lt;&lt; pointerId 的运算结果，是 pointerId 的位表示形式，
                                TouchTarget.pointerIdBits 中保存的数据可能是：
                                    1. ACTION_DOWN 的 pointerId；
                                    2. 1个 ACTION_DOWN 和 n个 ACTION_POINTER_DOWN 的 pointerId。（n=1,2,3,...）
                            */</span> 
                            newTouchTarget<span class="token punctuation">.</span>pointerIdBits <span class="token operator">|=</span> idBitsToAssign<span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token comment">/*
                            清除直接子View的 PFLAG_CANCEL_NEXT_UP_EVENT 标记后再分发按下事件，
                            因为直接子View在接收到按下事件时，认为是一次事件序列的开始，
                            所以一开始，直接子View中不应该存在取消事件的标记。
                        */</span> 
                        <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">/*
                            调用 dispatchTransformedTouchEvent 方法将按下事件分发给直接子View，
                            参数 cancel 固定位false，于是这里肯定不会将 ACTION_CANCEL 分发给直接子View
                        */</span> 
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                            <span class="token comment">/*
                                如果直接子View消费掉按下事件，那么就把直接子View以及按下事件的 pointerId 封装到 TouchTarget 中，
                                然后将该 TouchTarget 插入到触摸目标链表的头节点上，
                                也就是说触摸目标链表的头节点 mFirstTouchTarget 指向消费掉最后一个按下事件的直接子View。
                                注意：
                                只有当直接子View首次消费掉按下事件时成立，
                                直接子View非首次消费掉按下事件时，不是在这里分发处理的，不会改变链表的结构。
                            */</span>
                            newTouchTarget <span class="token operator">=</span> <span class="token function">addTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">/*
                                标记当前的按下事件已经被消费掉了，
                                避免在下面分发后续事件的代码中又分发一次。
                            */</span>
                            alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                            <span class="token comment">/*
                                执行 break 语句退出循环，于是已消费掉的按下事件不会再分发给其他直接子View了，
                                也就是说，如果按照分发顺序，优先接收到按下事件的直接子View消费掉按下事件了，
                                那么分发顺序靠后的其他直接子View即使能接收按下事件且按下事件发生在其区域内，
                                该按下事件也不会再分发给它们了。
                            */</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">/*
                    if 条件描述的情况只会在多点触摸时分发 ACTION_POINTER_DOWN 事件时发生：
                        如果已消费掉 ACTION_DOWN 事件的直接子View 无法接收 ACTION_POINTER_DOWN 事件，
                        且能接收 ACTION_POINTER_DOWN 事件的其他直接子View 也没有消费掉，
                        那么把当前的 ACTION_POINTER_DOWN 事件的 pointerId 添加到已消费掉 ACTION_DOWN 事件的直接子View的 TouchTarget 中，
                        在下面分发后续事件的代码中再分发一次该 ACTION_POINTER_DOWN 事件。
                */</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">/*
                        ACTION_DOWN 事件最先触发，所以会最先被消费掉，而消费掉按下事件的直接子View的 TouchTarget
                        总是插入到链表的头部，所以链表的尾节点就是消费掉 ACTION_DOWN 事件的直接子View对应的TouchTarget。
                        于是，这里就是将 ACTION_POINETR_DOWN 事件的 pointerId 的位表示形式 idBitsToAssign 添加到链表的尾节点上，
                        即消费掉 ACTION_DOWN 事件的直接子View对应的 TouchTarget 中。
                    */</span>
                    newTouchTarget <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>newTouchTarget<span class="token punctuation">.</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        newTouchTarget <span class="token operator">=</span> newTouchTarget<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    newTouchTarget<span class="token punctuation">.</span>pointerIdBits <span class="token operator">|=</span> idBitsToAssign<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div><h4 id="后续事件的分发" tabindex="-1"><a class="header-anchor" href="#后续事件的分发" aria-hidden="true">#</a> 后续事件的分发</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* ViewGroup.java */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MASK</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">;</span>
        
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> <span class="token constant">FLAG_SPLIT_MOTION_EVENTS</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有当前View未取消事件，且未拦截事件时，才分发按下事件</span>

            <span class="token class-name">View</span> childWithAccessibilityFocus <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">?</span> <span class="token function">findChildWithAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_POINTER_DOWN</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_HOVER_MOVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/*
            如果 mFirstTouchTarget == null 说明不存在消费掉按下事件的直接子View，
            此时按下事件由当前View自己处理，且同一事件序列中的后续事件也都由当前View自己处理，不再分发给直接子View。

            如果 mFirstTouchTarget != null 说明存在消费掉按下事件的直接子View，
            此时，当前View不会再处理被消费掉的按下事件，也不会再处理同一事件序列中的后续事件。
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/*
                参数 child 传 null，表示由当前View自己处理事件ev。
                如果当前View设置了 PFLAG_CANCEL_NEXT_UP_EVENT 标记，或者当前事件为 ACTION_CANCEL，
                那么参数 canceled 为 true，表示取消事件
                TouchTarget.ALL_POINTER_IDS 值为 -1，即int型参数 desiredPointerIdBits 的 32 位都是 1，
                表示不单独处理各个手指的触摸事件，因为此时就一个当前View在处理事件，没必要再单独分离各个手指处理了。
            */</span>
            handled <span class="token operator">=</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> canceled<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span><span class="token constant">ALL_POINTER_IDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里开始，进行后续事件的分发（包括 ACTION_POINTER_DOWN 事件）</span>
            <span class="token class-name">TouchTarget</span> predecessor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">TouchTarget</span> target <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">TouchTarget</span> next <span class="token operator">=</span> target<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                <span class="token comment">/*
                    alreadyDispatchedToNewTouchTarget 为 true，则当前事件可能是 ACTION_DOWN 或 ACTION_POINTER_DOWN，
                    且表示当前事件已经被 newTouchTarget中的直接子View消费掉了。
                    注意：
                        对于已消费掉的 ACTION_POINTER_DOWN 事件，不会再分发给消费过它的直接子View了，
                        但是还会分发给链表中的消费过其它按下事件的直接子View。
                        也就是说，在多点触摸中，不管 ACTION_POINTER_DOWN 事件有没有被消费掉，
                        都会分发给每个消费过按下事件的直接子View。

                        而对于已消费掉的 ACTION_DOWN 事件，不可能会在这里被再次分发。
                        因为分发 ACTION_DOWN 事件时，链接中除了消费掉它的直接子View外，不存在其他直接子View。
                */</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>alreadyDispatchedToNewTouchTarget <span class="token operator">&amp;&amp;</span> target <span class="token operator">==</span> newTouchTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">/*
                        如果消费掉按下事件的直接子View中设置了 PFLAG_CANCEL_NEXT_UP_EVENT 标记，或者当前View对事件进行了拦截，
                        那么分发给直接子View的会是 ACTION_CANCEL 事件，即在直接子View中会取消事件。
                    */</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> cancelChild <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>child<span class="token punctuation">)</span>
                            <span class="token operator">||</span> intercepted<span class="token punctuation">;</span>

                    <span class="token comment">// 这里会分发除 ACTION_DOWN 之外的其他事件。</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> cancelChild<span class="token punctuation">,</span>
                            target<span class="token punctuation">.</span>child<span class="token punctuation">,</span> target<span class="token punctuation">.</span>pointerIdBits<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">/*
                        对于取消事件的直接子View，在将 ACTION_CANCEL 分发给该直接子View后，
                        就会将其对应的 TouchTarget 从触摸目标链表中移除。
                        于是，该直接子View就不会再接收到同一事件序列中的后续事件了。
                    */</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cancelChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>predecessor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            mFirstTouchTarget <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            predecessor<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        target<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        target <span class="token operator">=</span> next<span class="token punctuation">;</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                predecessor <span class="token operator">=</span> target<span class="token punctuation">;</span>
                target <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><h3 id="viewgroup-dispatchtransformedtouchevent-方法分析" tabindex="-1"><a class="header-anchor" href="#viewgroup-dispatchtransformedtouchevent-方法分析" aria-hidden="true">#</a> ViewGroup.dispatchTransformedTouchEvent 方法分析</h3><p><strong><code>dispatchTransformedTouchEvent</code> 方法中主要考虑以下几种场景</strong></p><ol><li><p>取消事件的分发</p></li><li><p>当前<code>View</code>自己处理事件</p></li><li><p>多点触摸下只有部分手指按在直接子<code>View</code>中</p></li><li><p>直接子<code>View</code>的视图因补间动画而发生了改变</p></li></ol><p><strong>注意：</strong></p><ul><li>如果直接子<code>View</code>还是一个<code>ViewGroup</code>，那么在直接子<code>View</code>中，又会进行一次事件分发。也就是说，事件分发是一个递归的过程，直到直接子<code>View</code>是<code>View</code>为止。</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">,</span> <span class="token keyword">boolean</span> cancel<span class="token punctuation">,</span>
        <span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> desiredPointerIdBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> handled<span class="token punctuation">;</span>
    <span class="token comment">/*
        如果参数 cancel 为 true，那么就是分发取消事件，
        此时，不管真实触发的是什么事件，都当作 ACTION_CANCEL 事件进行分发。
    */</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> oldAction <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cancel <span class="token operator">||</span> oldAction <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当作 ACTION_CANCEL 事件进行分发</span>
        event<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 当前View自己处理取消事件（调用父类View的 dispatchTouchEvent 方法处理）</span>
            handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将取消事件分发给直接子View处理</span>
            handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 还原触发的真实事件类型</span>
        event<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>oldAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// oldPointerIdBits 表示所有按下的手指的 pointerId 的位表示形式的组合</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> oldPointerIdBits <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getPointerIdBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
        如果是当前View自己处理事件，那么 desiredPointerIdBits 的 32 位都是 1；
        如果一个直接子View只接收 1 个按下事件，那么 desiredPointerIdBits 只表示 1  个按下手指的 pointerId；
        如果一个直接子View可以接收多个按下事件，那么 desiredPointerIdBits 表示多个按下手指的 pointerId 的组合；
    */</span> 
    <span class="token keyword">final</span> <span class="token keyword">int</span> newPointerIdBits <span class="token operator">=</span> oldPointerIdBits <span class="token operator">&amp;</span> desiredPointerIdBits<span class="token punctuation">;</span>

    <span class="token comment">/*
        当前分发的事件的 desiredPointerIdBits 肯定不会传0，所以 newPointerIdBits == 0 的情况有 2 种：
            1. oldPointerIdBits == 0，即无法获取到本次事件序列中任何手指的 pointerId；
            2. 无法从本次事件序列的所有手指的 pointerId 中找到可以被当前直接子View接收的手指的 pointerId。
        不管是以上哪种情况，都无法正常地对事件进行分发了，所以当前事件肯定不会被消费掉，直接返回 false。
    */</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPointerIdBits <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token class-name">MotionEvent</span> transformedEvent<span class="token punctuation">;</span>
    <span class="token comment">/*
        newPointerIdBits == oldPointerIdBits 的情况有三种：
            1. 当前View自己处理事件时，desiredPointerIdBits 的 32 位都是 1 ，此时 newPointerIdBits == oldPointerIdBits；
            2. 单点触摸中，只存在 1 根手指，所以 newPointerIdBits == oldPointerIdBits 总是成立；
            3. 多点触摸中，所有手指的按下事件都被当前直接子View接收到了；

        newPointerIdBits != oldPointerIdBits 则表示：
            多点触摸中，当前直接子View只接收到部分手指触发的事件。
            这些部分手指的 pointerId 的位表示形式的组合就是 newPointerIdBits，
            此时，调用 event.split(newPointerIdBits) 方法将这些手指触发的事件分离出来。
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPointerIdBits <span class="token operator">==</span> oldPointerIdBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            child.hasIdentityMatrix() 返回 true，表示当前直接子View的视图没有因补间动画而发生改变，
            此时，可以在这里把事件分发给直接子View。
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> child<span class="token punctuation">.</span><span class="token function">hasIdentityMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当前View自己处理事件时，执行这里的，而不是执行下面的</span>
                handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 当前直接子View的视图没有因补间动画而发生改变时，在这里进行事件分发</span>
                <span class="token keyword">final</span> <span class="token keyword">float</span> offsetX <span class="token operator">=</span> mScrollX <span class="token operator">-</span> child<span class="token punctuation">.</span>mLeft<span class="token punctuation">;</span>
                <span class="token keyword">final</span> <span class="token keyword">float</span> offsetY <span class="token operator">=</span> mScrollY <span class="token operator">-</span> child<span class="token punctuation">.</span>mTop<span class="token punctuation">;</span>
                event<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
                handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                event<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetX<span class="token punctuation">,</span> <span class="token operator">-</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果当前直接子View的视图因补间动画而发生改变了，那么事件分发会在下面再进行。</span>
        transformedEvent <span class="token operator">=</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 将按在当前直接子View上的那些手指所触发的事件分离出来。</span>
        transformedEvent <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>newPointerIdBits<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">/*
            当前View自己处理事件时，newPointerIdBits == oldPointerIdBits 肯定成立，所以不会走这里。
        */</span>
        handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            在这里分发事件的情况有两种：
                1. 将分离出来的按在当前直接子View上的那些手指所触发的事件分发给当前直接子View。
                2. 按下事件都发生在当前直接子View中，但直接子View因补间动画发生了视图变换。
        */</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> offsetX <span class="token operator">=</span> mScrollX <span class="token operator">-</span> child<span class="token punctuation">.</span>mLeft<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> offsetY <span class="token operator">=</span> mScrollY <span class="token operator">-</span> child<span class="token punctuation">.</span>mTop<span class="token punctuation">;</span>
        transformedEvent<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> child<span class="token punctuation">.</span><span class="token function">hasIdentityMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果直接子View因补间动画发生了视图变换，那么需要通过逆矩阵将触摸事件转换成适应视图变换后的直接子View。</span>
            transformedEvent<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getInverseMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 把事件分发给直接子View</span>
        handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    transformedEvent<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><h3 id="viewgroup-自己处理事件" tabindex="-1"><a class="header-anchor" href="#viewgroup-自己处理事件" aria-hidden="true">#</a> <code>ViewGroup</code> 自己处理事件</h3><p><code>ViewGroup</code> 通过调用父类 <code>View</code> 的 <code>dispatchTouchEvent(MotionEvent event)</code> 方法来处理事件。</p><h2 id="view-的事件处理流程" tabindex="-1"><a class="header-anchor" href="#view-的事件处理流程" aria-hidden="true">#</a> <code>View</code> 的事件处理流程</h2><p>这里的<code>View</code> 特指没有子<code>View</code>的视图，所以事件分发到了 <code>View</code> 中，就分发完成了，此时开始处理事件。</p><p><img src="/assets/08.8375b4eb.png" alt="" loading="lazy"></p><h3 id="view-dispatchtouchevent-方法分析" tabindex="-1"><a class="header-anchor" href="#view-dispatchtouchevent-方法分析" aria-hidden="true">#</a> <code>View.dispatchTouchEvent</code> 方法分析</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">isTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            如果事件是由无障碍服务发起的，但是处理该事件的View并不是无障碍服务设置的焦点View，
            那么就不消费掉事件，返回 false。
        */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAccessibilityFocusedViewOrHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        event<span class="token punctuation">.</span><span class="token function">setTargetAccessibilityFocus</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getActionMasked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ACTION_DOWN 是一次事件序列的开始，在开始处理前，保证未结束的嵌套滑动先停下来。</span>
        <span class="token function">stopNestedScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用 onFilterTouchEventForSecurity 方法过滤掉不安全的触摸事件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">/*
            根据View的使能状态（enabled），在View中处理事件时分两种情况：
                1. 使能状态标记为 ENABLE：
                    1.1 若当前事件表示按下鼠标左键拖动View的滚动条，则先标记为消息掉事件，
                    然后在设置了 OnTouchListener 的情况下，再执行 OnTouchListener.onTouch 方法处理事件。
                    此时，不管 OnTouchListener.onTouch 方法是否消费掉事件，View都会消费掉事件。
                    因为已经肯定View会消费掉事件了，所以不再执行 View.onTouchEvent 方法。
                    1.2 若当前事件不是按下鼠标左键拖动View的滚动条，则默认不消费掉事件，
                    然后在设置了 OnTouchListener 的情况下，再执行 OnTouchListener.onTouch 方法处理事件。
                    此时，若 OnTouchListener.onTouch 方法消费掉事件，则不再执行 View.onTouchEvent 方法；
                    若 OnTouchListener.onTouch 方法没有消费掉事件，则接着执行 View.onTouchEvent 方法，
                    此时，View是否消费掉事件，由 View.onTouchEvent 方法的返回值确定。
                2. 使能状态标记为 DISABLED：
                    此时，不管当前事件是否为按下鼠标左键拖动View的滚动条，也不管是否设置了 OnTouchListener，
                    都默认为不消费掉事件，并且也不会去执行 OnTouchListener.onTouch 方法，
                    而是通过执行 View.onTouchEvent 方法来处理事件，
                    此时，View是否消费掉事件，仅由 View.onTouchEvent 方法的返回值确定。
        */</span>

        <span class="token comment">// 当按下鼠标左键拖动View的滚动条时，handleScrollBarDragging 方法返回 true。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> <span class="token constant">ENABLED_MASK</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">ENABLED</span> <span class="token operator">&amp;&amp;</span> <span class="token function">handleScrollBarDragging</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/*
            在View中设置的 OnClickListener，OnLongClickListener，OnTouchListener，OnKeyListener，
            等事件监听器都会注册在 mListenerInfo 中。
        */</span>
        <span class="token class-name">ListenerInfo</span> li <span class="token operator">=</span> mListenerInfo<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>li <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener <span class="token operator">!=</span> <span class="token keyword">null</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> <span class="token constant">ENABLED_MASK</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">ENABLED</span>
                <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener<span class="token punctuation">.</span><span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 先执行 OnTouchListener.onTouch 方法</span>
            result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result <span class="token operator">&amp;&amp;</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 再执行 View.onTouchEvent 方法</span>
            result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/*
        以下三种情况会停止嵌套滑动：
            1. 接收到了同一事件序列中最后触发的抬起事件；
            2. 接收到了取消事件；
            3. 接收到按下事件，但没有消费掉。
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span> <span class="token operator">||</span>
            actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_CANCEL</span> <span class="token operator">||</span>
            <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DOWN</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">stopNestedScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h3 id="view-ontouchevent-方法分析" tabindex="-1"><a class="header-anchor" href="#view-ontouchevent-方法分析" aria-hidden="true">#</a> <code>View.onTouchEvent</code> 方法分析</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">float</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> viewFlags <span class="token operator">=</span> mViewFlags<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
        判断View是否可点击，只要满足以下 3 个条件之一即可：
            1. 设置了 CLICKABLE 标记，在设置 OnClickListener 监听器时，会调用 setClickable(true) 方法设置该标记；
            2. 设置了 LONG_CLICKABLE 标记，在设置 OnLongClickListener 监听器时，会调用 setLongClickable(true) 方法设置该标记；
            3. 设置了 CONTEXT_CLICKABLE 标记，在设置 OnContextClickListener 监听器时，会调用 setContextClickable(true) 方法设置该标记；
    */</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> clickable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> <span class="token constant">CLICKABLE</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">CLICKABLE</span>
            <span class="token operator">||</span> <span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> <span class="token constant">LONG_CLICKABLE</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">LONG_CLICKABLE</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> <span class="token constant">CONTEXT_CLICKABLE</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">CONTEXT_CLICKABLE</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> <span class="token constant">ENABLED_MASK</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">DISABLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token constant">PFLAG_PRESSED</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mPrivateFlags3 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token constant">PFLAG3_FINGER_DOWN</span><span class="token punctuation">;</span>
        <span class="token comment">// A disabled view that is clickable still consumes the touch</span>
        <span class="token comment">// events, it just doesn&#39;t respond to them.</span>
        <span class="token comment">/*
            如果View是可点击的，那么即使View的使能状态为 DISABLED，View.onTouchEvent 方法也会消费掉事件，
            即：只要View是可点击的，即使没有触发点击效果，那么 View.onTouchEvent 方法也会消费掉事件。
        */</span>
        <span class="token keyword">return</span> clickable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        如果View调用了 setTouchDelegate 方法设置了一个触摸代理对象 mTouchDelegate，
        那么在 View.onTouchEvent 方法中，先让 mTouchDelegate 来处理事件，
        若 mTouchDelegate 消费掉了事件，则直接返回 true，否则才让View自己来处理事件。
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
        如果View调用了 setTooltipText 方法设置了 tooltip 文本，就会设置 TOOLTIP 标记。
        tooltip文件是在 Android 8.0 中添加的。这里只考虑 clickable 即可。
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>clickable <span class="token operator">||</span> <span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> <span class="token constant">TOOLTIP</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">TOOLTIP</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

        <span class="token comment">// 只要View是可点击的，那么 View.onTouchEvent 方法一定会消费掉事件。</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p><strong>注意</strong></p><p>只要<code>View</code>是可点击的，那么 <code>View.onTouchEvent</code> 方法一定会消费掉事件。这句话并不意味着只要<code>View</code>是可点击的，那么<code>View</code>一定会消费掉事件。只有当<code>View</code>是否消费掉事件，由 <code>View.onTouchEvent</code> 方法的返回值确定时才成立。</p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zengkaiqiang562/JavaGuide/edit/main/docs/zkq/android/basic/event-dispatch-mechanism.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/7/8 14:42:00</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zengkaiqiang562@163.com">zengk</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zkq/android/basic/ui-draw-process.html" class="nav-link prev" arialabel="UI绘制流程（DOING）"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->UI绘制流程（DOING）</div></a><!----></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2023 Zenk562</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.625aa393.js" defer></script>
  </body>
</html>
