<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zengkaiqiang562.github.io/zkq/java/jvm/classloader.html"><meta property="og:site_name" content="Android Guide"><meta property="og:title" content="类加载、连接和初始化"><meta property="og:type" content="article"><meta property="og:image" content="https://zengkaiqiang562.github.io/"><meta property="og:updated_time" content="2022-07-07T15:59:00.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="类加载、连接和初始化"><meta property="article:tag" content="java"><meta property="article:modified_time" content="2022-07-07T15:59:00.000Z"><script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2922463_99aa80ii7cf.css"><title>类加载、连接和初始化 | Android Guide</title><meta name="description" content="Android 学习 && 面试指南">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.5a38b724.css">
    <link rel="modulepreload" href="/assets/app.625aa393.js"><link rel="modulepreload" href="/assets/classloader.html.2664440c.js"><link rel="modulepreload" href="/assets/classloader.html.30cc082d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.png" alt="Android Guide"><!----><span class="site-name hide-in-pad">Android Guide</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" arialabel="面试指南"><i class="icon iconfont icon-java"></i>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zhuanlan/" class="nav-link" arialabel="优质专栏"><i class="icon iconfont icon-recommend"></i>优质专栏<!----></a></div><div class="nav-item hide-in-mobile"><a href="/open-source-project/" class="nav-link" arialabel="项目精选"><i class="icon iconfont icon-github"></i>项目精选<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://snailclimb.gitee.io/javaguide/#/" rel="noopener noreferrer" target="_blank" arialabel="旧版链接" class="nav-link"><i class="icon iconfont icon-java"></i>旧版链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://javaguide.cn/feed.json" rel="noopener noreferrer" target="_blank" arialabel="RSS订阅" class="nav-link"><i class="icon iconfont icon-rss"></i>RSS订阅<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/about-the-author/" class="nav-link" arialabel="关于作者"><i class="icon iconfont icon-zuozhe"></i>关于作者<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zengkaiqiang562/JavaGuide" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" arialabelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" arialabelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" arialabelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zkq/java/reflect.html" class="nav-link sidebar-link sidebar-page" arialabel="反射机制"><!---->反射机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/annotation.html" class="nav-link sidebar-link sidebar-page" arialabel="注解技术"><!---->注解技术<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/genericity.html" class="nav-link sidebar-link sidebar-page" arialabel="泛型编程（TODO）"><!---->泛型编程（TODO）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/thread.html" class="nav-link sidebar-link sidebar-page" arialabel="线程"><!---->线程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/threadpool.html" class="nav-link sidebar-link sidebar-page" arialabel="线程池"><!---->线程池<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/jmm.html" class="nav-link sidebar-link sidebar-page" arialabel="Java 内存模型（JMM）"><!---->Java 内存模型（JMM）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">JVM</span><span class="arrow down"></span></button><!--[--><ul class="sidebar-links"><li><!--[--><a href="/zkq/java/jvm/jvm-spec.html" class="nav-link sidebar-link sidebar-page" arialabel="认识 JVM 规范（JVM 概述、字节码指令集、Class文件解析、ASM）"><!---->认识 JVM 规范（JVM 概述、字节码指令集、Class文件解析、ASM）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zkq/java/jvm/classloader.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="类加载、连接和初始化"><!---->类加载、连接和初始化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_1-类从加载、连接、初始化-到卸载的生命周期及概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. 类从加载、连接、初始化，到卸载的生命周期及概述"><!---->1. 类从加载、连接、初始化，到卸载的生命周期及概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-类的加载" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. 类的加载"><!---->2. 类的加载<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-1-类加载要完成的功能" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 类加载要完成的功能"><!---->2.1 类加载要完成的功能<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-2-类加载的方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 类加载的方式"><!---->2.2 类加载的方式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-类加载器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3 类加载器"><!---->2.3 类加载器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-java-虚拟机自带的加载器-系统类加载器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1 Java 虚拟机自带的加载器（系统类加载器）"><!---->2.3.1 Java 虚拟机自带的加载器（系统类加载器）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-1-启动类加载器-bootstrapclassloader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1.1 启动类加载器（BootstrapClassLoader）"><!---->2.3.1.1 启动类加载器（BootstrapClassLoader）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-2-平台类加载器-platformclassloader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1.2 平台类加载器（PlatformClassLoader）"><!---->2.3.1.2 平台类加载器（PlatformClassLoader）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-3-扩展类加载器-extensionclassloader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1.3 扩展类加载器（ExtensionClassLoader）"><!---->2.3.1.3 扩展类加载器（ExtensionClassLoader）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-4-应用程序类加载器-appclassloader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.1.4 应用程序类加载器（AppClassLoader）"><!---->2.3.1.4 应用程序类加载器（AppClassLoader）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-2-自定义类加载器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.2 自定义类加载器"><!---->2.3.2 自定义类加载器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-2-1-自定义类加载器举例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.2.1 自定义类加载器举例"><!---->2.3.2.1 自定义类加载器举例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-3-类加载器之间的关系" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.3 类加载器之间的关系"><!---->2.3.3 类加载器之间的关系<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-4-注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.3.4 注意事项"><!---->2.3.4 注意事项<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-双亲委派模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4 双亲委派模型"><!---->2.4 双亲委派模型<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-1-双亲委派模型的工作过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.1 双亲委派模型的工作过程"><!---->2.4.1 双亲委派模型的工作过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-2-定义类加载器-初始类加载器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.2 定义类加载器 &amp; 初始类加载器"><!---->2.4.2 定义类加载器 &amp; 初始类加载器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-3-注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.3 注意事项"><!---->2.4.3 注意事项<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-4-破坏双亲委派模型-线程上下文类加载器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.4.4 破坏双亲委派模型 &amp; 线程上下文类加载器"><!---->2.4.4 破坏双亲委派模型 &amp; 线程上下文类加载器<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-类的连接" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. 类的连接"><!---->3. 类的连接<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-1-验证" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1 验证"><!---->3.1 验证<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-1-1-验证的主要内容" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1.1 验证的主要内容"><!---->3.1.1 验证的主要内容<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-2-准备" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.2 准备"><!---->3.2 准备<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-3-解析-常量池中的符号引用转换成直接引用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.3 解析（常量池中的符号引用转换成直接引用）"><!---->3.3 解析（常量池中的符号引用转换成直接引用）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-类的初始化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. 类的初始化"><!---->4. 类的初始化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-1-类初始化的过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.1 类初始化的过程"><!---->4.1 类初始化的过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-类初始化的时机-对类的首次主动使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2 类初始化的时机（对类的首次主动使用）"><!---->4.2 类初始化的时机（对类的首次主动使用）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-1-主动使用的情况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2.1 主动使用的情况"><!---->4.2.1 主动使用的情况<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-2-被动使用的情况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2.2 被动使用的情况"><!---->4.2.2 被动使用的情况<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-3-举例说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2.3 举例说明"><!---->4.2.3 举例说明<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_5-类的卸载" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. 类的卸载"><!---->5. 类的卸载<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/zkq/java/jvm/memory-allocate.html" class="nav-link sidebar-link sidebar-page" arialabel="内存分配"><!---->内存分配<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/jvm/class-exe-engine.html" class="nav-link sidebar-link sidebar-page" arialabel="字节码执行引擎"><!---->字节码执行引擎<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/jvm/gc.html" class="nav-link sidebar-link sidebar-page" arialabel="垃圾回收"><!---->垃圾回收<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/java/jvm/concurrence.html" class="nav-link sidebar-link sidebar-page" arialabel="高效并发"><!---->高效并发<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->类加载、连接和初始化</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://zengkaiqiang562.github.io/" target="_blank" rel="noopener noreferrer">Zenk562</a></span><span property="author" content="Zenk562"></span></span><span class="category-info" arialabel="分类🌈" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category clickable" role="navigation">java</li><meta property="articleSection" content="java"></ul></span><span arialabel="标签🏷" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag clickable" role="navigation">java</li></ul><meta property="keywords" content="java"></span><span class="date-info" arialabel="写作日期📅" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年7月7日</span><meta property="datePublished" content="2022-07-07T15:59:00.000Z"></span><!----><span class="words-info" arialabel="字数🔠" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" arialabelledby="word"><title id="word" lang="en">word icon</title><g fill="currentColor"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></g></svg><span>约 3068 字</span><meta property="wordCount" content="3068"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_1-类从加载、连接、初始化-到卸载的生命周期及概述" class="router-link-active router-link-exact-active toc-link level2">1. 类从加载、连接、初始化，到卸载的生命周期及概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-类的加载" class="router-link-active router-link-exact-active toc-link level2">2. 类的加载</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-1-类加载要完成的功能" class="router-link-active router-link-exact-active toc-link level3">2.1 类加载要完成的功能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-2-类加载的方式" class="router-link-active router-link-exact-active toc-link level3">2.2 类加载的方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-类加载器" class="router-link-active router-link-exact-active toc-link level3">2.3 类加载器</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-java-虚拟机自带的加载器-系统类加载器" class="router-link-active router-link-exact-active toc-link level4">2.3.1 Java 虚拟机自带的加载器（系统类加载器）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-1-启动类加载器-bootstrapclassloader" class="router-link-active router-link-exact-active toc-link level5">2.3.1.1 启动类加载器（BootstrapClassLoader）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-2-平台类加载器-platformclassloader" class="router-link-active router-link-exact-active toc-link level5">2.3.1.2 平台类加载器（PlatformClassLoader）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-3-扩展类加载器-extensionclassloader" class="router-link-active router-link-exact-active toc-link level5">2.3.1.3 扩展类加载器（ExtensionClassLoader）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-1-4-应用程序类加载器-appclassloader" class="router-link-active router-link-exact-active toc-link level5">2.3.1.4 应用程序类加载器（AppClassLoader）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-2-自定义类加载器" class="router-link-active router-link-exact-active toc-link level4">2.3.2 自定义类加载器</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-2-1-自定义类加载器举例" class="router-link-active router-link-exact-active toc-link level5">2.3.2.1 自定义类加载器举例</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-3-类加载器之间的关系" class="router-link-active router-link-exact-active toc-link level4">2.3.3 类加载器之间的关系</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-3-4-注意事项" class="router-link-active router-link-exact-active toc-link level4">2.3.4 注意事项</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-双亲委派模型" class="router-link-active router-link-exact-active toc-link level3">2.4 双亲委派模型</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-1-双亲委派模型的工作过程" class="router-link-active router-link-exact-active toc-link level4">2.4.1 双亲委派模型的工作过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-2-定义类加载器-初始类加载器" class="router-link-active router-link-exact-active toc-link level4">2.4.2 定义类加载器 &amp; 初始类加载器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-3-注意事项" class="router-link-active router-link-exact-active toc-link level4">2.4.3 注意事项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_2-4-4-破坏双亲委派模型-线程上下文类加载器" class="router-link-active router-link-exact-active toc-link level4">2.4.4 破坏双亲委派模型 &amp; 线程上下文类加载器</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-类的连接" class="router-link-active router-link-exact-active toc-link level2">3. 类的连接</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-1-验证" class="router-link-active router-link-exact-active toc-link level3">3.1 验证</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-1-1-验证的主要内容" class="router-link-active router-link-exact-active toc-link level4">3.1.1 验证的主要内容</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-2-准备" class="router-link-active router-link-exact-active toc-link level3">3.2 准备</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_3-3-解析-常量池中的符号引用转换成直接引用" class="router-link-active router-link-exact-active toc-link level3">3.3 解析（常量池中的符号引用转换成直接引用）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-类的初始化" class="router-link-active router-link-exact-active toc-link level2">4. 类的初始化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-1-类初始化的过程" class="router-link-active router-link-exact-active toc-link level3">4.1 类初始化的过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-类初始化的时机-对类的首次主动使用" class="router-link-active router-link-exact-active toc-link level3">4.2 类初始化的时机（对类的首次主动使用）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-1-主动使用的情况" class="router-link-active router-link-exact-active toc-link level4">4.2.1 主动使用的情况</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-2-被动使用的情况" class="router-link-active router-link-exact-active toc-link level4">4.2.2 被动使用的情况</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_4-2-3-举例说明" class="router-link-active router-link-exact-active toc-link level4">4.2.3 举例说明</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/java/jvm/classloader.html#_5-类的卸载" class="router-link-active router-link-exact-active toc-link level2">5. 类的卸载</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h2 id="_1-类从加载、连接、初始化-到卸载的生命周期及概述" tabindex="-1"><a class="header-anchor" href="#_1-类从加载、连接、初始化-到卸载的生命周期及概述" aria-hidden="true">#</a> 1. 类从加载、连接、初始化，到卸载的生命周期及概述</h2><p><img src="/assets/01.4346ed86.png" alt="" loading="lazy"></p><ol><li><p>加载：查找并加载 <code>class</code> 文件中的二进制数据</p></li><li><p>连接：将已读入内存的 <code>class</code> 文件的二进制数据合并到 <code>JVM</code> 运行时环境中去，包含如下几个步骤：</p><ol><li><p>验证：确保被加载的类的正确性。</p></li><li><p>准备：为类的 <strong>静态变量</strong> 分配内存，并初始化它们。</p><blockquote><p>注意：这里的初始化就是设置默认值 <code>0</code>（引用变量则是 <code>null</code>）。</p></blockquote></li><li><p>解析：把常量池中的符号引用转换成直接引用。</p></li></ol></li><li><p>初始化：为类的 <strong>静态变量</strong> 赋初始化值</p><blockquote><p>注意：这里的初始值就是我们在源码中定义的初始值。</p></blockquote></li></ol><h2 id="_2-类的加载" tabindex="-1"><a class="header-anchor" href="#_2-类的加载" aria-hidden="true">#</a> 2. 类的加载</h2><h3 id="_2-1-类加载要完成的功能" tabindex="-1"><a class="header-anchor" href="#_2-1-类加载要完成的功能" aria-hidden="true">#</a> 2.1 类加载要完成的功能</h3><p>在类的加载阶段要完成的功能有：</p><ol><li><p>通过类的全限定名来获取该类的 <code>class</code> 文件中的二进制字节流数据；</p></li><li><p>把二进制字节流数据转换为方法区的运行时数据结构（也就是说 <strong>类加载完成之后，就保存在方法区中了</strong>）。</p></li><li><p>在堆中创建一个 <code>java.lang.Class</code> 对象，用来 <strong>封装类在方法区中的数据结构，并向外提供了访问方法区内数据结构的接口</strong>。</p></li></ol><h3 id="_2-2-类加载的方式" tabindex="-1"><a class="header-anchor" href="#_2-2-类加载的方式" aria-hidden="true">#</a> 2.2 类加载的方式</h3><ol><li><p>最常见的方式：</p><ol><li>从本地文件系统中加载；</li><li>从 <code>jar</code> 等归档文件中加载；</li></ol></li><li><p>动态的方式：</p><ol><li>将 <code>java</code> 源文件 <strong>动态编译</strong> 成 <code>class</code></li></ol></li><li><p>其他方式：</p><ol><li>从网络中下载；</li><li>从专有数据库中加载；</li><li>......</li></ol></li></ol><h3 id="_2-3-类加载器" tabindex="-1"><a class="header-anchor" href="#_2-3-类加载器" aria-hidden="true">#</a> 2.3 类加载器</h3><h4 id="_2-3-1-java-虚拟机自带的加载器-系统类加载器" tabindex="-1"><a class="header-anchor" href="#_2-3-1-java-虚拟机自带的加载器-系统类加载器" aria-hidden="true">#</a> 2.3.1 <code>Java</code> 虚拟机自带的加载器（系统类加载器）</h4><p><code>Java</code> 虚拟机自带的加载器包括：</p><ol><li><p>启动类加载器（<code>BootstrapClassLoader</code>）；</p></li><li><p>平台类加载器（<code>PlatformClassLoader</code>）；</p><blockquote><p><code>JDK 9</code> 之后就将 <code>JDK 8</code> 中的扩展类加载器（<code>ExtensionClassLoader</code>）废除了，新增了平台类加载器。 这是因为：</p><ol><li><p>扩展类加载器不安全；</p></li><li><p><code>JDK 9</code> 之后新增的模块化开发完全可以代替扩展类加载器。</p></li></ol></blockquote></li><li><p>应用程序类加载器（<code>AppClassLoader</code>）。</p></li></ol><h5 id="_2-3-1-1-启动类加载器-bootstrapclassloader" tabindex="-1"><a class="header-anchor" href="#_2-3-1-1-启动类加载器-bootstrapclassloader" aria-hidden="true">#</a> 2.3.1.1 启动类加载器（<code>BootstrapClassLoader</code>）</h5><ol><li><p><code>JDK 9</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>用于加载启动的基础模块类，比如：java.base、java.management、java.xml 等。
（JDK 9 中新增了模块的概念）
</code></pre></div></li><li><p><code>JDK 8</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>负责加载 &lt;JAVA_HOME&gt;/lib，或者 -Xbootclasspath 参数指定的路径下的，且是虚拟机识别的类库。
（按照名字识别，比如 rt.jar。对于不能识别的文件不予装载）
</code></pre></div></li></ol><blockquote><p>如果一个类是通过启动类加载器加载出来的，那么该类对应的 <code>Class</code> 对象的 <code>getClassCloader()</code> 方法返回 <code>null</code> 。</p></blockquote><h5 id="_2-3-1-2-平台类加载器-platformclassloader" tabindex="-1"><a class="header-anchor" href="#_2-3-1-2-平台类加载器-platformclassloader" aria-hidden="true">#</a> 2.3.1.2 平台类加载器（<code>PlatformClassLoader</code>）</h5><ol><li><p><code>JDK 9</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>用于加载一些平台相关的模块，比如：java.scripting、java.compiler*、java.corba* 等。
（JDK 9 中新增了模块的概念）
</code></pre></div></li><li><p><code>JDK 8</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>平台类加载器是在 JDK 9 中才提出来的，用于代替扩展类加载器。
</code></pre></div></li></ol><h5 id="_2-3-1-3-扩展类加载器-extensionclassloader" tabindex="-1"><a class="header-anchor" href="#_2-3-1-3-扩展类加载器-extensionclassloader" aria-hidden="true">#</a> 2.3.1.3 扩展类加载器（<code>ExtensionClassLoader</code>）</h5><ol><li><p><code>JDK 9</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>扩展类加载器在 JDK 9 中已废除，被平台类加载器所取代。
</code></pre></div></li><li><p><code>JDK 8</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>负责加载 &lt;JRE_HOME&gt;/lib/ext，或者 java.ext.dirs 系统变量所指定的路径下的所有类库。
</code></pre></div></li></ol><h5 id="_2-3-1-4-应用程序类加载器-appclassloader" tabindex="-1"><a class="header-anchor" href="#_2-3-1-4-应用程序类加载器-appclassloader" aria-hidden="true">#</a> 2.3.1.4 应用程序类加载器（<code>AppClassLoader</code>）</h5><ol><li><p><code>JDK 9</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>用于加载应用级别的模块，比如：jdk.compiler、jdk.jartoor、jdk.jshell 等；
（JDK 9 中新增了模块的概念）

还用于加载 `classpath` 路径下的所有类库。
</code></pre></div></li><li><p><code>JDK 8</code> 中：</p><div class="language-text ext-text"><pre class="language-text"><code>负责加载 `classpath` 路径下的所有类库。
</code></pre></div></li></ol><h4 id="_2-3-2-自定义类加载器" tabindex="-1"><a class="header-anchor" href="#_2-3-2-自定义类加载器" aria-hidden="true">#</a> 2.3.2 自定义类加载器</h4><p>自定义类加载器就是用户自定义的加载器：</p><ol><li>自定义类加载器是 <code>java.lang.ClassLoader</code> 的子类；</li><li>通过自定义类加载器用户可以定制类的加载方式；</li></ol><blockquote><p>注意：自定义类加载器的加载顺序在所有系统类加载器之后。</p></blockquote><h5 id="_2-3-2-1-自定义类加载器举例" tabindex="-1"><a class="header-anchor" href="#_2-3-2-1-自定义类加载器举例" aria-hidden="true">#</a> 2.3.2.1 自定义类加载器举例</h5><p>继承 <code>ClassLoader</code> 实现自定义类加载器时，推荐重写 <code>findClass()</code> 方法</p><p><img src="/assets/03.b80de288.png" alt="" loading="lazy"></p><p><img src="/assets/04.1a31cbd5.png" alt="" loading="lazy"></p><blockquote><p>由于 <code>MyClass</code> 类的 <code>class</code> 文件会自动在 <code>bin/</code> 目录下生成（即在 <code>AppClassLoader</code> 的 <code>classpath</code> 路径下），所以最终还是 <code>AppClassLoader</code> 来加载 <code>MyClass</code>。</p><p>要想使用 <code>MyClassLoader</code> 来加载 <code>MyClass</code> 类，将 <code>bin/</code> 目录下生成的 <code>MyClass.class</code> 删除即可。</p></blockquote><h4 id="_2-3-3-类加载器之间的关系" tabindex="-1"><a class="header-anchor" href="#_2-3-3-类加载器之间的关系" aria-hidden="true">#</a> 2.3.3 类加载器之间的关系</h4><p><img src="/assets/02.6f20fabc.png" alt="" loading="lazy"></p><h4 id="_2-3-4-注意事项" tabindex="-1"><a class="header-anchor" href="#_2-3-4-注意事项" aria-hidden="true">#</a> 2.3.4 注意事项</h4><ol><li><p>不能直接在 <code>Java</code> 程序中引用启动类加载器（即不能直接设置 <code>ClassLoader</code> 为 <code>null</code>）。</p></li><li><p>类加载器并不需要等到某个类 <strong>首次主动使用</strong> 时才加载它。</p><blockquote><p><code>JVM</code> 规范允许类加载器在预料到某个类将要被使用的时候就预先加载它。</p></blockquote></li><li><p>如果某个类的 <code>class</code> 文件在加载的时候缺失了，那么会在该类 <strong>首次主动使用</strong> 的时候才报 <code>LinkageError</code> 错误。</p><blockquote><p>如果一直没有被使用，那么就不会报该错误。</p></blockquote></li></ol><h3 id="_2-4-双亲委派模型" tabindex="-1"><a class="header-anchor" href="#_2-4-双亲委派模型" aria-hidden="true">#</a> 2.4 双亲委派模型</h3><p><code>JVM</code> 中的 <code>ClassLoader</code> 通常采用双亲委派模型。该模型要求除了启动类加载器外，其它的类加载器都应该有自己的父级加载器。</p><blockquote><p>注意：这里的父子关系是组合，而不是继承。</p></blockquote><p>双亲委派模块对于保证 <code>Java</code> 程序的稳定运作很重要。</p><p>实现双亲委派的代码在 <code>java.lang.ClassLoader</code> 的 <code>loadClass()</code> 方法中。</p><blockquote><p>继承 <code>ClassLoader</code> 实现自定义类加载器时，推荐重写 <code>findClass()</code> 方法</p></blockquote><h4 id="_2-4-1-双亲委派模型的工作过程" tabindex="-1"><a class="header-anchor" href="#_2-4-1-双亲委派模型的工作过程" aria-hidden="true">#</a> 2.4.1 双亲委派模型的工作过程</h4><p>工作过程如下：</p><ol><li><p>一个类加载器接收到类加载请求后，首先搜索它的内建加载器定义的所有 <strong>具名模块</strong>；</p></li><li><p>如果找到了合适的模块定义，将会使用该加载器来加载；</p></li><li><p>如果 <code>class</code> 没有在这些加载器定义的 <strong>具名模块</strong> 中找到，那么将会委托给父级加载器（直到启动类加载器）；</p></li><li><p>如果父级加载器反馈它不能完成加载请求，比如在它的搜索路径下找不到这个类，那么子的类加载器才自己来加载；</p></li><li><p>在类路径下找到的类将成为这些加载器的 <strong>无名模块</strong>。</p></li></ol><blockquote><p>注意：<code>JDK 8</code> 中还不存在 <strong>模块</strong> 的概念，所以没有 “搜索内存加载器定义的具名模块” 这个步骤，也就是说 <code>JDK 8</code> 中不存在第 <code>2</code> 步。</p><p>即：<code>JDK 8</code> 中，子级加载器直接委托给父级加载器。</p></blockquote><h4 id="_2-4-2-定义类加载器-初始类加载器" tabindex="-1"><a class="header-anchor" href="#_2-4-2-定义类加载器-初始类加载器" aria-hidden="true">#</a> 2.4.2 定义类加载器 &amp; 初始类加载器</h4><p>如果有一个类加载器能加载某个类，称为定义类加载器。</p><p>所有能成功返回该类的 <code>class</code> 的类加载器，都被称为初始类加载器。</p><h4 id="_2-4-3-注意事项" tabindex="-1"><a class="header-anchor" href="#_2-4-3-注意事项" aria-hidden="true">#</a> 2.4.3 注意事项</h4><ol><li><p>如果没有指定父加载器，默认就是启动加载器。</p></li><li><p>每个类加载器都有自己的命名空间，命名空间由该加载器及其所有父加载器所加载的类构成。</p><blockquote><p>不同的命名空间，可以出现类的全路径名相同的情况。</p></blockquote></li><li><p>运行时包由同一个类加载器的类构成，决定两个类是否属于同一个运行时包，不仅要看全路径名是否一样，还要看定义类加载器是否相同。</p><blockquote><p>只有属于同一个运行时包的类才能实现相互包内可见。</p></blockquote></li></ol><h4 id="_2-4-4-破坏双亲委派模型-线程上下文类加载器" tabindex="-1"><a class="header-anchor" href="#_2-4-4-破坏双亲委派模型-线程上下文类加载器" aria-hidden="true">#</a> 2.4.4 破坏双亲委派模型 &amp; 线程上下文类加载器</h4><p>双亲委派模型存在这样一个问题：父加载器无法向下识别子加载器加载的资源。</p><p>为了解决这个问题，引入了线程上下文类加载器，可以通过 <code>Thread</code> 的 <code>setContextClassLoader()</code> 方法进行设置。</p><p>另外一种典型情况就是实现热替换，比如 <code>OSGI</code> 的模块化热部署。它的类加载器就不再是严格按照双亲委派模型，很多可能就在平级 的类加载器中执行了。</p><h2 id="_3-类的连接" tabindex="-1"><a class="header-anchor" href="#_3-类的连接" aria-hidden="true">#</a> 3. 类的连接</h2><h3 id="_3-1-验证" tabindex="-1"><a class="header-anchor" href="#_3-1-验证" aria-hidden="true">#</a> 3.1 验证</h3><h4 id="_3-1-1-验证的主要内容" tabindex="-1"><a class="header-anchor" href="#_3-1-1-验证的主要内容" aria-hidden="true">#</a> 3.1.1 验证的主要内容</h4><p>类连接时，验证的主要内容有：</p><ol><li><p>类文件结构检查：按照 <code>JVM</code> 规范规定的类文件结构进行。</p></li><li><p>元数据验证：对字节码描述的信息进行语义分析，保证其符合 <code>Java</code> 语言规范要求。</p></li><li><p>字节码验证：通过对数据流和控制流进行分析，确保程序语义是合法、且符合逻辑。</p><blockquote><p>这里主要是对方法体进行校验。</p></blockquote></li><li><p>符号引用验证：对类自身以外的信息，也就是常量池中的各种符号引用，进行匹配校验。</p></li></ol><h3 id="_3-2-准备" tabindex="-1"><a class="header-anchor" href="#_3-2-准备" aria-hidden="true">#</a> 3.2 准备</h3><p>为类的 <strong>静态变量</strong> 分配内存，并初始化它们。</p><blockquote><p>注意：这里的初始化就是系统自动设置默认值 <code>0</code>（引用变量则是 <code>null</code>）。</p></blockquote><h3 id="_3-3-解析-常量池中的符号引用转换成直接引用" tabindex="-1"><a class="header-anchor" href="#_3-3-解析-常量池中的符号引用转换成直接引用" aria-hidden="true">#</a> 3.3 解析（常量池中的符号引用转换成直接引用）</h3><p>所谓解析，就是把常量池中的符号引用转换成直接引用的过程。其中：</p><ol><li><p>符号引用：以一组无歧义的符号来描述所引用的目标。与虚拟机的实现无关。</p></li><li><p>直接引用：直接指向目标的指针、相对偏移量、或是能间接定位到目标的句柄。与虚拟机的实现有关。</p></li></ol><p>解析主要是针对：类、接口、字段、类方法、接口方法、方法类型、方法句柄、调用点限定符。</p><h2 id="_4-类的初始化" tabindex="-1"><a class="header-anchor" href="#_4-类的初始化" aria-hidden="true">#</a> 4. 类的初始化</h2><p>类的初始化就是为类的静态变量赋初始值，或者说是执行类构造器 <code>&lt;clinit&gt;</code> 方法的过程。</p><blockquote><p>这里的赋初始值指的是程序员在定义静态变量时（或者在静态代码块中）手动设置的初始值。</p></blockquote><h3 id="_4-1-类初始化的过程" tabindex="-1"><a class="header-anchor" href="#_4-1-类初始化的过程" aria-hidden="true">#</a> 4.1 类初始化的过程</h3><ol><li><p>如果类还没有加载和连接，就先加载和连接。</p></li><li><p>如果类存在父类 ，且父类没有初始化，就先初始化父类。</p></li><li><p>如果类中存在初始化语句，就依次执行这些初始化语句。</p></li><li><p>如果是接口的话：</p><ol><li>初始化一个类的时候，并不会先初始化它实现的接口。</li><li>初始化一个接口的时候，并不会先初始化它的父接口。</li><li>只有当程序首次使用接口里面的变量，或者调用接口方法时，才会导致接口的初始化。</li></ol></li><li><p>调用 <code>ClassLoader</code> 类的 <code>loadClass</code> 方法加载一个类时，并不会初始化该类。（这不是对类的主动使用）</p></li></ol><h3 id="_4-2-类初始化的时机-对类的首次主动使用" tabindex="-1"><a class="header-anchor" href="#_4-2-类初始化的时机-对类的首次主动使用" aria-hidden="true">#</a> 4.2 类初始化的时机（对类的首次主动使用）</h3><p><code>Java</code> 程序对类的使用方式分为：</p><ol><li><p>主动使用；</p></li><li><p>被动使用。</p></li></ol><p>类初始化的时机就是：<code>JVM</code> 必须在每个类或接口 <strong>首次主动使用</strong> 时才初始化它们。</p><blockquote><p>被动使用类不会导致类的初始化。</p></blockquote><h4 id="_4-2-1-主动使用的情况" tabindex="-1"><a class="header-anchor" href="#_4-2-1-主动使用的情况" aria-hidden="true">#</a> 4.2.1 主动使用的情况</h4><p>主动使用类或接口的情况包括：</p><ol><li><p>创建类实例；</p></li><li><p>访问某个类或接口的静态变量；</p></li><li><p>调用类的静态方法；</p></li><li><p>反射某个类；</p></li><li><p>初始化某个类的子类，而父类还没有初始化；</p></li><li><p><code>JVM</code> 启动的时候运行的主类；</p></li><li><p>定义了 <code>default</code> 方法的接口，当接口实现类初始化时。</p></li></ol><h4 id="_4-2-2-被动使用的情况" tabindex="-1"><a class="header-anchor" href="#_4-2-2-被动使用的情况" aria-hidden="true">#</a> 4.2.2 被动使用的情况</h4><p>被动使用类或接口的情况包括：</p><ol><li><p>通过子类引用父类的静态字段，不会导致子类的初始化；</p></li><li><p>当定义类类型的空数组时，不会导致类的初始化。如 <code>Foo[] foos = new Foo[3];</code></p></li><li><p>引用类的常量时（<code>final static</code> 修饰的成员变量），不会导致类的初始化。</p></li></ol><h4 id="_4-2-3-举例说明" tabindex="-1"><a class="header-anchor" href="#_4-2-3-举例说明" aria-hidden="true">#</a> 4.2.3 举例说明</h4><p><img src="/assets/05.320bfffe.png" alt="" loading="lazy"></p><p><img src="/assets/06.79f2b4ac.png" alt="" loading="lazy"></p><p><img src="/assets/07.02aa72a4.png" alt="" loading="lazy"></p><p><img src="/assets/08.4f1a29f2.png" alt="" loading="lazy"></p><h2 id="_5-类的卸载" tabindex="-1"><a class="header-anchor" href="#_5-类的卸载" aria-hidden="true">#</a> 5. 类的卸载</h2><p>当代表一个类的 <code>Class</code> 对象不再被引用时，那么 <code>Class</code> 对象的生命周期就结束了。<code>Class</code> 对象对应的在方法区中的数据也会被卸载。</p><p>注意：</p><ol><li><p><code>JVM</code> 自带的类加载器加载的类是不会被卸载的。</p></li><li><p>由自定义类加载器加载的类是可以卸载的。</p></li></ol><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zengkaiqiang562/JavaGuide/edit/main/docs/zkq/java/jvm/classloader.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/7/7 23:59:00</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zengkaiqiang562@163.com">zengk</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zkq/java/jvm/jvm-spec.html" class="nav-link prev" arialabel="认识 JVM 规范（JVM 概述、字节码指令集、Class文件解析、ASM）"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->认识 JVM 规范（JVM 概述、字节码指令集、Class文件解析、ASM）</div></a><a href="/zkq/java/jvm/memory-allocate.html" class="nav-link next" arialabel="内存分配"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">内存分配<!----></div></a></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2023 Zenk562</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.625aa393.js" defer></script>
  </body>
</html>
