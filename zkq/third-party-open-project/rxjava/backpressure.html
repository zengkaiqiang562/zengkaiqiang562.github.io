<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zengkaiqiang562.github.io/zkq/third-party-open-project/rxjava/backpressure.html"><meta property="og:site_name" content="Android Guide"><meta property="og:title" content="背压（Backpressure）"><meta property="og:type" content="article"><meta property="og:image" content="https://zengkaiqiang562.github.io/"><meta property="og:updated_time" content="2022-07-07T15:59:00.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="背压（Backpressure）"><meta property="article:tag" content="android"><meta property="article:tag" content="第三方框架"><meta property="article:modified_time" content="2022-07-07T15:59:00.000Z"><script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2922463_99aa80ii7cf.css"><title>背压（Backpressure） | Android Guide</title><meta name="description" content="Android 学习 && 面试指南">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.c9a516cc.css">
    <link rel="modulepreload" href="/assets/app.2a01fc36.js"><link rel="modulepreload" href="/assets/backpressure.html.008794ba.js"><link rel="modulepreload" href="/assets/backpressure.html.f46590c5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.png" alt="Android Guide"><!----><span class="site-name hide-in-pad">Android Guide</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" arialabel="面试指南"><i class="icon iconfont icon-java"></i>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/zhuanlan/" class="nav-link" arialabel="优质专栏"><i class="icon iconfont icon-recommend"></i>优质专栏<!----></a></div><div class="nav-item hide-in-mobile"><a href="/open-source-project/" class="nav-link" arialabel="项目精选"><i class="icon iconfont icon-github"></i>项目精选<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://snailclimb.gitee.io/javaguide/#/" rel="noopener noreferrer" target="_blank" arialabel="旧版链接" class="nav-link"><i class="icon iconfont icon-java"></i>旧版链接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://javaguide.cn/feed.json" rel="noopener noreferrer" target="_blank" arialabel="RSS订阅" class="nav-link"><i class="icon iconfont icon-rss"></i>RSS订阅<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="/about-the-author/" class="nav-link" arialabel="关于作者"><i class="icon iconfont icon-zuozhe"></i>关于作者<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zengkaiqiang562/JavaGuide" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" arialabelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" arialabelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" arialabelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/zkq/third-party-open-project/okhttp.html" class="nav-link sidebar-link sidebar-page" arialabel="OkHttp框架"><!---->OkHttp框架<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">RxJava框架</span><span class="arrow down"></span></button><!--[--><!--[--><ul class="sidebar-links"><li><!--[--><a href="/zkq/third-party-open-project/rxjava/overview.html" class="nav-link sidebar-link sidebar-page" arialabel="RxJava概述"><!---->RxJava概述<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/third-party-open-project/rxjava/operator.html" class="nav-link sidebar-link sidebar-page" arialabel="操作符（Operator）"><!---->操作符（Operator）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/third-party-open-project/rxjava/scheduler.html" class="nav-link sidebar-link sidebar-page" arialabel="调度器（Scheduler）"><!---->调度器（Scheduler）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="背压（Backpressure）"><!---->背压（Backpressure）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_6-出现背压的原因-上下游的数据流速不匹配" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6. 出现背压的原因：上下游的数据流速不匹配"><!---->6. 出现背压的原因：上下游的数据流速不匹配<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-背压策略-flowable" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7. 背压策略 &amp; Flowable"><!---->7. 背压策略 &amp; Flowable<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-被观察者-flowable-的特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 被观察者 Flowable 的特点"><!---->7.1 被观察者 Flowable 的特点<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-1-对应的观察者为-subscriber" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1.1 对应的观察者为 Subscriber"><!---->7.1.1 对应的观察者为 Subscriber<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-2-所有的操作符强制支持背压" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1.2 所有的操作符强制支持背压"><!---->7.1.2 所有的操作符强制支持背压<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-3-缓存区存放策略-先进先出" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1.3 缓存区存放策略（先进先出）"><!---->7.1.3 缓存区存放策略（先进先出）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-4-缓存区的默认大小-buffersize-128" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1.4 缓存区的默认大小 bufferSize = 128"><!---->7.1.4 缓存区的默认大小 bufferSize = 128<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-5-同步操作中不存在缓存区" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1.5 同步操作中不存在缓存区"><!---->7.1.5 同步操作中不存在缓存区<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-背压策略-——-控制观察者响应数据项的速度-响应式拉取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2 背压策略 —— 控制观察者响应数据项的速度（响应式拉取）"><!---->7.2 背压策略 —— 控制观察者响应数据项的速度（响应式拉取）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-1-原理-观察者按需主动地接收-拉取-指定个数的数据项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.1 原理：观察者按需主动地接收（拉取）指定个数的数据项"><!---->7.2.1 原理：观察者按需主动地接收（拉取）指定个数的数据项<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-2-实现方式-subscription-request-n" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.2 实现方式：Subscription.request(n)"><!---->7.2.2 实现方式：Subscription.request(n)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-3-示例-1-异步操作中的响应式拉取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.3 示例 1：异步操作中的响应式拉取"><!---->7.2.3 示例 1：异步操作中的响应式拉取<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-4-示例-2-同步操作中的响应式拉取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.4 示例 2：同步操作中的响应式拉取"><!---->7.2.4 示例 2：同步操作中的响应式拉取<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-异步操作中响应式拉取时的注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.5 异步操作中响应式拉取时的注意事项"><!---->7.2.5 异步操作中响应式拉取时的注意事项<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-1-即使观察者不拉取数据项-被观察者发射的数据项总会存入缓存区" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.5.1 即使观察者不拉取数据项，被观察者发射的数据项总会存入缓存区"><!---->7.2.5.1 即使观察者不拉取数据项，被观察者发射的数据项总会存入缓存区<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-2-若一直不拉取数据项-则发射的数据项最终会使缓存区溢出报错" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.5.2 若一直不拉取数据项，则发射的数据项最终会使缓存区溢出报错"><!---->7.2.5.2 若一直不拉取数据项，则发射的数据项最终会使缓存区溢出报错<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-同步操作中响应式拉取时的注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.6 同步操作中响应式拉取时的注意事项"><!---->7.2.6 同步操作中响应式拉取时的注意事项<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-1-发射的数据项个数-拉取的数据项个数会出现背压问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.6.1 发射的数据项个数 &gt; 拉取的数据项个数会出现背压问题"><!---->7.2.6.1 发射的数据项个数 &gt; 拉取的数据项个数会出现背压问题<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-2-发射了数据项但不拉取也会出现背压问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2.6.2 发射了数据项但不拉取也会出现背压问题"><!---->7.2.6.2 发射了数据项但不拉取也会出现背压问题<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-背压策略-——-控制被观察者发射数据项的速度-反馈控制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3 背压策略 —— 控制被观察者发射数据项的速度（反馈控制）"><!---->7.3 背压策略 —— 控制被观察者发射数据项的速度（反馈控制）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-1-原理-被观察者发射数据项的个数受到观察者拉取数据项的个数的限制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.1 原理：被观察者发射数据项的个数受到观察者拉取数据项的个数的限制"><!---->7.3.1 原理：被观察者发射数据项的个数受到观察者拉取数据项的个数的限制<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-2-实现方式-flowableemitter-requested" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.2 实现方式：FlowableEmitter.requested()"><!---->7.3.2 实现方式：FlowableEmitter.requested()<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-3-示例-1-异步操作中的响应式拉取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.3 示例 1：异步操作中的响应式拉取"><!---->7.3.3 示例 1：异步操作中的响应式拉取<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-4-示例-2-同步操作中的响应式拉取" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.4 示例 2：同步操作中的响应式拉取"><!---->7.3.4 示例 2：同步操作中的响应式拉取<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-同步操作中反馈控制的注意事项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.5 同步操作中反馈控制的注意事项"><!---->7.3.5 同步操作中反馈控制的注意事项<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-1-观察者中多次调用的-subscription-request-n-具有叠加性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.5.1 观察者中多次调用的 Subscription.request(n) 具有叠加性"><!---->7.3.5.1 观察者中多次调用的 Subscription.request(n) 具有叠加性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-2-被观察者中-flowableemitter-requested-的返回值会实时更新" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.5.2 被观察者中 FlowableEmitter.requested() 的返回值会实时更新"><!---->7.3.5.2 被观察者中 FlowableEmitter.requested() 的返回值会实时更新<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-3-requested-返回-0-时发射数据项一定会触发-onerror-事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3.5.3 requested() 返回 0 时发射数据项一定会触发 onError 事件"><!---->7.3.5.3 requested() 返回 0 时发射数据项一定会触发 onError 事件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-背压策略-——-采用不同的背压策略模式-backpressurestrategy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4 背压策略 —— 采用不同的背压策略模式（BackpressureStrategy）"><!---->7.4 背压策略 —— 采用不同的背压策略模式（BackpressureStrategy）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-五种背压策略模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1 五种背压策略模式"><!---->7.4.1 五种背压策略模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-2-backpressurestrategy-error" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1.2 BackpressureStrategy.ERROR"><!---->7.4.1.2 BackpressureStrategy.ERROR<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-1-backpressurestrategy-missing" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1.1 BackpressureStrategy.MISSING"><!---->7.4.1.1 BackpressureStrategy.MISSING<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-3-backpressurestrategy-buffer" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1.3 BackpressureStrategy.BUFFER"><!---->7.4.1.3 BackpressureStrategy.BUFFER<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-4-backpressurestrategy-drop" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1.4 BackpressureStrategy.DROP"><!---->7.4.1.4 BackpressureStrategy.DROP<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-5-backpressurestrategy-latest" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.1.5 BackpressureStrategy.LATEST"><!---->7.4.1.5 BackpressureStrategy.LATEST<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-指定背压策略模式的方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2 指定背压策略模式的方式"><!---->7.4.2 指定背压策略模式的方式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-1-在-create-创建操作符中指定背压策略模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.1 在 create 创建操作符中指定背压策略模式"><!---->7.4.2.1 在 create 创建操作符中指定背压策略模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-在其他创建操作符中指定背压策略模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2 在其他创建操作符中指定背压策略模式"><!---->7.4.2.2 在其他创建操作符中指定背压策略模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-1-默认采用-backpressurestrategy-error" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2.1 默认采用 BackpressureStrategy.ERROR"><!---->7.4.2.2.1 默认采用 BackpressureStrategy.ERROR<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-2-onbackpressurebuffer" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2.2 onBackpressureBuffer()"><!---->7.4.2.2.2 onBackpressureBuffer()<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-3-onbackpressuredrop" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2.3 onBackpressureDrop()"><!---->7.4.2.2.3 onBackpressureDrop()<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-4-onbackpressurelatest" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2.4 onBackpressureLatest()"><!---->7.4.2.2.4 onBackpressureLatest()<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-5-示例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4.2.2.5 示例"><!---->7.4.2.2.5 示例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_8-背压策略总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8. 背压策略总结"><!---->8. 背压策略总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><a href="/zkq/third-party-open-project/retrofit.html" class="nav-link sidebar-link sidebar-page" arialabel="Retrofit框架"><!---->Retrofit框架<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/third-party-open-project/glide.html" class="nav-link sidebar-link sidebar-page" arialabel="Glide框架"><!---->Glide框架<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zkq/third-party-open-project/eventbus.html" class="nav-link sidebar-link sidebar-page" arialabel="EventBus框架 （DOING）"><!---->EventBus框架 （DOING）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->背压（Backpressure）</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://zengkaiqiang562.github.io/" target="_blank" rel="noopener noreferrer">Zenk562</a></span><span property="author" content="Zenk562"></span></span><span class="category-info" arialabel="分类🌈" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category clickable" role="navigation">android</li><li class="category clickable" role="navigation">第三方框架</li><meta property="articleSection" content="android,第三方框架"></ul></span><span arialabel="标签🏷" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag clickable" role="navigation">android</li><li class="tag clickable" role="navigation">第三方框架</li></ul><meta property="keywords" content="android,第三方框架"></span><span class="date-info" arialabel="写作日期📅" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年7月7日</span><meta property="datePublished" content="2022-07-07T15:59:00.000Z"></span><!----><span class="words-info" arialabel="字数🔠" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" arialabelledby="word"><title id="word" lang="en">word icon</title><g fill="currentColor"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></g></svg><span>约 10542 字</span><meta property="wordCount" content="10542"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_6-出现背压的原因-上下游的数据流速不匹配" class="router-link-active router-link-exact-active toc-link level2">6. 出现背压的原因：上下游的数据流速不匹配</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-背压策略-flowable" class="router-link-active router-link-exact-active toc-link level2">7. 背压策略 &amp; Flowable</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-被观察者-flowable-的特点" class="router-link-active router-link-exact-active toc-link level3">7.1 被观察者 Flowable 的特点</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-1-对应的观察者为-subscriber" class="router-link-active router-link-exact-active toc-link level4">7.1.1 对应的观察者为 Subscriber</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-2-所有的操作符强制支持背压" class="router-link-active router-link-exact-active toc-link level4">7.1.2 所有的操作符强制支持背压</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-3-缓存区存放策略-先进先出" class="router-link-active router-link-exact-active toc-link level4">7.1.3 缓存区存放策略（先进先出）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-4-缓存区的默认大小-buffersize-128" class="router-link-active router-link-exact-active toc-link level4">7.1.4 缓存区的默认大小 bufferSize = 128</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-1-5-同步操作中不存在缓存区" class="router-link-active router-link-exact-active toc-link level4">7.1.5 同步操作中不存在缓存区</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-背压策略-——-控制观察者响应数据项的速度-响应式拉取" class="router-link-active router-link-exact-active toc-link level3">7.2 背压策略 —— 控制观察者响应数据项的速度（响应式拉取）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-1-原理-观察者按需主动地接收-拉取-指定个数的数据项" class="router-link-active router-link-exact-active toc-link level4">7.2.1 原理：观察者按需主动地接收（拉取）指定个数的数据项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-2-实现方式-subscription-request-n" class="router-link-active router-link-exact-active toc-link level4">7.2.2 实现方式：Subscription.request(n)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-3-示例-1-异步操作中的响应式拉取" class="router-link-active router-link-exact-active toc-link level4">7.2.3 示例 1：异步操作中的响应式拉取</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-4-示例-2-同步操作中的响应式拉取" class="router-link-active router-link-exact-active toc-link level4">7.2.4 示例 2：同步操作中的响应式拉取</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-异步操作中响应式拉取时的注意事项" class="router-link-active router-link-exact-active toc-link level4">7.2.5 异步操作中响应式拉取时的注意事项</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-1-即使观察者不拉取数据项-被观察者发射的数据项总会存入缓存区" class="router-link-active router-link-exact-active toc-link level5">7.2.5.1 即使观察者不拉取数据项，被观察者发射的数据项总会存入缓存区</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-5-2-若一直不拉取数据项-则发射的数据项最终会使缓存区溢出报错" class="router-link-active router-link-exact-active toc-link level5">7.2.5.2 若一直不拉取数据项，则发射的数据项最终会使缓存区溢出报错</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-同步操作中响应式拉取时的注意事项" class="router-link-active router-link-exact-active toc-link level4">7.2.6 同步操作中响应式拉取时的注意事项</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-1-发射的数据项个数-拉取的数据项个数会出现背压问题" class="router-link-active router-link-exact-active toc-link level5">7.2.6.1 发射的数据项个数 &gt; 拉取的数据项个数会出现背压问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-2-6-2-发射了数据项但不拉取也会出现背压问题" class="router-link-active router-link-exact-active toc-link level5">7.2.6.2 发射了数据项但不拉取也会出现背压问题</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-背压策略-——-控制被观察者发射数据项的速度-反馈控制" class="router-link-active router-link-exact-active toc-link level3">7.3 背压策略 —— 控制被观察者发射数据项的速度（反馈控制）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-1-原理-被观察者发射数据项的个数受到观察者拉取数据项的个数的限制" class="router-link-active router-link-exact-active toc-link level4">7.3.1 原理：被观察者发射数据项的个数受到观察者拉取数据项的个数的限制</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-2-实现方式-flowableemitter-requested" class="router-link-active router-link-exact-active toc-link level4">7.3.2 实现方式：FlowableEmitter.requested()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-3-示例-1-异步操作中的响应式拉取" class="router-link-active router-link-exact-active toc-link level4">7.3.3 示例 1：异步操作中的响应式拉取</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-4-示例-2-同步操作中的响应式拉取" class="router-link-active router-link-exact-active toc-link level4">7.3.4 示例 2：同步操作中的响应式拉取</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-同步操作中反馈控制的注意事项" class="router-link-active router-link-exact-active toc-link level4">7.3.5 同步操作中反馈控制的注意事项</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-1-观察者中多次调用的-subscription-request-n-具有叠加性" class="router-link-active router-link-exact-active toc-link level5">7.3.5.1 观察者中多次调用的 Subscription.request(n) 具有叠加性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-2-被观察者中-flowableemitter-requested-的返回值会实时更新" class="router-link-active router-link-exact-active toc-link level5">7.3.5.2 被观察者中 FlowableEmitter.requested() 的返回值会实时更新</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-3-5-3-requested-返回-0-时发射数据项一定会触发-onerror-事件" class="router-link-active router-link-exact-active toc-link level5">7.3.5.3 requested() 返回 0 时发射数据项一定会触发 onError 事件</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-背压策略-——-采用不同的背压策略模式-backpressurestrategy" class="router-link-active router-link-exact-active toc-link level3">7.4 背压策略 —— 采用不同的背压策略模式（BackpressureStrategy）</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-五种背压策略模式" class="router-link-active router-link-exact-active toc-link level4">7.4.1 五种背压策略模式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-2-backpressurestrategy-error" class="router-link-active router-link-exact-active toc-link level5">7.4.1.2 BackpressureStrategy.ERROR</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-1-backpressurestrategy-missing" class="router-link-active router-link-exact-active toc-link level5">7.4.1.1 BackpressureStrategy.MISSING</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-3-backpressurestrategy-buffer" class="router-link-active router-link-exact-active toc-link level5">7.4.1.3 BackpressureStrategy.BUFFER</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-4-backpressurestrategy-drop" class="router-link-active router-link-exact-active toc-link level5">7.4.1.4 BackpressureStrategy.DROP</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-1-5-backpressurestrategy-latest" class="router-link-active router-link-exact-active toc-link level5">7.4.1.5 BackpressureStrategy.LATEST</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-指定背压策略模式的方式" class="router-link-active router-link-exact-active toc-link level4">7.4.2 指定背压策略模式的方式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-1-在-create-创建操作符中指定背压策略模式" class="router-link-active router-link-exact-active toc-link level5">7.4.2.1 在 create 创建操作符中指定背压策略模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-在其他创建操作符中指定背压策略模式" class="router-link-active router-link-exact-active toc-link level5">7.4.2.2 在其他创建操作符中指定背压策略模式</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-1-默认采用-backpressurestrategy-error" class="router-link-active router-link-exact-active toc-link level6">7.4.2.2.1 默认采用 BackpressureStrategy.ERROR</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-2-onbackpressurebuffer" class="router-link-active router-link-exact-active toc-link level6">7.4.2.2.2 onBackpressureBuffer()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-3-onbackpressuredrop" class="router-link-active router-link-exact-active toc-link level6">7.4.2.2.3 onBackpressureDrop()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-4-onbackpressurelatest" class="router-link-active router-link-exact-active toc-link level6">7.4.2.2.4 onBackpressureLatest()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_7-4-2-2-5-示例" class="router-link-active router-link-exact-active toc-link level6">7.4.2.2.5 示例</a></li><!----><!--]--></ul><!--]--></ul><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zkq/third-party-open-project/rxjava/backpressure.html#_8-背压策略总结" class="router-link-active router-link-exact-active toc-link level2">8. 背压策略总结</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><blockquote><p>注意：</p><ol><li><p>发射数据项就是指发射 <code>onNext</code> 事件。</p></li><li><p>观察者接收数据项、观察者响应数据项、观察者拉取数据项是一个意思。</p></li></ol></blockquote><h2 id="_6-出现背压的原因-上下游的数据流速不匹配" tabindex="-1"><a class="header-anchor" href="#_6-出现背压的原因-上下游的数据流速不匹配" aria-hidden="true">#</a> 6. 出现背压的原因：上下游的数据流速不匹配</h2><blockquote><p>参考 <a href="https://carsonho.blog.csdn.net/article/details/79081407" target="_blank" rel="noopener noreferrer">Carson带你学Android：图文详解RxJava背压策略<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>当上下游在不同线程中时，如果上游发射数据项的速度快于下游响应数据项的速度，那么对于来不及响应的数据项就会造成积压，这些积压的数据项既不会丢失，也不会被垃圾回收机制回收，而是存放在一个异步缓存池中，如果缓存池中的数据项一直得不到处理，越积越多，最后就会造成内存溢出，这便是响应式编程中的背压（<code>backpressure</code>）问题。</p><p>简单地说，背压问题就是：被观察者发射数据项的速度太快，使得观察者无法及时响应所有发射过来数据项，最终导致缓存区的内存溢出。</p><p>更简单地说，背压问题就是：上游的数据流速与下游的数据流速不匹配，导致缓存区的内存溢出。（上游数据流速 &gt; 下游数据流程）</p><p>注意：</p><ol><li><p>“上游” 指的是发射数据项的被观察者，“下游” 指的是响应数据项的观察者。</p></li><li><p>背压问题主要出现在异步操作中（即发射数据项与响应数据项在不同的线程中），但同步操作中也有可能出现背压问题。</p></li></ol><h2 id="_7-背压策略-flowable" tabindex="-1"><a class="header-anchor" href="#_7-背压策略-flowable" aria-hidden="true">#</a> 7. 背压策略 &amp; <code>Flowable</code></h2><p>背压策略就是用来解决：被观察者发射数据项的速度太快，使得观察者无法及时响应所有发射过来的数据项而产生的问题的。</p><p>背压策略从以下两个方面给出了不同的解决方案：</p><ol><li><p>避免出现发射数据项的速度与响应数据项的速度不匹配的情况的解决方案：</p><ol><li><p>控制观察者响应数据项的速度</p></li><li><p>控制被观察者发射数据项的速度</p></li></ol></li><li><p>当出现发射数据项的速度与响应数据项的速度不匹配的情况时的解决方案：</p><ol><li>通过采用不同的背压策略模式（<code>BackpressureStrategy</code>）对超出缓存区的数据项进行丢弃、保留、报错等处理</li></ol></li></ol><p><code>Flowable</code> 是 <code>RxJava 2.0</code> 中新增的被观察者。<code>Flowable</code> 是背压策略的具体实现，即采用 <code>Flowable</code> 可解决背压相关的问题。</p><h3 id="_7-1-被观察者-flowable-的特点" tabindex="-1"><a class="header-anchor" href="#_7-1-被观察者-flowable-的特点" aria-hidden="true">#</a> 7.1 被观察者 <code>Flowable</code> 的特点</h3><h4 id="_7-1-1-对应的观察者为-subscriber" tabindex="-1"><a class="header-anchor" href="#_7-1-1-对应的观察者为-subscriber" aria-hidden="true">#</a> 7.1.1 对应的观察者为 <code>Subscriber</code></h4><h4 id="_7-1-2-所有的操作符强制支持背压" tabindex="-1"><a class="header-anchor" href="#_7-1-2-所有的操作符强制支持背压" aria-hidden="true">#</a> 7.1.2 所有的操作符强制支持背压</h4><h4 id="_7-1-3-缓存区存放策略-先进先出" tabindex="-1"><a class="header-anchor" href="#_7-1-3-缓存区存放策略-先进先出" aria-hidden="true">#</a> 7.1.3 缓存区存放策略（先进先出）</h4><p>异步操作中，被观察者 <code>Flowable</code> 发射的数据项总是先保存在缓存区中，观察者 <code>Subscriber</code> 接收的数据项总是从缓存区中取出。（且先发射的先取出）</p><h4 id="_7-1-4-缓存区的默认大小-buffersize-128" tabindex="-1"><a class="header-anchor" href="#_7-1-4-缓存区的默认大小-buffersize-128" aria-hidden="true">#</a> 7.1.4 缓存区的默认大小 <code>bufferSize = 128</code></h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Flowable.java */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Publisher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** The default buffer size. */</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> BUFFER_SIZE<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        BUFFER_SIZE <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token string">&quot;rx2.buffer-size&quot;</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">bufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> BUFFER_SIZE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_7-1-5-同步操作中不存在缓存区" tabindex="-1"><a class="header-anchor" href="#_7-1-5-同步操作中不存在缓存区" aria-hidden="true">#</a> 7.1.5 同步操作中不存在缓存区</h4><h3 id="_7-2-背压策略-——-控制观察者响应数据项的速度-响应式拉取" tabindex="-1"><a class="header-anchor" href="#_7-2-背压策略-——-控制观察者响应数据项的速度-响应式拉取" aria-hidden="true">#</a> 7.2 背压策略 —— 控制观察者响应数据项的速度（响应式拉取）</h3><h4 id="_7-2-1-原理-观察者按需主动地接收-拉取-指定个数的数据项" tabindex="-1"><a class="header-anchor" href="#_7-2-1-原理-观察者按需主动地接收-拉取-指定个数的数据项" aria-hidden="true">#</a> 7.2.1 原理：观察者按需主动地接收（拉取）指定个数的数据项</h4><div class="language-text ext-text"><pre class="language-text"><code>异步操作中，观察者按需接收数据项，且：
1. 被观察者发射的数据项都先保存到缓存区中；
2. 观察者按需从缓存区中接收指定个数的数据项

同步操作中，观察者按需接收数据项，且：
1. 被观察者每发射一个数据项，必须等到观察者响应这个数据项之后，才能继续发射下一个数据项。
</code></pre></div><blockquote><p>响应式拉取指的就是：观察者按需接收指定个数的数据项。</p></blockquote><h4 id="_7-2-2-实现方式-subscription-request-n" tabindex="-1"><a class="header-anchor" href="#_7-2-2-实现方式-subscription-request-n" aria-hidden="true">#</a> 7.2.2 实现方式：<code>Subscription.request(n)</code></h4><div class="language-text ext-text"><pre class="language-text"><code>不管是同步操作，还是异步操作，我们只需要指定观察者需要接收的数据项个数即可，其它的 Flowable 内部已实现。
在观察者 Subscriber 的回调方法 onSubscribe(Subscription) 中，通过调用参数 Subscription 的 request(n) 方法，
即可指定观察者所需接收的数据项个数 n。
</code></pre></div><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Subscription.java */</span>
<span class="token comment">/*
    该方法的作用为：指定观察者能够接收多少个数据项。
    如：调用 subscription.request(3) 表示观察者能够接收从缓存区中取出的 3 个数据项。
    注意：
        1. 观察者能够接收多少个数据项，就从缓存区取出多少个数据项，
           未取出的数据项仍然保留在缓存区中等待下次观察者再调用 request(n) 方法接着取。
        2. 官方默认推荐使用 Long.MAX_VALUE，即 subscription.request(Long.MAX_VALUE);
           也就是说，推荐尽可能地将缓存区中的数据项全部取出，以避免缓存区溢出。
*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-2-3-示例-1-异步操作中的响应式拉取" tabindex="-1"><a class="header-anchor" href="#_7-2-3-示例-1-异步操作中的响应式拉取" aria-hidden="true">#</a> 7.2.3 示例 1：异步操作中的响应式拉取</h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">// 1. 创建被观察者 Flowable</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一共发送 4 个事件</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">/*
                    Subscription 参数具备 Disposable 参数的作用，即：
                        1. Disposable 中调用 dispose() 切断连接
                        2. Subscription 中调用 cancel() 切断连接

                    此外，Subscription 增加了 request(long n) 方法。
                */</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 观察者能够接收从缓存区中取出的 3 个数据项。</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/01.02cd7b9d.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出，异步操作中：</p><ol><li><p>发射数据项与响应数据项的过程在不同的线程中执行（发射数据项的线程 <code>id</code> 为 <code>2121</code>，响应数据项的线程 <code>id</code> 为 <code>2105</code>）；</p></li><li><p>在发射下一个数据项之前，不需要考虑观察者有没有接收到上一个数据项。（因为发射的数据项总是先保存在缓存区中）</p></li></ol></blockquote><h4 id="_7-2-4-示例-2-同步操作中的响应式拉取" tabindex="-1"><a class="header-anchor" href="#_7-2-4-示例-2-同步操作中的响应式拉取" aria-hidden="true">#</a> 7.2.4 示例 2：同步操作中的响应式拉取</h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 步骤 1：创建被观察者 Flowable
 */</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> upstream <span class="token operator">=</span> <span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 发送 3 个事件</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 步骤 2：创建观察者 Subscriber
 */</span>
<span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> downstream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 观察者目前只能接收 3 个数据项。</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件 &quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 步骤3：建立订阅关系
 */</span>
upstream<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/02.017d7ec8.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出，同步操作中：</p><ol><li><p>发射数据项与响应数据项的过程都在 <code>id</code> 为 <code>5752</code> 的线程中执行。</p></li><li><p>被观察者每发射一个数据项，必须等到观察者响应这个数据项之后，才能继续发射下一个数据项。（因为同步操作中不存在缓存区，发射的数据项无法保存在缓存区中）</p></li></ol></blockquote><h4 id="_7-2-5-异步操作中响应式拉取时的注意事项" tabindex="-1"><a class="header-anchor" href="#_7-2-5-异步操作中响应式拉取时的注意事项" aria-hidden="true">#</a> 7.2.5 异步操作中响应式拉取时的注意事项</h4><h5 id="_7-2-5-1-即使观察者不拉取数据项-被观察者发射的数据项总会存入缓存区" tabindex="-1"><a class="header-anchor" href="#_7-2-5-1-即使观察者不拉取数据项-被观察者发射的数据项总会存入缓存区" aria-hidden="true">#</a> 7.2.5.1 即使观察者不拉取数据项，被观察者发射的数据项总会存入缓存区</h5><p>在异步操作中，如果观察者没有通过回调方法 <code>onSubscribe(Subscription)</code> 中参数 <code>Subscription</code> 的 <code>request(n)</code> 方法设置可接收的数据项个数，那么表示观察者不会接收数据项。</p><p>此时，被观察者仍然能够继续发射数据项，并保存进缓存区中。</p><p>直到观察者什么时候需要接收数据项了，再调用参数 <code>Subscription</code> 的 <code>request(n)</code> 方法从缓存区中拉取数据项。</p><blockquote><p>先保存进缓存区（即先发射）的数据项先被拉取，数据项从缓存区拉取出来后就从缓存区中移除了。</p></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">&quot;Rxjava&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">Subscription</span> mSubscription<span class="token punctuation">;</span>
    
<span class="token doc-comment comment">/**
 * 点击按钮时，观察者才开始调用 Subscription.request(n) 方法去拉取缓存区中的数据项
 */</span>
btn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mSubscription<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每点击一次按钮，观察者从缓存区中拉取 2 个数据项</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 异步操作
 */</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件 4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将参数 Subscription 赋值成员变量 mSubscription，以便在点击按钮时再拉取数据项</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/03.3a648a77.gif" alt="" loading="lazy"></p><h5 id="_7-2-5-2-若一直不拉取数据项-则发射的数据项最终会使缓存区溢出报错" tabindex="-1"><a class="header-anchor" href="#_7-2-5-2-若一直不拉取数据项-则发射的数据项最终会使缓存区溢出报错" aria-hidden="true">#</a> 7.2.5.2 若一直不拉取数据项，则发射的数据项最终会使缓存区溢出报错</h5><p>如果观察者一直不调用 <code>Subscription.request(n)</code> 方法从缓存区拉取数据项，那么由于缓存区大小默认只能存入 <code>128</code> 个数据项，于是当被观察者发射第 <code>129</code> 个数据项时，导致缓存区溢出报错。</p><blockquote><p>缓存区溢出时是否报错是由 <a href="#_7-4-%E8%83%8C%E5%8E%8B%E7%AD%96%E7%95%A5-%E2%80%94%E2%80%94-%E9%87%87%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E8%83%8C%E5%8E%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-backpressurestrategy">背压策略模式（BackpressureStrategy）</a> 决定的，比如：</p><ol><li><p>当设置了 <code>BackpressureStrategy.ERROR</code> 时，缓存区溢出时会报错；</p></li><li><p>当设置了 <code>BackpressureStrategy.BUFFER</code> 时，缓存区溢出时会扩容，保证能存放下所有发射的数据项。（但大量数据项的积压最终会导致 <code>OOM</code>）</p></li></ol></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            被观察者一共发射 129 个数据项。（超出了缓存区的默认大小 128）
        */</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">129</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 ERROR，即：当缓存区溢出时报错</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">/* 观察者一直不调用 s.request(n) 方法从缓存区拉取数据项 */</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/04.8be37a81.png" alt="" loading="lazy"></p><h4 id="_7-2-6-同步操作中响应式拉取时的注意事项" tabindex="-1"><a class="header-anchor" href="#_7-2-6-同步操作中响应式拉取时的注意事项" aria-hidden="true">#</a> 7.2.6 同步操作中响应式拉取时的注意事项</h4><h5 id="_7-2-6-1-发射的数据项个数-拉取的数据项个数会出现背压问题" tabindex="-1"><a class="header-anchor" href="#_7-2-6-1-发射的数据项个数-拉取的数据项个数会出现背压问题" aria-hidden="true">#</a> 7.2.6.1 发射的数据项个数 &gt; 拉取的数据项个数会出现背压问题</h5><p>由于同步操作中被观察者每发射一个数据项，必须等到观察者响应这个数据项之后，才能继续发射下一个数据项，所以同步操作中，不会出现发射数据项的速度 &gt; 接收数据项的速度的情况。</p><p>但是同步操作中，却可能会出现发射的数据项个数 &gt; 拉取的数据项个数的情况。同数据项流速不匹配一样，数据项个数不匹配同样会出现背压问题，即通过发射 <code>onError</code> 事件触发 <code>MissingBackpressureException</code> 异常。</p><h5 id="_7-2-6-2-发射了数据项但不拉取也会出现背压问题" tabindex="-1"><a class="header-anchor" href="#_7-2-6-2-发射了数据项但不拉取也会出现背压问题" aria-hidden="true">#</a> 7.2.6.2 发射了数据项但不拉取也会出现背压问题</h5><p>由于同步操作中不存在缓存区，所以被观察者发射的数据项需要直接传递给观察者，但如果观察者没有设置 <code>Subscription.request(n)</code>，那么被观察者就会认为观察者没有接收并处理事件的能力。</p><p>于是，被观察者就会在发射一个数据项未被接收之后，通过发射 onError 事件触发 <code>MissingBackpressureException</code> 异常，来提醒观察者接收事件。</p><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 创建被观察者 Flowable
 */</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> upstream <span class="token operator">=</span> <span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 创建观察者 Subscriber
 */</span>
<span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> downstream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* 不调用 s.request(n)，即：观察者不接收数据项 */</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onNext: &quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 建立订阅关系
 */</span>
upstream<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/05.d7ee6aa8.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：在发射了 onError 事件触发 <code>MissingBackpressureException</code> 异常后，还会接着将剩余的数据项发射完。</p></blockquote><h3 id="_7-3-背压策略-——-控制被观察者发射数据项的速度-反馈控制" tabindex="-1"><a class="header-anchor" href="#_7-3-背压策略-——-控制被观察者发射数据项的速度-反馈控制" aria-hidden="true">#</a> 7.3 背压策略 —— 控制被观察者发射数据项的速度（反馈控制）</h3><p>响应式拉取的背压策略是用来控制观察者接收数据项的速度的。</p><p>但是，单独地控制接收速度，而不限制发射速度，那么当发射速度快于接收速度时，就有可能出现背压问题。</p><p>同样的，单独地控制发射速度，而不限制接收速度，那么当发射速度慢于接收速度时，就会导致效率问题。</p><p>因此，必须同时对发射速度和接收速度进行控制，才能避免问题的产生。于是，提出了反馈控制的背压策略。</p><h4 id="_7-3-1-原理-被观察者发射数据项的个数受到观察者拉取数据项的个数的限制" tabindex="-1"><a class="header-anchor" href="#_7-3-1-原理-被观察者发射数据项的个数受到观察者拉取数据项的个数的限制" aria-hidden="true">#</a> 7.3.1 原理：被观察者发射数据项的个数受到观察者拉取数据项的个数的限制</h4><p>反馈控制的原理就是根据观察者接收数据项的速度，来控制被观察者发射数据项的速度。使得在不引起背压问题的条件下，合理地调整被观察者发射数据项的过程。</p><p>考虑异步操作和同步操作的情况下，反馈控制的具体实现原理为：</p><div class="language-text ext-text"><pre class="language-text"><code>异步操作中，由于发射过程和接收过程在不同的线程中执行，所以被观察者无法直接知道观察者当前可接收数据项的个数。
也就是说，被观察者无法知道观察者接收数据项的速度，因此，也就无法直接根据接收速度来控制发射速度了。

但是，异步操作中是存在缓存区的，而观察者接收到的数据项都是从缓存区中拉取的，因此，接收速度会影响到缓存区。
同时，被观察者也是可以访问到缓存区的，于是就可以根据缓存区的状态来控制发射速度，具体为：

    被观察者可发射的数据项个数 = bufferSize - bufferItems = 缓存区的空闲容量，
    其中：1. bufferSize 为缓存区大小（默认 128），2. bufferItems 为缓存区中剩余的数据项个数（初始值为 0）。
    注意：只有当剩余数据项个数 &lt;= 32（即空闲容量 &gt;= 96） 时，才允许被观察者发射数据项，直到填满缓存区为止。

综上，在异步操作中，基于缓存区状态的反馈，对被观察者发射数据项的速度进行了控制。
</code></pre></div><div class="language-text ext-text"><pre class="language-text"><code>同步操作中，由于发射过程和接收过程在同一线程中执行，所以被观察者可以直接知道观察者当前可接收数据项的个数。
于是，直接根据接收速度来控制发射速度即可，具体为：

    被观察者可发射的数据项个数 = 观察者可接收的数据项个数

综上，在异步操作中，基于观察者接收数据项的速度的反馈，直接对被观察者发射数据项的速度进行控制。
</code></pre></div><h4 id="_7-3-2-实现方式-flowableemitter-requested" tabindex="-1"><a class="header-anchor" href="#_7-3-2-实现方式-flowableemitter-requested" aria-hidden="true">#</a> 7.3.2 实现方式：<code>FlowableEmitter.requested()</code></h4><p>不管是异步操作，还是同步操作，<strong>只要在 <code>FlowableEmitter.requested()</code> 的返回值 &gt; <code>0</code> 的条件下发射数据项就不会出现背压问题</strong>。</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* FlowableEmitter.java */</span>
<span class="token comment">/*
    异步操作中，返回值表示缓存区目前可存入的数据项个数。
        注意：
            1. 初始状态下，返回值 = 128。当缓存区首次存满后，返回值 = 0。
            2. 在返回值 = 0 的情况下，得再次等到缓存区的剩余数据项个数 &lt;= 32 时，返回值才会 &gt; 0。
               也就是说：当返回值 = 0 时，即使缓存区还有空闲容量，暂时也不应该继续发射数据项。
            3. 在返回值 &gt; 0 的情况下，得再次等到缓存区存满后，返回值 = 0。

    同步操作中，返回值表示观察者可接收但还未接收的数据项个数，
        即：返回值 = 可接收的数据项个数 - 已接收的数据项个数
        注意：
            1. 当返回值 = 0 时，就不能继续发射数据项了，否则会发射 onError 事件触发 MissingBackpressureException 异常。
*/</span>
<span class="token keyword">long</span> <span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-3-3-示例-1-异步操作中的响应式拉取" tabindex="-1"><a class="header-anchor" href="#_7-3-3-示例-1-异步操作中的响应式拉取" aria-hidden="true">#</a> 7.3.3 示例 1：异步操作中的响应式拉取</h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">// 点击按钮时，观察者才开始调用 Subscription.request(n) 方法去拉取缓存区中的数据项</span>
<span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mSubscription<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每点击一次按钮，观察者从缓存区中拉取 48 个数据项</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步操作</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;观察者可接收事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 被观察者一共可发送 500 个数据项</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            
            <span class="token comment">/*
                若 requested() == 0 则暂不发送。
                （当缓存区从满载到剩余数据项个数大于 32 的这段过程中都返回 0）
            */</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;不再发送&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 执行到此处，说明 requested() &gt; 0 ，此时才允许发送数据项</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;，观察者可接收事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将参数 Subscription 赋值成员变量 mSubscription，以便在点击按钮时再拉取数据项</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/06.91beb812.png" alt="" loading="lazy"></p><h4 id="_7-3-4-示例-2-同步操作中的响应式拉取" tabindex="-1"><a class="header-anchor" href="#_7-3-4-示例-2-同步操作中的响应式拉取" aria-hidden="true">#</a> 7.3.4 示例 2：同步操作中的响应式拉取</h4><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">long</span> n <span class="token operator">=</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步操作中，返回观察者当前可接收的数据项个数</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;观察者可接收事件&quot;</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 同步操作中，被观察者发射数据项的个数不应该超过观察者可接收数据项的个数。（否则会触发 onError 事件）</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置观察者当前可接收的数据项个数为 10 个</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/07.ba9800f2.png" alt="" loading="lazy"></p><h4 id="_7-3-5-同步操作中反馈控制的注意事项" tabindex="-1"><a class="header-anchor" href="#_7-3-5-同步操作中反馈控制的注意事项" aria-hidden="true">#</a> 7.3.5 同步操作中反馈控制的注意事项</h4><h5 id="_7-3-5-1-观察者中多次调用的-subscription-request-n-具有叠加性" tabindex="-1"><a class="header-anchor" href="#_7-3-5-1-观察者中多次调用的-subscription-request-n-具有叠加性" aria-hidden="true">#</a> 7.3.5.1 观察者中多次调用的 <code>Subscription.request(n)</code> 具有叠加性</h5><p>同步操作中，观察者当前可接收的数据项个数 = <code>Subscription.request(n)</code> 方法所传入的参数值 <code>n</code>。</p><p>且当 <code>Subscription.request(n)</code> 方法多次调用时，可接收的数据项个数 = 每次调用时所传入参数 <code>n</code> 的累加值。</p><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                
        <span class="token comment">// 获取观察者当前可接收的数据项个数</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;观察者可接收事件&quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置观察者可接收的数据项个数为 10 个。</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置观察者可接收的数据项个数为 20 个。</span>

                <span class="token comment">/* 于是，观察者当前可接收的数据项个数 = 10 + 20 = 30 个 */</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/08.7418c87e.png" alt="" loading="lazy"></p><h5 id="_7-3-5-2-被观察者中-flowableemitter-requested-的返回值会实时更新" tabindex="-1"><a class="header-anchor" href="#_7-3-5-2-被观察者中-flowableemitter-requested-的返回值会实时更新" aria-hidden="true">#</a> 7.3.5.2 被观察者中 <code>FlowableEmitter.requested()</code> 的返回值会实时更新</h5><p>同步操作中，不存在缓存区，<code>requested()</code> 方法直接返回观察者可接收但还未接收的数据项个数。</p><p>由于发射过程和接收过程在同一线程中执行，所以被观察可以实时地监听观察者是否已接收到数据项，从而同一线程中的 <code>requested()</code> 方法也就可以实时地返回观察者还未接收到的数据项个数。</p><blockquote><p>异步操作中，<code>FlowableEmitter.requested()</code> 表示缓存区目前可存入的数据项个数，当 <code>requested()</code> 返回 <code>= 0</code> 后，得等到缓存区的剩余数据项个数 <code>&lt;= 32</code> 时，<code>requested()</code> 返回值才会更新。</p></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取观察者当前可接收的数据项个数</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;观察者可接收事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// requested() 会实时更新，即返回值 = 可接收的数据项个数 - 已接收的数据项个数</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件1后, 还需要发送事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件2后, 还需要发送事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件3后, 还需要发送事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置观察者当前可接收的数据项个数为 10 个</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/09.3fb252ec.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p>每次正常的发射/接收数据项后，被观察者中的 <code>requested()</code> 方法返回值所表示的观察者中还未接收到的数据项个数都会实时地更新。</p></blockquote><h5 id="_7-3-5-3-requested-返回-0-时发射数据项一定会触发-onerror-事件" tabindex="-1"><a class="header-anchor" href="#_7-3-5-3-requested-返回-0-时发射数据项一定会触发-onerror-事件" aria-hidden="true">#</a> 7.3.5.3 <code>requested()</code> 返回 <code>0</code> 时发射数据项一定会触发 <code>onError</code> 事件</h5><p>同步操作中，<code>FlowableEmitter.requested()</code> 返回 <code>0</code> 有两种情况：</p><div class="language-text ext-text"><pre class="language-text"><code>1. 观察者调用 request(n) 指定了可接收的数据项个数，且被观察者发射完 n 个数据项后，此时 requested() 返回 0；
2. 观察者未调用 request(n)，此时被观察者中 requested() 返回 0。
</code></pre></div><p>不管是哪种情况，由于同步操作中不存在缓存区，所以只要 <code>requested()</code> 返回 <code>0</code>，就说明观察者接收不了了，此时，如果被观察者再发射数据项，那么就会产生背压问题，即通过发射 <code>onError</code> 事件来触发 <code>MissingBackpressureException</code> 异常。</p><blockquote><p>异步操作中，<code>requested()</code> 返回值表示缓存区可存入的数据项个数。当 <code>requested()</code> 返回 <code>0</code> 时，虽然缓存区不可存入数据项了，但并不表示缓存区满载了（可能是空闲容量还没有达到或超过 <code>96</code>）。可以认为：只要缓存区中有空闲容量，即使 <code>requested()</code> 返回 <code>0</code>，那么也是能够正常发射数据项的。</p></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/*
    观察者只可接收 1 个数据项，但被观察者发射 2 个数据项。
    于是，当发射第 2 个数据项时 requested() 返回 0。
*/</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">// 获取观察者当前可接收的数据项个数</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;观察者可接收事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// requested() 会实时更新，即返回值 = 可接收的数据项个数 - 已接收的数据项个数</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件1后, 还需要发送事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送事件2后, 还需要发送事件数量 = &quot;</span> <span class="token operator">+</span> emitter<span class="token punctuation">.</span><span class="token function">requested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置观察者当前可接受 1 个数据项</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/10.78df2f12.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p>由于观察者只可接收 <code>1</code> 个数据项，所以被观察者在发射完第 <code>1</code> 个数据项后，<code>requested()</code> 返回了 <code>0</code>，于是在发射第 <code>2</code> 个数据项时，会通过发射 <code>onError</code> 事件来触发 <code>MissingBackpressureException</code> 异常。</p></blockquote><h3 id="_7-4-背压策略-——-采用不同的背压策略模式-backpressurestrategy" tabindex="-1"><a class="header-anchor" href="#_7-4-背压策略-——-采用不同的背压策略模式-backpressurestrategy" aria-hidden="true">#</a> 7.4 背压策略 —— 采用不同的背压策略模式（<code>BackpressureStrategy</code>）</h3><h4 id="_7-4-1-五种背压策略模式" tabindex="-1"><a class="header-anchor" href="#_7-4-1-五种背压策略模式" aria-hidden="true">#</a> 7.4.1 五种背压策略模式</h4><p>在枚举类 <code>BackpressureStrategy</code> 中定义了五种背压策略模式，分别对应在出现发射速度与响应速度不匹配的情况时所采取的不同的处理方式（如丢弃数据项、保留数据项、发射 <code>onError</code> 事件触发异常等处理方式）</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">BackpressureStrategy</span> <span class="token punctuation">{</span>
    MISSING<span class="token punctuation">,</span>
    
    ERROR<span class="token punctuation">,</span>
    
    BUFFER<span class="token punctuation">,</span>
    
    DROP<span class="token punctuation">,</span>
    
    LATEST
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_7-4-1-2-backpressurestrategy-error" tabindex="-1"><a class="header-anchor" href="#_7-4-1-2-backpressurestrategy-error" aria-hidden="true">#</a> 7.4.1.2 <code>BackpressureStrategy.ERROR</code></h5><p>当源被观察者发射数据项的个数超过 <code>FlowableEmitter.requested()</code> 的返回值时，向观察者发射 <code>onError(Throwable)</code> 事件来触发 <code>MissingBackpressureException</code> 异常。</p><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            异步操作中，requested() 返回可存入缓存区的数据项个数，
            即使在初始状态下，最多也只能连续存入 128 个（缓存区的默认容量）数据项，
            所以这里连续发射 129 个数据项时，第 129 个数据项发射时会触发 onError 事件，向观察者抛出异常。
        */</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">129</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 ERROR</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/11.795b2d94.png" alt="" loading="lazy"></p><h5 id="_7-4-1-1-backpressurestrategy-missing" tabindex="-1"><a class="header-anchor" href="#_7-4-1-1-backpressurestrategy-missing" aria-hidden="true">#</a> 7.4.1.1 <code>BackpressureStrategy.MISSING</code></h5><p>在数据项的发射/接收过程中，除了源被观察者和目标观察者之外，中途还存在一些被观察者和观察者对传递的数据项进行加工处理。</p><p><code>ERROR</code> 策略模式是在源被观察者中就阻止了对超过 <code>requested()</code> 返回值个数的数据项的发射，并触发 <code>onError</code> 事件，向目标观察者抛出 <code>MissingBackpressureException</code> 异常。</p><p><code>MISSING</code> 策略模式则是允许源被观察者继续发射超过 <code>requested()</code> 返回值个数的数据项，由中途的被观察者和观察者来对超出的数据项进行自定义处理。比如：</p><div class="language-text ext-text"><pre class="language-text"><code>Flowable.observeOn 操作符返回一个中途的被观察者 FlowableObserveOn，
超出的数据项经过被观察者 FlowableObserveOn 再发射给中途的观察者 FlowableObserveOn.ObserveOnSubscriber，
当 ObserveOnSubscriber 接收到超出的数据项时触发 onError 事件，向目标观察者抛出 MissingBackpressureException 异常。
</code></pre></div><blockquote><p>虽然可能和 <code>ERROR</code> 策略模式一样，<code>MISSING</code> 策略模式在发射超出 <code>requested()</code> 返回值个数的数据项时，也是触发 <code>onError</code> 事件，向目标观察者抛出 <code>MissingBackpressureException</code> 异常。</p><p>但这两种策略模式的不同之处在于：<code>ERROR</code> 策略模式只可能向目标观察者抛出 <code>MissingBackpressureException</code> 异常。</p><p>而 <code>MISSING</code> 策略模式除了可以向目标观察者抛出 <code>MissingBackpressureException</code> 异常之外，还可以自定义其他的处理方式，这完全是由中途的被观察者和观察者来自定义处理的，较 <code>ERROR</code> 模式更加灵活。</p></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/*
    MISSING 模式下，操作符 observeOn 所产生的中途被观察者和观察者在遇到超出的数据项时的处理方式
*/</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">129</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>MISSING<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 MISSING</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/12.9fa1bb76.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p><code>MISSING</code> 模式下向观察者抛出 <code>MissingBackpressureException</code> 异常时，与 <code>ERROR</code> 模式下所抛出的 <code>MissingBackpressureException</code> 异常相比，异常对象所携带的异常信息不同。 （<code>MISSING</code> 模式下的异常信息是由中途的观察者 <code>FlowableObserveOn.ObserveOnSubscriber</code> 来定义的）</p></blockquote><h5 id="_7-4-1-3-backpressurestrategy-buffer" tabindex="-1"><a class="header-anchor" href="#_7-4-1-3-backpressurestrategy-buffer" aria-hidden="true">#</a> 7.4.1.3 <code>BackpressureStrategy.BUFFER</code></h5><p><code>BUFFER</code> 模式下，即使源被观察者发射数据项的个数超过 <code>FlowableEmitter.requested()</code> 的返回值，超出的数据项仍然会发射出去。具体为：</p><div class="language-text ext-text"><pre class="language-text"><code>异步操作中，超出 requested() 返回值个数的数据项也总是可以存入到缓存区中，
即使缓存区满载，也会对缓存区进行扩容，直到缓存区内存溢出，产生 OOM 异常，引起进程崩溃。
（也就是说 BUFFER 模式下的程序是存在风险的）
</code></pre></div><div class="language-text ext-text"><pre class="language-text"><code>同步操作中，默认是没有缓存区的，但 BUFFER 模式下，也会提供一个不限制容量的队列容器。
不管观察者是否设置了可接收的数据项个数，也不管是否超过了观察者可接收的数据项个数，
发射的数据项总是会先存入到这个队列容器中。
此时，和异步操作类似，同步操作中的观察者在设置了可接收的数据项个数后，就从这个队列容器中拉取指定个数的数据项。
</code></pre></div><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/*
    异步操作中，BUFFER 策略模式下，即使连续发射的数据项超出了缓存区的默认容量（128），
    也还是会通过对缓存区进行扩容来接收下所有发射的数据项。
*/</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">130</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>BUFFER<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 BUFFER</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/13.10fbcb17.png" alt="" loading="lazy"></p><h5 id="_7-4-1-4-backpressurestrategy-drop" tabindex="-1"><a class="header-anchor" href="#_7-4-1-4-backpressurestrategy-drop" aria-hidden="true">#</a> 7.4.1.4 <code>BackpressureStrategy.DROP</code></h5><p><code>DROP</code> 模式下，当源被观察者发射数据项的个数超过 <code>FlowableEmitter.requested()</code> 的返回值时，会将超出的数据项默默地丢弃掉，而不会向 <code>ERROR</code> 模式那样，通过发射 <code>onError</code> 事件来提醒观察者。</p><blockquote><p><code>DROP</code> 模式和 <code>ERROR</code> 模式的区别之处仅在于：</p><ol><li><p><code>ERROR</code> 模式下，在发射超出的数据项时，会将其丢弃掉，并发射一个 <code>onError</code> 事件，向观察者抛出异常来提醒观察者。</p></li><li><p><code>DROP</code> 模式下，在发射超出的数据项时，会将其丢弃掉，而不会通过发射 <code>onError</code> 事件来提醒观察者。</p></li></ol></blockquote><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 点击按钮时，观察者才开始调用 Subscription.request(n) 方法去拉取缓存区中的数据项
 */</span>
<span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mSubscription<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每点击一次按钮，观察者从缓存区中拉取 128 个数据项</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 异步操作
 */</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">150</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 被观察者一共发送 150 个数据项</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>DROP<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 DROP</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将参数 Subscription 赋值成员变量 mSubscription，以便在点击按钮时再拉取数据项</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/14.fc27db09.gif" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p>只有先发射的前 <code>128</code> 个数据项存入了缓存区中，第 <code>129</code> 至第 <code>150</code> 个数据项没有存入到缓存区。</p><p>所以，观察者只能从缓存区中拉取到前 <code>128</code> 个数据项。</p><p>至于第 <code>129</code> 至第 <code>150</code> 个数据项发射出去后就被偷偷地丢弃了，观察者无法感知到。</p></blockquote><h5 id="_7-4-1-5-backpressurestrategy-latest" tabindex="-1"><a class="header-anchor" href="#_7-4-1-5-backpressurestrategy-latest" aria-hidden="true">#</a> 7.4.1.5 <code>BackpressureStrategy.LATEST</code></h5><p><code>LATEST</code> 模式下，当源被观察者发射数据项的个数超过 <code>FlowableEmitter.requested()</code> 的返回值时，会将超出的数据项存入到一个容量为 <code>1</code> 的容器中。且后存入的数据项会覆盖掉先存入的数据项。</p><p>于是这个容量为 <code>1</code> 的容器中就只保存了一个超出的数据项，且这个被保存的超出数据项是最后发射的。</p><p>当 <code>requested()</code> 返回值 <code>&gt; 0</code> 时，会先将容量为 <code>1</code> 的容器中的数据项发射出去。</p><p>示例：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 点击按钮时，观察者才开始调用 Subscription.request(n) 方法去拉取缓存区中的数据项
 */</span>
<span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mSubscription<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每点击一次按钮，观察者从缓存区中拉取 128 个数据项</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 异步操作
 */</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">150</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 被观察者一共发送 150 个数据项</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;发送了事件&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emitter<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        emitter<span class="token punctuation">.</span><span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span><span class="token punctuation">.</span>LATEST<span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 LATEST</span>
        <span class="token punctuation">.</span><span class="token function">subscribeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 先设置发射、响应数据项的过程都在 IOScheduler 调度器维护的子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">AndroidSchedulers</span><span class="token punctuation">.</span><span class="token function">mainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 再单独设置响应数据项的过程在主线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将参数 Subscription 赋值成员变量 mSubscription，以便在点击按钮时再拉取数据项</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> integer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;接收到了事件&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/15.70e6fc64.gif" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><ol><li><p>异步操作中，在未点击按钮之前，观察者不接收数据项，所以被观察者发射的数据项存入缓存区后还不会被取出。且由于缓存区初始的空闲容量是 <code>128</code>，所以被观察者在连续发射 <code>150</code> 个数据项时，只有前 <code>128</code> 个数据项存入了缓存区。</p></li><li><p>在 <code>LATEST</code> 模式下，之后发射的第 <code>129</code> 至第 <code>150</code> 个数据项存入容量为 <code>1</code> 的容器中，且后存入的覆盖先存入的，于是，容量为 <code>1</code> 的容器中最终只保存了第 <code>150</code> 个发射的数据项。</p></li><li><p>在首次按下按钮后，观察者可从缓存区中拉取 <code>128</code> 个数据项。拉取后缓存区的剩余数据项个数为 <code>0</code>（<code>&lt; 32</code>），所以，观察者接收了 <code>128</code> 个数据项后，被观察者中的 <code>requested()</code> 返回值为 <code>128</code>（<code>&gt; 0</code>）。于是，会将容量为 <code>1</code> 的容器中的第 <code>150</code> 个数据项发射出去（异步操作中就是先存入到缓存区中）。</p></li><li><p>当第二次按下按钮后，观察者可再次从缓存区中拉取 <code>128</code> 个数据项。此时，缓存区中只保存了一个数据项（即第 <code>150</code> 个数据项），于是，观察者就只接收到了这一个数据项。</p></li></ol></blockquote><h4 id="_7-4-2-指定背压策略模式的方式" tabindex="-1"><a class="header-anchor" href="#_7-4-2-指定背压策略模式的方式" aria-hidden="true">#</a> 7.4.2 指定背压策略模式的方式</h4><h5 id="_7-4-2-1-在-create-创建操作符中指定背压策略模式" tabindex="-1"><a class="header-anchor" href="#_7-4-2-1-在-create-创建操作符中指定背压策略模式" aria-hidden="true">#</a> 7.4.2.1 在 <code>create</code> 创建操作符中指定背压策略模式</h5><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Flowable.java */</span>
<span class="token comment">/*
    返回 Flowable 的子类 FlowableCreate
    参数 source 提供 subscribe(emitter) 方法用来发射数据项
    参数 mode 指定被观察者在发射超出 requested() 返回值个数的数据项时所采用的背压策略模式
*/</span>
<span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span> <span class="token class-name">BackpressureStrategy</span> mode<span class="token punctuation">)</span>
</code></pre></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FlowableOnSubscribe</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/*
        该方法在 FlowableCreate 重写的 subscribeActual 方法中调用。
        create 操作符传入的背压策略模式参数 mode 不同，所使用的发射器 emitter 也不同
    */</span>
    <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">FlowableEmitter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> emitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_7-4-2-2-在其他创建操作符中指定背压策略模式" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-在其他创建操作符中指定背压策略模式" aria-hidden="true">#</a> 7.4.2.2 在其他创建操作符中指定背压策略模式</h5><p>类似于 <code>Observable.java</code>，<code>Flowable.java</code> 中除了提供 <code>create</code> 创建操作符方法之外，还提供了其他的创建操作符方法用来生成 <code>Flowable</code> 的其他子类对象。</p><p>但是在 <code>Flowable.java</code> 中的其他创建操作符方法的参数列表中，并不能指定背压策略模式。为此，<code>Flowable.java</code> 中提供了如下几个操作符专门用来指定背压策略模式：</p><ol><li><p><code>onBackpressureBuffer</code>；</p></li><li><p><code>onBackpressureDrop</code>；</p></li><li><p><code>onBackpressureLatest</code>。</p></li></ol><blockquote><p>如果在使用其他创建操作符时不指定背压策略模式，则默认采用 <code>BackpressureStrategy.ERROR</code> 模式。</p></blockquote><h6 id="_7-4-2-2-1-默认采用-backpressurestrategy-error" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-1-默认采用-backpressurestrategy-error" aria-hidden="true">#</a> 7.4.2.2.1 默认采用 <code>BackpressureStrategy.ERROR</code></h6><h6 id="_7-4-2-2-2-onbackpressurebuffer" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-2-onbackpressurebuffer" aria-hidden="true">#</a> 7.4.2.2.2 <code>onBackpressureBuffer()</code></h6><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Flowable.java */</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// onBackpressureBuffer(bufferSize(), false, true);</span>

<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span> <span class="token comment">// onBackpressureBuffer(bufferSize(), delayError, true);</span>
        <span class="token keyword">boolean</span> delayError<span class="token punctuation">)</span> 

<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span> <span class="token comment">// onBackpressureBuffer(capacity, false, false)</span>
        <span class="token keyword">int</span> capacity<span class="token punctuation">)</span>

<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span> <span class="token comment">// onBackpressureBuffer(capacity, delayError, false)</span>
        <span class="token keyword">int</span> capacity<span class="token punctuation">,</span> 
        <span class="token keyword">boolean</span> delayError<span class="token punctuation">)</span>

<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span>
        <span class="token keyword">int</span> capacity<span class="token punctuation">,</span>
        <span class="token keyword">boolean</span> delayError<span class="token punctuation">,</span> 
        <span class="token keyword">boolean</span> unbounded<span class="token punctuation">)</span>

<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span>
        <span class="token keyword">int</span> capacity<span class="token punctuation">,</span> 
        <span class="token class-name">Action</span> onOverflow<span class="token punctuation">)</span>

<span class="token comment">/*
    参数 capacity：设置缓存区的初始容量。其中，容量值必须为 2 的幂。
                   如果 capacity 为 2 的幂，则初始容量为 capacity；
                   如果 capacity 不为 2 的幂，则取大于 capacity 的 2 的幂为初始容量。
                   默认为 Flowable.bufferSize()，即 128。

    参数 delayError：当发射/接收过程中出现异常需要发送 onError 事件，且缓存区中还存在数据项时，那么：
                    1. 若 delayError 为 true，则等到缓存区中的数据项都发射出去后再发射 onError 事件；
                    2. 若 delayError 为 false，则立即发射 onError 事件。
                    默认为 false。

    参数 unbounded：设置缓存区是否可以扩容。
                    若 unbounded 为 true，则缓存区在初始容量 capacity 的基础上还可以无限地扩容。
                    若 unbounded 为 false，则缓存区的容量为固定值 = capacity，不可以扩容。
                    若没有指定 capacity 则默认为 true；若指定了 capacity 则默认为 false。

    参数 onOverflow：当数据项无法存入到缓存区中时（如固定容量的缓存区满载后），
                     被观察者会发射 onError 事件，向观察者抛出 MissingBackpressureException 异常，
                     此时，在发射 onError 事件之前，会先回调 onOverflow.run() 方法。
*/</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span>
        <span class="token keyword">int</span> capacity<span class="token punctuation">,</span> 
        <span class="token keyword">boolean</span> delayError<span class="token punctuation">,</span> 
        <span class="token keyword">boolean</span> unbounded<span class="token punctuation">,</span> 
        <span class="token class-name">Action</span> onOverflow<span class="token punctuation">)</span>

<span class="token comment">/*
    设置一个固定容量为 capacity 的缓存区，当缓存区满载时，根据 overflowStrategy 采用不同的处理方式：
    1. BackpressureOverflowStrategy.ERROR
        缓存区满载时发射 onError 事件，向观察者抛出 MissingBackpressureException 异常。
    
    2. BackpressureOverflowStrategy.DROP_OLDEST
        缓存区满载时，移除最先存入的数据项，并将当前发射的数据项存入进去，
        然后再回调 onOverflow.run() 方法

    3. BackpressureOverflowStrategy.DROP_LATEST
        缓存区满载时，移除最后存入的数据项，并将当前发射的数据项存入进去，
        然后再回调 onOverflow.run() 方法
*/</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span>
        <span class="token keyword">long</span> capacity<span class="token punctuation">,</span> 
        <span class="token class-name">Action</span> onOverflow<span class="token punctuation">,</span> 
        <span class="token class-name">BackpressureOverflowStrategy</span> overflowStrategy<span class="token punctuation">)</span>
</code></pre></div><h6 id="_7-4-2-2-3-onbackpressuredrop" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-3-onbackpressuredrop" aria-hidden="true">#</a> 7.4.2.2.3 <code>onBackpressureDrop()</code></h6><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Flowable.java */</span>
<span class="token comment">/*
    同 BackpressureStrategy.DROP 一样，
    在发射超出的数据项时，会将其丢弃掉，而不会通过发射 onError 事件来提醒观察者。
*/</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureDrop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/*
    在发射超出的数据项时，会将其丢弃掉，
    虽然不会通过发射 onError 事件来提醒观察者，但会回调 onDrop.accept(T) 方法，传入超出的数据项 T。
*/</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureDrop</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> onDrop<span class="token punctuation">)</span>
</code></pre></div><h6 id="_7-4-2-2-4-onbackpressurelatest" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-4-onbackpressurelatest" aria-hidden="true">#</a> 7.4.2.2.4 <code>onBackpressureLatest()</code></h6><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/* Flowable.java */</span>
<span class="token comment">/*
    同 BackpressureStrategy.LATEST 一样
*/</span>
<span class="token class-name">Flowable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">onBackpressureLatest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h6 id="_7-4-2-2-5-示例" tabindex="-1"><a class="header-anchor" href="#_7-4-2-2-5-示例" aria-hidden="true">#</a> 7.4.2.2.5 示例</h6><p>示例 1：默认采用 <code>ERROR</code> 策略模式</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">/*
    被观察者延迟 1ms 开始发射数据项，每间隔 1ms 发射一个数据项。
    发射的数据项从 0 开始，每发射一次后 +1。
*/</span>
<span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 设置接收数据项的过程在子线程中执行</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Long</span> aLong<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onNext: &quot;</span> <span class="token operator">+</span> aLong<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">/*
                        发射过程和接收过程在不同的线程中执行，
                        发射过程中，每发射一个数据项休眠 1ms，且正常情况下会无限制地发射下去
                        接收过程中，每接收到一个数据项休眠 1s，
                        于是，发射速度 &gt; 接收速度，会出现背压问题。
                    */</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/16.f1f06597.png" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p>在观察者线程休眠的 <code>1s</code> 时间内，被观察者线程中发射的数据项已经超出了缓存区的容量，</p><p>由于非 <code>create</code> 创建操作符默认采用 <code>BackpressureStrategy.ERROR</code> 策略模式，</p><p>所以发射超出的数据项时，触发 <code>onError</code> 事件，向观察者抛出 <code>MissingBackpressureException</code> 异常。</p></blockquote><p>示例 2：采用 <code>onBackpressureBuffer()</code></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">Flowable</span><span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onBackpressureBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 设置背压策略模式为 BUFFER。其中，缓存区可扩容。</span>
        <span class="token punctuation">.</span><span class="token function">observeOn</span><span class="token punctuation">(</span><span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Subscription</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSubscribe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mSubscription <span class="token operator">=</span> s<span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">Long</span> aLong<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onNext: &quot;</span> <span class="token operator">+</span> aLong<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onError: &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onComplete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印日志：</p><p><img src="/assets/17.f1b262c6.gif" alt="" loading="lazy"></p><blockquote><p>从打印日志可以看出：</p><p>由于缓存区可扩容，所以发射的超出数据项仍然能够无限地存入缓存区中。</p></blockquote><h2 id="_8-背压策略总结" tabindex="-1"><a class="header-anchor" href="#_8-背压策略总结" aria-hidden="true">#</a> 8. 背压策略总结</h2><p>三种背压策略（响应式拉取、反馈控制、背压策略模式）从三个方面来解决背压问题，所以这三种背压策略是结合起来使用的，单独地使用某种或某两种背压策略都还是可能会出现背压问题。</p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zengkaiqiang562/JavaGuide/edit/main/docs/zkq/third-party-open-project/rxjava/backpressure.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/7/7 23:59:00</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zengkaiqiang562@163.com">zengk</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zkq/third-party-open-project/rxjava/scheduler.html" class="nav-link prev" arialabel="调度器（Scheduler）"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->调度器（Scheduler）</div></a><!----></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2024 Zenk562</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.2a01fc36.js" defer></script>
  </body>
</html>
